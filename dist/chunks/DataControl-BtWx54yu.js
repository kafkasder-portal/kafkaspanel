import{r as e,j as a,m as t,e as s,y as r,p as l,X as n,J as i,S as o,n as d,q as c,a3 as u}from"../assets/index-dW79Uy5k.js";import{e as m}from"./exportToCsv-DLkyd1nM.js";import{D as x}from"./DataTable-Co2fK-v0.js";import{M as h}from"./Modal-BBek2lFh.js";import{S as p}from"./StatCard-CRbncoUZ.js";import{u as g,t as b,o as y,s as _,e as j}from"./types-DWSxFkmy.js";import{V as f}from"./index-BPtWanD8.js";import{A as v}from"./alert-circle-CBPaGutZ.js";import{E as k}from"./eye-C2ZiGWXh.js";import{P as w}from"./pen-square-DLfSiTnY.js";const N=y({table_name:_().min(1,"Tablo adı seçiniz"),validation_type:j(["integrity","consistency","completeness","accuracy","duplicates"],{message:"Doğrulama tipi seçiniz"}),field_name:_().optional(),rule_description:_().min(1,"Kural açıklaması giriniz"),details:_().optional(),suggested_action:_().optional()}),S=["beneficiaries","aid_applications","cash_aids","bank_orders","service_tracking","hospital_referrals","parameters","users","donations","reports"],D=[{value:"integrity",label:"Veri Bütünlüğü"},{value:"consistency",label:"Tutarlılık"},{value:"completeness",label:"Eksiksizlik"},{value:"accuracy",label:"Doğruluk"},{value:"duplicates",label:"Tekrar Eden Kayıtlar"}];function T(){const[y,_]=e.useState([]),[j,T]=e.useState([]),[C,I]=e.useState({totalValidations:0,passedValidations:0,failedValidations:0,warningValidations:0,totalRecords:0,errorRecords:0,dataQualityScore:0}),[z,O]=e.useState(!0),[V,M]=e.useState(""),[K,$]=e.useState("all"),[B,L]=e.useState("all"),[E,R]=e.useState("all"),[A,Y]=e.useState(!1),[q,P]=e.useState(null),[Q,U]=e.useState(!0),[F,G]=e.useState(null),{register:H,handleSubmit:J,formState:{errors:W},reset:X}=g({resolver:b(N)});e.useEffect(()=>{Z(),ee(),ae()},[]);const Z=async()=>{try{const e=[{id:"1",table_name:"beneficiaries",validation_type:"completeness",field_name:"phone",rule_description:"Telefon numarası zorunlu alanların kontrolü",status:"warning",error_count:15,total_records:250,error_percentage:6,last_check:(new Date).toISOString(),created_at:(new Date).toISOString(),details:"15 kayıtta telefon numarası eksik",suggested_action:"Eksik telefon numaralarını tamamlayın"},{id:"2",table_name:"aid_applications",validation_type:"duplicates",field_name:"beneficiary_id",rule_description:"Aynı kişiden birden fazla aktif başvuru kontrolü",status:"failed",error_count:8,total_records:180,error_percentage:4.4,last_check:new Date(Date.now()-72e5).toISOString(),created_at:(new Date).toISOString(),details:"8 kişinin birden fazla aktif başvurusu var",suggested_action:"Tekrar eden başvuruları birleştirin veya iptal edin"},{id:"3",table_name:"cash_aids",validation_type:"integrity",field_name:"amount",rule_description:"Yardım tutarının pozitif olması kontrolü",status:"passed",error_count:0,total_records:95,error_percentage:0,last_check:new Date(Date.now()-18e5).toISOString(),created_at:(new Date).toISOString(),details:"Tüm yardım tutarları pozitif",suggested_action:""},{id:"4",table_name:"beneficiaries",validation_type:"accuracy",field_name:"birth_date",rule_description:"Doğum tarihinin mantıklı aralıkta olması kontrolü",status:"warning",error_count:3,total_records:250,error_percentage:1.2,last_check:new Date(Date.now()-144e5).toISOString(),created_at:(new Date).toISOString(),details:"3 kayıtta şüpheli doğum tarihi (100+ yaş)",suggested_action:"Doğum tarihlerini kontrol edin"},{id:"5",table_name:"bank_orders",validation_type:"consistency",field_name:"status",rule_description:"Ödeme durumu ile tarih alanlarının tutarlılığı",status:"passed",error_count:0,total_records:45,error_percentage:0,last_check:new Date(Date.now()-36e5).toISOString(),created_at:(new Date).toISOString(),details:"Tüm ödeme durumları tutarlı",suggested_action:""}];_(e)}catch(e){f.error("Veri doğrulama kayıtları yüklenirken hata oluştu")}finally{O(!1)}},ee=async()=>{try{const e=[{table_name:"beneficiaries",record_count:250,last_updated:new Date(Date.now()-72e5).toISOString(),health_score:85,issues:2,status:"warning"},{table_name:"aid_applications",record_count:180,last_updated:new Date(Date.now()-18e5).toISOString(),health_score:75,issues:3,status:"warning"},{table_name:"cash_aids",record_count:95,last_updated:new Date(Date.now()-36e5).toISOString(),health_score:95,issues:0,status:"healthy"},{table_name:"bank_orders",record_count:45,last_updated:new Date(Date.now()-27e5).toISOString(),health_score:92,issues:1,status:"healthy"}];T(e)}catch(e){}},ae=async()=>{try{I({totalValidations:25,passedValidations:15,failedValidations:4,warningValidations:6,totalRecords:1250,errorRecords:45,dataQualityScore:87})}catch(e){}},te=e.useMemo(()=>y.filter(e=>{var a,t;const s=""===V||e.table_name.toLowerCase().includes(V.toLowerCase())||e.rule_description.toLowerCase().includes(V.toLowerCase())||(null==(a=e.field_name)?void 0:a.toLowerCase().includes(V.toLowerCase()))||(null==(t=e.details)?void 0:t.toLowerCase().includes(V.toLowerCase())),r="all"===K||e.table_name===K,l="all"===B||e.validation_type===B,n="all"===E||e.status===E;return s&&r&&l&&n}),[y,V,K,B,E]),se=e=>new Date(e).toLocaleString("tr-TR"),re=e=>{const a=new Date,t=new Date(e),s=a.getTime()-t.getTime(),r=Math.floor(s/6e4),l=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<60?`${r} dakika önce`:l<24?`${l} saat önce`:`${n} gün önce`},le=[{key:"table_info",header:"Tablo & Alan",render:(e,t)=>a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium flex items-center gap-1",children:[a.jsx(u,{className:"h-3 w-3 text-blue-600"}),t.table_name]}),t.field_name&&a.jsx("div",{className:"text-sm text-muted-foreground",children:t.field_name})]})},{key:"validation_type",header:"Tip",render:(e,t)=>(e=>{const t={integrity:{label:"Bütünlük",class:"bg-blue-100 text-blue-800"},consistency:{label:"Tutarlılık",class:"bg-purple-100 text-purple-800"},completeness:{label:"Eksiksizlik",class:"bg-orange-100 text-orange-800"},accuracy:{label:"Doğruluk",class:"bg-green-100 text-green-800"},duplicates:{label:"Tekrar",class:"bg-red-100 text-red-800"}}[e]||{label:e,class:"bg-gray-100 text-gray-800"};return a.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:t.label})})(t.validation_type)},{key:"rule_description",header:"Kural",render:(e,t)=>a.jsxs("div",{className:"max-w-xs",children:[a.jsx("div",{className:"text-sm truncate",title:t.rule_description,children:t.rule_description}),t.details&&a.jsx("div",{className:"text-xs text-muted-foreground mt-1",title:t.details,children:t.details})]})},{key:"status",header:"Durum",render:(e,t)=>(e=>{const t={passed:{label:"Başarılı",class:"bg-green-100 text-green-800",icon:l},failed:{label:"Başarısız",class:"bg-red-100 text-red-800",icon:n},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:i},pending:{label:"Bekliyor",class:"bg-gray-100 text-gray-800",icon:c}}[e]||{label:e,class:"bg-gray-100 text-gray-800",icon:v},s=t.icon;return a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[a.jsx(s,{className:"h-3 w-3"}),t.label]})})(t.status)},{key:"results",header:"Sonuçlar",render:(e,t)=>a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:t.error_count>0?"text-red-600 font-medium":"text-green-600",children:t.error_count}),a.jsxs("span",{className:"text-muted-foreground",children:[" / ",t.total_records]})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:["%",t.error_percentage.toFixed(1)," hata"]}),t.error_percentage>0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-1",children:a.jsx("div",{className:"h-1 rounded-full "+(t.error_percentage<5?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(t.error_percentage,100)}%`}})})]})},{key:"last_check",header:"Son Kontrol",render:(e,t)=>a.jsxs("div",{children:[a.jsx("div",{className:"text-sm",children:re(t.last_check)}),a.jsx("div",{className:"text-xs text-muted-foreground",children:se(t.last_check)})]})},{key:"actions",header:"İşlemler",render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(async e=>{try{G(e),await new Promise(e=>setTimeout(e,2e3));const a={error_count:Math.floor(20*Math.random()),total_records:100+Math.floor(200*Math.random())};_(t=>t.map(t=>{if(t.id===e){const e=a.error_count/a.total_records*100,s=0===e?"passed":e<5?"warning":"failed";return{...t,...a,error_percentage:e,status:s,last_check:(new Date).toISOString()}}return t})),f.success("Doğrulama başarıyla çalıştırıldı")}catch(a){f.error("Doğrulama çalıştırılırken hata oluştu")}finally{G(null)}})(s.id),disabled:F===s.id||"all"===F,className:"rounded p-1 text-blue-600 hover:bg-blue-50 disabled:opacity-50",title:"Doğrulamayı Çalıştır",children:F===s.id?a.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}):a.jsx(t,{className:"h-4 w-4"})}),a.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:a.jsx(k,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>{P(s),Y(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:a.jsx(w,{className:"h-4 w-4"})})]})}],ne=[{key:"table_name",header:"Tablo",render:(e,t)=>a.jsxs("div",{className:"font-medium flex items-center gap-1",children:[a.jsx(u,{className:"h-4 w-4 text-blue-600"}),t.table_name]})},{key:"record_count",header:"Kayıt Sayısı",render:(e,t)=>a.jsx("div",{className:"text-sm font-medium",children:t.record_count.toLocaleString()})},{key:"health_score",header:"Sağlık Skoru",render:(e,t)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"text-sm font-medium",children:["%",t.health_score]}),a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"h-2 rounded-full "+(t.health_score>=90?"bg-green-500":t.health_score>=70?"bg-yellow-500":"bg-red-500"),style:{width:`${t.health_score}%`}})})]})},{key:"issues",header:"Sorunlar",render:(e,t)=>a.jsx("div",{className:"text-sm font-medium "+(0===t.issues?"text-green-600":"text-red-600"),children:t.issues})},{key:"status",header:"Durum",render:(e,t)=>(e=>{const t={healthy:{label:"Sağlıklı",class:"bg-green-100 text-green-800",icon:l},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:i},critical:{label:"Kritik",class:"bg-red-100 text-red-800",icon:v}}[e]||{label:e,class:"bg-gray-100 text-gray-800",icon:v},s=t.icon;return a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[a.jsx(s,{className:"h-3 w-3"}),t.label]})})(t.status)},{key:"last_updated",header:"Son Güncelleme",render:(e,t)=>a.jsxs("div",{children:[a.jsx("div",{className:"text-sm",children:re(t.last_updated)}),a.jsx("div",{className:"text-xs text-muted-foreground",children:se(t.last_updated)})]})}];return z?a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),a.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Veri Kontrolü"}),a.jsx("p",{className:"text-muted-foreground",children:"Veri kalitesini izleyin ve doğrulama kurallarını yönetin"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:async()=>{try{G("all"),await new Promise(e=>setTimeout(e,5e3)),_(e=>e.map(e=>{const a=Math.floor(20*Math.random()),t=100+Math.floor(200*Math.random()),s=a/t*100;return{...e,error_count:a,total_records:t,error_percentage:s,status:0===s?"passed":s<5?"warning":"failed",last_check:(new Date).toISOString()}})),f.success("Tüm doğrulamalar başarıyla çalıştırıldı"),ae(),ee()}catch(e){f.error("Doğrulamalar çalıştırılırken hata oluştu")}finally{G(null)}},disabled:"all"===F,className:"flex items-center gap-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700 disabled:opacity-50",children:["all"===F?a.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):a.jsx(t,{className:"h-4 w-4"}),"Tümünü Çalıştır"]}),a.jsxs("button",{onClick:()=>{P(null),Y(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[a.jsx(s,{className:"h-4 w-4"}),"Yeni Kural"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[a.jsx(p,{title:"Veri Kalite Skoru",value:`%${C.dataQualityScore}`,icon:r,accentClass:"bg-blue-100"}),a.jsx(p,{title:"Başarılı Doğrulamalar",value:C.passedValidations.toString(),icon:l,accentClass:"bg-green-100"}),a.jsx(p,{title:"Başarısız Doğrulamalar",value:C.failedValidations.toString(),icon:n,accentClass:"bg-red-100"}),a.jsx(p,{title:"Hatalı Kayıtlar",value:`${C.errorRecords} / ${C.totalRecords}`,icon:i,accentClass:"bg-yellow-100"})]}),Q&&a.jsxs("div",{className:"rounded-lg border",children:[a.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Tablo Sağlık Durumu"}),a.jsx("button",{onClick:()=>U(!1),className:"text-muted-foreground hover:text-foreground",children:a.jsx(n,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"p-4",children:a.jsx(x,{columns:ne,data:j})})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(o,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("input",{type:"text",placeholder:"Doğrulama ara...",value:V,onChange:e=>M(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),a.jsxs("select",{value:K,onChange:e=>$(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Tablolar"}),S.map(e=>a.jsx("option",{value:e,children:e},e))]}),a.jsxs("select",{value:B,onChange:e=>L(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Tipler"}),D.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsxs("select",{value:E,onChange:e=>R(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Durumlar"}),a.jsx("option",{value:"passed",children:"Başarılı"}),a.jsx("option",{value:"failed",children:"Başarısız"}),a.jsx("option",{value:"warning",children:"Uyarı"}),a.jsx("option",{value:"pending",children:"Bekleyen"})]}),a.jsxs("button",{onClick:()=>m("veri-kontrol.csv",te),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[a.jsx(d,{className:"h-4 w-4"}),"İndir"]}),a.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[te.length," doğrulama"]})]}),a.jsx(x,{columns:le,data:te}),a.jsxs(h,{open:A,onClose:()=>Y(!1),children:[a.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[a.jsx("h2",{className:"text-lg font-semibold",children:q?"Doğrulama Kuralı Düzenle":"Yeni Doğrulama Kuralı"}),a.jsx("button",{onClick:()=>Y(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),a.jsxs("form",{onSubmit:J(async e=>{try{const a={id:Date.now().toString(),...e,status:"pending",error_count:0,total_records:0,error_percentage:0,last_check:(new Date).toISOString(),created_at:(new Date).toISOString()};q?(_(e=>e.map(e=>e.id===q.id?{...a,id:q.id}:e)),f.success("Doğrulama kuralı başarıyla güncellendi")):(_(e=>[a,...e]),f.success("Doğrulama kuralı başarıyla oluşturuldu")),Y(!1),X(),ae()}catch(a){f.error("Doğrulama kuralı kaydedilirken hata oluştu")}}),className:"p-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tablo *"}),a.jsxs("select",{...H("table_name"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),S.map(e=>a.jsx("option",{value:e,children:e},e))]}),W.table_name&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.table_name.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Doğrulama Tipi *"}),a.jsxs("select",{...H("validation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),D.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),W.validation_type&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.validation_type.message})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alan Adı"}),a.jsx("input",{type:"text",...H("field_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Kontrol edilecek alan adı (opsiyonel)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kural Açıklaması *"}),a.jsx("textarea",{...H("rule_description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Doğrulama kuralının açıklaması..."}),W.rule_description&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:W.rule_description.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Detaylar"}),a.jsx("textarea",{...H("details"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ek detaylar ve açıklamalar..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Önerilen Eylem"}),a.jsx("textarea",{...H("suggested_action"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hata durumunda önerilen eylem..."})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>Y(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[a.jsx(s,{className:"h-4 w-4"}),q?"Güncelle":"Kaydet"]})]})]})]})]})}export{T as default};
