import{r as e,V as a,j as s,c as t,n as l,C as r,aw as i,ax as d,F as n,ay as c,ac as o,ad as h,ae as x,af as m,ag as j,D as u,i as p,y as g,T as y}from"../assets/index-C7XW2vnU.js";import{I as v,T as f,b as N,d as D,e as b}from"./tabs-CxUuqE8j.js";import{V as w}from"./index-DGkWrISs.js";import{R as T,B as k,C as A,X as C,Y as K,T as _,a as S,P as Y,b as E,c as R,x as B}from"./PieChart-DKeYt9dB.js";import{L as F,a as V}from"./LineChart-BA-LsgJe.js";function L(){const[L,M]=e.useState({monthlyAids:[],aidTypeDistribution:[],beneficiaryCategories:[],applicationTrends:[]}),[G,P]=e.useState({startDate:new Date((new Date).getFullYear(),0,1).toISOString().split("T")[0],endDate:(new Date).toISOString().split("T")[0],aidType:"all",category:"all"}),[W,I]=e.useState("overview"),O=e.useCallback(async()=>{try{const{data:e}=await a.from("aid_records").select("amount, created_at").gte("created_at",G.startDate).lte("created_at",G.endDate).eq("status","completed"),s=new Map;null==e||e.forEach(e=>{const a=new Date(e.created_at).toLocaleDateString("tr-TR",{year:"numeric",month:"short"});s.has(a)||s.set(a,{month:a,amount:0,count:0});const t=s.get(a);t.amount+=e.amount||0,t.count+=1});const{data:t}=await a.from("aid_records").select("aid_type").gte("created_at",G.startDate).lte("created_at",G.endDate),l=new Map;null==t||t.forEach(e=>{const a=e.aid_type;l.set(a,(l.get(a)||0)+1)});const r=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00"],i=Array.from(l.entries()).map(([e,a],s)=>({name:$(e),value:a,color:r[s%r.length]})),{data:d}=await a.from("beneficiaries").select("category").gte("created_at",G.startDate).lte("created_at",G.endDate),n=new Map;null==d||d.forEach(e=>{const a=e.category;n.set(a,(n.get(a)||0)+1)});const c=Array.from(n.entries()).map(([e,a])=>({category:q(e),count:a})),{data:o}=await a.from("applications").select("status, created_at").gte("created_at",G.startDate).lte("created_at",G.endDate),h=new Map;null==o||o.forEach(e=>{const a=new Date(e.created_at).toLocaleDateString("tr-TR",{month:"short",day:"numeric"});h.has(a)||h.set(a,{date:a,pending:0,approved:0,rejected:0});const s=h.get(a);"pending"===e.status?s.pending+=1:"approved"===e.status?s.approved+=1:"rejected"===e.status&&(s.rejected+=1)}),M({monthlyAids:Array.from(s.values()),aidTypeDistribution:i,beneficiaryCategories:c,applicationTrends:Array.from(h.values())})}catch(e){w.error("Rapor verileri yüklenirken hata oluştu")}},[G]);e.useEffect(()=>{O()},[O]);const $=e=>({cash:"Nakit",food:"Gıda",clothing:"Giyim",housing:"Barınma",health:"Sağlık",education:"Eğitim",other:"Diğer"}[e]||e),q=e=>({orphan:"Yetim",widow:"Dul",elderly:"Yaşlı",disabled:"Engelli",refugee:"Mülteci",other:"Diğer"}[e]||e);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Raporlar"}),s.jsx("p",{className:"text-muted-foreground",children:"Yardım ve başvuru istatistikleri"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(t,{variant:"outline",onClick:()=>{w.success("Rapor dışa aktarıldı")},children:[s.jsx(l,{className:"h-4 w-4 mr-2"}),"CSV"]}),s.jsxs(t,{variant:"outline",onClick:()=>{w.success("PDF raporu oluşturuldu")},children:[s.jsx(l,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),s.jsxs(r,{children:[s.jsx(i,{children:s.jsxs(d,{className:"flex items-center",children:[s.jsx(n,{className:"h-5 w-5 mr-2"}),"Filtreler"]})}),s.jsx(c,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),s.jsx(v,{type:"date",value:G.startDate,onChange:e=>P(a=>({...a,startDate:e.target.value}))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Bitiş Tarihi"}),s.jsx(v,{type:"date",value:G.endDate,onChange:e=>P(a=>({...a,endDate:e.target.value}))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Yardım Türü"}),s.jsxs(o,{value:G.aidType,onValueChange:e=>P(a=>({...a,aidType:e})),children:[s.jsx(h,{children:s.jsx(x,{})}),s.jsxs(m,{children:[s.jsx(j,{value:"all",children:"Tümü"}),s.jsx(j,{value:"cash",children:"Nakit"}),s.jsx(j,{value:"food",children:"Gıda"}),s.jsx(j,{value:"clothing",children:"Giyim"}),s.jsx(j,{value:"housing",children:"Barınma"}),s.jsx(j,{value:"health",children:"Sağlık"}),s.jsx(j,{value:"education",children:"Eğitim"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Kategori"}),s.jsxs(o,{value:G.category,onValueChange:e=>P(a=>({...a,category:e})),children:[s.jsx(h,{children:s.jsx(x,{})}),s.jsxs(m,{children:[s.jsx(j,{value:"all",children:"Tümü"}),s.jsx(j,{value:"orphan",children:"Yetim"}),s.jsx(j,{value:"widow",children:"Dul"}),s.jsx(j,{value:"elderly",children:"Yaşlı"}),s.jsx(j,{value:"disabled",children:"Engelli"}),s.jsx(j,{value:"refugee",children:"Mülteci"})]})]})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx(r,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(u,{className:"h-6 w-6 text-blue-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Toplam Yardım"}),s.jsxs("p",{className:"text-2xl font-bold",children:[L.monthlyAids.reduce((e,a)=>e+a.amount,0).toLocaleString("tr-TR")," ₺"]})]})]})})}),s.jsx(r,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(p,{className:"h-6 w-6 text-green-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Alan"}),s.jsx("p",{className:"text-2xl font-bold",children:L.monthlyAids.reduce((e,a)=>e+a.count,0)})]})]})})}),s.jsx(r,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:s.jsx(g,{className:"h-6 w-6 text-purple-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Türü"}),s.jsx("p",{className:"text-2xl font-bold",children:L.aidTypeDistribution.length})]})]})})}),s.jsx(r,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:s.jsx(y,{className:"h-6 w-6 text-orange-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ortalama"}),s.jsxs("p",{className:"text-2xl font-bold",children:[L.monthlyAids.length>0?(L.monthlyAids.reduce((e,a)=>e+a.amount,0)/L.monthlyAids.length).toLocaleString("tr-TR",{maximumFractionDigits:0}):0," ₺"]})]})]})})})]}),s.jsxs(f,{value:W,onValueChange:I,children:[s.jsxs(N,{className:"grid w-full grid-cols-4",children:[s.jsx(D,{value:"overview",children:"Genel Bakış"}),s.jsx(D,{value:"monthly",children:"Aylık Trend"}),s.jsx(D,{value:"distribution",children:"Dağılım"}),s.jsx(D,{value:"applications",children:"Başvurular"})]}),s.jsx(b,{value:"overview",className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"Aylık Yardım Dağılımı"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:300,children:s.jsxs(k,{data:L.monthlyAids,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(C,{dataKey:"month"}),s.jsx(K,{}),s.jsx(_,{}),s.jsx(S,{dataKey:"amount",fill:"#8884d8"})]})})})]}),s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"Yardım Türü Dağılımı"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:300,children:s.jsxs(Y,{children:[s.jsx(E,{data:L.aidTypeDistribution,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:e,percent:a})=>`${e} ${(100*a).toFixed(0)}%`,children:L.aidTypeDistribution.map((e,a)=>s.jsx(R,{fill:e.color},`cell-${a}`))}),s.jsx(_,{})]})})})]})]})}),s.jsx(b,{value:"monthly",className:"space-y-6",children:s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"Aylık Yardım Trendi"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:400,children:s.jsxs(F,{data:L.monthlyAids,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(C,{dataKey:"month"}),s.jsx(K,{}),s.jsx(_,{}),s.jsx(B,{}),s.jsx(V,{type:"monotone",dataKey:"amount",stroke:"#8884d8",strokeWidth:2}),s.jsx(V,{type:"monotone",dataKey:"count",stroke:"#82ca9d",strokeWidth:2})]})})})]})}),s.jsx(b,{value:"distribution",className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"İhtiyaç Sahibi Kategorileri"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:300,children:s.jsxs(k,{data:L.beneficiaryCategories,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(C,{dataKey:"category"}),s.jsx(K,{}),s.jsx(_,{}),s.jsx(S,{dataKey:"count",fill:"#82ca9d"})]})})})]}),s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"Yardım Türü Detayı"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:300,children:s.jsxs(k,{data:L.aidTypeDistribution,layout:"horizontal",children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(C,{type:"number"}),s.jsx(K,{dataKey:"name",type:"category"}),s.jsx(_,{}),s.jsx(S,{dataKey:"value",fill:"#8884d8"})]})})})]})]})}),s.jsx(b,{value:"applications",className:"space-y-6",children:s.jsxs(r,{children:[s.jsx(i,{children:s.jsx(d,{children:"Başvuru Trendleri"})}),s.jsx(c,{children:s.jsx(T,{width:"100%",height:400,children:s.jsxs(F,{data:L.applicationTrends,children:[s.jsx(A,{strokeDasharray:"3 3"}),s.jsx(C,{dataKey:"date"}),s.jsx(K,{}),s.jsx(_,{}),s.jsx(B,{}),s.jsx(V,{type:"monotone",dataKey:"pending",stroke:"#ffc658",strokeWidth:2}),s.jsx(V,{type:"monotone",dataKey:"approved",stroke:"#82ca9d",strokeWidth:2}),s.jsx(V,{type:"monotone",dataKey:"rejected",stroke:"#ff7300",strokeWidth:2})]})})})]})})]})]})}export{L as default};
