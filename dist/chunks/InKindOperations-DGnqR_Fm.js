import{t as e,r as t,V as a,j as s,e as i,an as r,aB as l,k as n,S as o,n as d,X as c,a9 as m,q as u,aj as x}from"../assets/index-dW79Uy5k.js";import{e as p}from"./exportToCsv-DLkyd1nM.js";import{D as h}from"./DataTable-Co2fK-v0.js";import{M as y}from"./Modal-BBek2lFh.js";import{S as b}from"./StatCard-CRbncoUZ.js";import{u as g,t as j,o as v,s as f,n as _,e as N}from"./types-DWSxFkmy.js";import{V as k}from"./index-BPtWanD8.js";import{E as w}from"./eye-C2ZiGWXh.js";import{P as S}from"./pen-square-DLfSiTnY.js";const D=e("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),C=e("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]),T=v({operation_type:N(["received","distributed","transferred","returned"],{message:"İşlem türü seçiniz"}),item_name:f().min(1,"Ürün adı giriniz"),item_category:f().min(1,"Kategori seçiniz"),quantity:_().min(1,"Miktar giriniz"),unit:f().min(1,"Birim seçiniz"),unit_value:_().optional(),source:f().optional(),destination:f().optional(),beneficiary_id:f().optional(),warehouse_location:f().min(1,"Depo konumu giriniz"),expiry_date:f().optional(),notes:f().optional()}),A=["Gıda","Giyim","Temizlik","Kırtasiye","Oyuncak","Ev Eşyası","Elektronik","Kitap","Diğer"],q=["Adet","Kg","Gram","Litre","Paket","Kutu","Çuval","Koli"],z=["Ana Depo - A Blok","Ana Depo - B Blok","Ana Depo - C Blok","Şube Depo 1","Şube Depo 2","Soğuk Hava Deposu"];function B(){const[e,v]=t.useState([]),[f,_]=t.useState({totalReceived:0,totalDistributed:0,currentStock:0,todayOperations:0}),[N,B]=t.useState(!0),[K,M]=t.useState(""),[E,L]=t.useState("all"),[Y,H]=t.useState("all"),[R,V]=t.useState("all"),[F,G]=t.useState("all"),[O,I]=t.useState(!1),[P,$]=t.useState(null),[U,W]=t.useState([]),{register:Z,handleSubmit:J,formState:{errors:Q},reset:X,watch:ee}=g({resolver:j(T)}),te=ee("operation_type"),ae=ee("quantity"),se=ee("unit_value");t.useEffect(()=>{},[ae,se]),t.useEffect(()=>{ie(),re(),le()},[]);const ie=async()=>{try{const{data:e,error:t}=await a.from("in_kind_aids").select("\n          *,\n          beneficiaries (\n            name,\n            surname,\n            category\n          )\n        ").order("created_at",{ascending:!1});if(t)throw t;const s=(null==e?void 0:e.map(e=>({id:e.id,operation_type:"distributed",item_name:e.item_name,item_category:e.item_category,quantity:e.quantity,unit:e.unit,unit_value:e.unit_value,total_value:e.total_value,beneficiary_id:e.beneficiary_id,warehouse_location:e.warehouse_location||"Ana Depo - A Blok",expiry_date:e.expiry_date,operation_date:e.distributed_at||e.created_at,status:"distributed"===e.status?"completed":"pending",notes:e.notes,created_at:e.created_at,operator_id:"user1",beneficiaries:e.beneficiaries,operator:{name:"Admin User",email:"admin@example.com"}})))||[];v(s)}catch(e){k.error("Ayni yardım işlemleri yüklenirken hata oluştu")}finally{B(!1)}},re=async()=>{try{const{data:e}=await a.from("in_kind_aids").select("quantity, total_value, status");if(e){const t=e.reduce((e,t)=>e+(t.quantity||0),0),a=e.filter(e=>"distributed"===e.status).reduce((e,t)=>e+(t.quantity||0),0),s=t-a,i=e.filter(e=>{const t=new Date(e.created_at||""),a=new Date;return t.toDateString()===a.toDateString()}).length;_({totalReceived:t,totalDistributed:a,currentStock:s,todayOperations:i})}}catch(e){}},le=async()=>{try{const{data:e,error:t}=await a.from("beneficiaries").select("id, name, surname, category").eq("status","active").order("name");if(t)throw t;W(e||[])}catch(e){}},ne=t.useMemo(()=>e.filter(e=>{const t=""===K||e.item_name.toLowerCase().includes(K.toLowerCase())||e.item_category.toLowerCase().includes(K.toLowerCase())||e.warehouse_location.toLowerCase().includes(K.toLowerCase()),a="all"===E||e.operation_type===E,s="all"===Y||e.item_category===Y,i="all"===R||e.status===R;let r=!0;if("all"!==F){const t=new Date(e.operation_date),a=new Date;switch(F){case"today":r=t.toDateString()===a.toDateString();break;case"week":r=t>=new Date(a.getTime()-6048e5);break;case"month":r=t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear()}}return t&&a&&s&&i&&r}),[e,K,E,Y,R,F]),oe=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(e),de=e=>new Date(e).toLocaleDateString("tr-TR"),ce=[{key:"operation_type",header:"İşlem Türü",render:(e,t)=>(e=>{const t={received:{label:"Alındı",class:"bg-green-100 text-green-800",icon:r},distributed:{label:"Dağıtıldı",class:"bg-blue-100 text-blue-800",icon:l},transferred:{label:"Transfer",class:"bg-purple-100 text-purple-800",icon:C},returned:{label:"İade",class:"bg-orange-100 text-orange-800",icon:D}}[e]||{label:e,class:"bg-gray-100 text-gray-800",icon:r},a=t.icon;return s.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[s.jsx(a,{className:"h-3 w-3"}),t.label]})})(t.operation_type)},{key:"item_info",header:"Ürün Bilgisi",render:(e,t)=>s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:t.item_name}),s.jsx("div",{className:"text-sm text-muted-foreground",children:t.item_category})]})},{key:"quantity",header:"Miktar",render:(e,t)=>s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium",children:[t.quantity," ",t.unit]}),t.unit_value&&s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Birim: ",oe(t.unit_value)]})]})},{key:"total_value",header:"Toplam Değer",render:(e,t)=>s.jsx("div",{className:"font-medium text-green-600",children:oe(t.total_value)})},{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(e,t)=>s.jsx("div",{children:t.beneficiaries?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"font-medium",children:[t.beneficiaries.name," ",t.beneficiaries.surname]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:t.beneficiaries.category})]}):s.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"warehouse_location",header:"Depo Konumu",render:(e,t)=>s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-3 w-3 text-muted-foreground"}),s.jsx("span",{className:"text-sm",children:t.warehouse_location})]})},{key:"operation_date",header:"İşlem Tarihi",render:(e,t)=>de(t.operation_date)},{key:"expiry_date",header:"Son Kullanma",render:(e,t)=>t.expiry_date?de(t.expiry_date):"-"},{key:"status",header:"Durum",render:(e,t)=>(e=>{const t={pending:{label:"Beklemede",class:"bg-yellow-100 text-yellow-800",icon:u},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:m},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:c}}[e]||{label:e,class:"bg-gray-100 text-gray-800",icon:m},a=t.icon;return s.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${t.class}`,children:[s.jsx(a,{className:"h-3 w-3"}),t.label]})})(t.status)},{key:"actions",header:"İşlemler",render:(e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:s.jsx(w,{className:"h-4 w-4"})}),"pending"===t.status&&s.jsx("button",{onClick:()=>{$(t),I(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:s.jsx(S,{className:"h-4 w-4"})})]})}];return N?s.jsx("div",{className:"flex h-64 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),s.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Ayni Yardım İşlemleri"}),s.jsx("p",{className:"text-muted-foreground",children:"Ayni yardım işlemlerini kaydedin ve takip edin"})]}),s.jsxs("button",{onClick:()=>{$(null),I(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[s.jsx(i,{className:"h-4 w-4"}),"Yeni İşlem"]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[s.jsx(b,{title:"Toplam Alınan",value:f.totalReceived.toString(),icon:r,accentClass:"bg-green-100"}),s.jsx(b,{title:"Toplam Dağıtılan",value:f.totalDistributed.toString(),icon:l,accentClass:"bg-blue-100"}),s.jsx(b,{title:"Mevcut Stok",value:f.currentStock.toString(),icon:C,accentClass:"bg-purple-100"}),s.jsx(b,{title:"Bugünkü İşlemler",value:f.todayOperations.toString(),icon:n,accentClass:"bg-orange-100"})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(o,{className:"h-4 w-4 text-muted-foreground"}),s.jsx("input",{type:"text",placeholder:"İşlem ara...",value:K,onChange:e=>M(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),s.jsxs("select",{value:E,onChange:e=>L(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"all",children:"Tüm İşlem Türleri"}),s.jsx("option",{value:"received",children:"Alınan"}),s.jsx("option",{value:"distributed",children:"Dağıtılan"}),s.jsx("option",{value:"transferred",children:"Transfer"}),s.jsx("option",{value:"returned",children:"İade"})]}),s.jsxs("select",{value:Y,onChange:e=>H(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"all",children:"Tüm Kategoriler"}),A.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{value:R,onChange:e=>V(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"all",children:"Tüm Durumlar"}),s.jsx("option",{value:"pending",children:"Bekleyen"}),s.jsx("option",{value:"completed",children:"Tamamlanan"}),s.jsx("option",{value:"cancelled",children:"İptal Edilen"})]}),s.jsxs("select",{value:F,onChange:e=>G(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"all",children:"Tüm Tarihler"}),s.jsx("option",{value:"today",children:"Bugün"}),s.jsx("option",{value:"week",children:"Bu Hafta"}),s.jsx("option",{value:"month",children:"Bu Ay"})]}),s.jsxs("button",{onClick:()=>p("ayni-yardim-islemleri.csv",ne),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[s.jsx(d,{className:"h-4 w-4"}),"İndir"]}),s.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[ne.length," işlem"]})]}),s.jsx(h,{columns:ce,data:ne}),s.jsxs(y,{open:O,onClose:()=>I(!1),children:[s.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[s.jsx("h2",{className:"text-lg font-semibold",children:P?"İşlem Düzenle":"Yeni Ayni Yardım İşlemi"}),s.jsx("button",{onClick:()=>I(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),s.jsxs("form",{onSubmit:J(async e=>{try{const t=(e.quantity||0)*(e.unit_value||0),{error:s}=await a.from("in_kind_aids").insert({beneficiary_id:e.beneficiary_id,item_name:e.item_name,item_category:e.item_category,quantity:e.quantity,unit:e.unit,unit_value:e.unit_value,total_value:t,warehouse_location:e.warehouse_location,expiry_date:e.expiry_date,status:"pending",notes:e.notes});if(s)throw s;k.success("Ayni yardım işlemi başarıyla kaydedildi"),I(!1),X(),ie(),re()}catch(t){k.error("Ayni yardım işlemi kaydedilirken hata oluştu")}}),className:"p-4 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"İşlem Türü *"}),s.jsxs("select",{...Z("operation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seçiniz..."}),s.jsx("option",{value:"received",children:"Alındı"}),s.jsx("option",{value:"distributed",children:"Dağıtıldı"}),s.jsx("option",{value:"transferred",children:"Transfer"}),s.jsx("option",{value:"returned",children:"İade"})]}),Q.operation_type&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.operation_type.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Kategorisi *"}),s.jsxs("select",{...Z("item_category"),className:"w-full rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seçiniz..."}),A.map(e=>s.jsx("option",{value:e,children:e},e))]}),Q.item_category&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.item_category.message})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Adı *"}),s.jsx("input",{type:"text",...Z("item_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürün adını giriniz"}),Q.item_name&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.item_name.message})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Miktar *"}),s.jsx("input",{type:"number",...Z("quantity",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0"}),Q.quantity&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.quantity.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim *"}),s.jsxs("select",{...Z("unit"),className:"w-full rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seçiniz..."}),q.map(e=>s.jsx("option",{value:e,children:e},e))]}),Q.unit&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.unit.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim Değer"}),s.jsx("input",{type:"number",step:"0.01",...Z("unit_value",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0.00"})]})]}),("distributed"===te||"transferred"===te)&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"distributed"===te?"İhtiyaç Sahibi":"Hedef"}),"distributed"===te?s.jsxs("select",{...Z("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seçiniz..."}),U.map(e=>s.jsxs("option",{value:e.id,children:[e.name," ",e.surname," - ",e.category]},e.id))]}):s.jsx("input",{type:"text",...Z("destination"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hedef konum"})]}),"received"===te&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kaynak"}),s.jsx("input",{type:"text",...Z("source"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürünün geldiği yer"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Depo Konumu *"}),s.jsxs("select",{...Z("warehouse_location"),className:"w-full rounded border px-3 py-2 text-sm",children:[s.jsx("option",{value:"",children:"Seçiniz..."}),z.map(e=>s.jsx("option",{value:e,children:e},e))]}),Q.warehouse_location&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:Q.warehouse_location.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Son Kullanma Tarihi"}),s.jsx("input",{type:"date",...Z("expiry_date"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),s.jsx("textarea",{...Z("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İşlem ile ilgili notlar..."})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx("button",{type:"button",onClick:()=>I(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),s.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[s.jsx(i,{className:"h-4 w-4"}),P?"Güncelle":"Kaydet"]})]})]})]})]})}export{B as default};
