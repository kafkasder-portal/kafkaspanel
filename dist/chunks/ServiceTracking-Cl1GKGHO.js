import{r as e,V as s,j as a,e as t,i,q as l,p as r,S as n,n as d,P as o,U as c,aj as m,X as x,k as u}from"../assets/index-dW79Uy5k.js";import{e as p}from"./exportToCsv-DLkyd1nM.js";import{D as h}from"./DataTable-Co2fK-v0.js";import{M as g}from"./Modal-BBek2lFh.js";import{S as j}from"./StatCard-CRbncoUZ.js";import{u as v,t as b,o as y,s as f,e as k}from"./types-DWSxFkmy.js";import{V as N}from"./index-BPtWanD8.js";import{A as _}from"./alert-circle-CBPaGutZ.js";import{E as w}from"./eye-C2ZiGWXh.js";import{P as D}from"./pen-square-DLfSiTnY.js";const z=y({beneficiary_id:f().min(1,"İhtiyaç sahibi seçiniz"),service_type:f().min(1,"Hizmet türü seçiniz"),service_category:f().min(1,"Hizmet kategorisi seçiniz"),description:f().min(1,"Açıklama giriniz"),assigned_to:f().optional(),start_date:f().min(1,"Başlangıç tarihi seçiniz"),expected_completion:f().optional(),priority:k(["low","medium","high","urgent"],{message:"Öncelik seçiniz"}),location:f().optional(),contact_person:f().optional(),contact_phone:f().optional(),notes:f().optional()}),S=["Ev Ziyareti","Sağlık Hizmeti","Eğitim Desteği","Hukuki Danışmanlık","Psikolojik Destek","Mesleki Eğitim","İş Bulma Desteği","Ev Onarımı","Temizlik Hizmeti","Ulaşım Desteği","Tercümanlık","Diğer"],H={"Ev Ziyareti":["Durum Tespiti","Takip Ziyareti","Kontrol Ziyareti"],"Sağlık Hizmeti":["Doktor Randevusu","Hastane Sevki","İlaç Desteği","Tıbbi Malzeme"],"Eğitim Desteği":["Okul Kaydı","Ders Desteği","Kırtasiye Yardımı","Okul Servisi"],"Hukuki Danışmanlık":["Hukuki Bilgilendirme","Dava Takibi","Belge Düzenleme"],"Psikolojik Destek":["Bireysel Görüşme","Grup Terapisi","Aile Danışmanlığı"],"Mesleki Eğitim":["Kurs Kaydı","Sertifika Programı","Staj Desteği"],"İş Bulma Desteği":["İş Arama","Mülakat Hazırlığı","CV Hazırlama"],"Ev Onarımı":["Elektrik","Su Tesisatı","Boyama","Genel Onarım"],"Temizlik Hizmeti":["Genel Temizlik","Dezenfeksiyon","Bahçe Bakımı"],"Ulaşım Desteği":["Hastane Ulaşımı","Okul Ulaşımı","Resmi Kurum Ulaşımı"],"Tercümanlık":["Resmi Kurum","Hastane","Okul","Hukuki İşlemler"],"Diğer":["Özel Durum"]},T=[{id:"user1",name:"Ahmet Yılmaz",email:"ahmet@example.com"},{id:"user2",name:"Fatma Demir",email:"fatma@example.com"},{id:"user3",name:"Mehmet Kaya",email:"mehmet@example.com"},{id:"user4",name:"Ayşe Öztürk",email:"ayse@example.com"}];function C(){var y;const[f,k]=e.useState([]),[C,A]=e.useState({totalServices:0,inProgress:0,completed:0,overdue:0}),[K,B]=e.useState(!0),[E,O]=e.useState(""),[Y,P]=e.useState("all"),[L,M]=e.useState("all"),[I,G]=e.useState("all"),[R,U]=e.useState("all"),[V,F]=e.useState(!1),[Z,$]=e.useState(null),[q,J]=e.useState([]),{register:Q,handleSubmit:W,formState:{errors:X},reset:ee,watch:se}=v({resolver:b(z)}),ae=se("service_type");e.useEffect(()=>{te(),ie(),le()},[]);const te=async()=>{try{const e=[{id:"1",beneficiary_id:"ben1",service_type:"Ev Ziyareti",service_category:"Durum Tespiti",description:"Ailenin mevcut durumunu tespit etmek için ev ziyareti",assigned_to:"user1",start_date:(new Date).toISOString(),expected_completion:new Date(Date.now()+6048e5).toISOString(),status:"in_progress",priority:"high",location:"Ankara, Çankaya",contact_person:"Ahmet Yılmaz",contact_phone:"0532 123 45 67",progress_percentage:60,notes:"İlk ziyaret tamamlandı, takip ziyareti planlandı",created_at:(new Date).toISOString(),beneficiaries:{name:"Ali",surname:"Veli",phone:"0533 987 65 43",category:"Aile",address:"Ankara, Çankaya"},assigned_user:{name:"Ahmet Yılmaz",email:"ahmet@example.com"}},{id:"2",beneficiary_id:"ben2",service_type:"Sağlık Hizmeti",service_category:"Doktor Randevusu",description:"Kardiyoloji kontrolü için doktor randevusu alınması",assigned_to:"user2",start_date:new Date(Date.now()-1728e5).toISOString(),end_date:(new Date).toISOString(),status:"completed",priority:"medium",location:"Ankara Şehir Hastanesi",contact_person:"Fatma Demir",contact_phone:"0534 567 89 01",progress_percentage:100,notes:"Randevu alındı ve hasta muayene edildi",created_at:new Date(Date.now()-432e6).toISOString(),beneficiaries:{name:"Ayşe",surname:"Kaya",phone:"0535 123 45 67",category:"Yaşlı",address:"Ankara, Keçiören"},assigned_user:{name:"Fatma Demir",email:"fatma@example.com"}}];k(e)}catch(e){N.error("Hizmet takip kayıtları yüklenirken hata oluştu")}finally{B(!1)}},ie=async()=>{try{A({totalServices:25,inProgress:8,completed:15,overdue:2})}catch(e){}},le=async()=>{try{const{data:e,error:a}=await s.from("beneficiaries").select("id, name, surname, category, phone, address").eq("status","active").order("name");if(a)throw a;J(e||[])}catch(e){}},re=e.useMemo(()=>f.filter(e=>{var s,a,t;const i=""===E||`${null==(s=e.beneficiaries)?void 0:s.name} ${null==(a=e.beneficiaries)?void 0:a.surname}`.toLowerCase().includes(E.toLowerCase())||e.service_type.toLowerCase().includes(E.toLowerCase())||e.description.toLowerCase().includes(E.toLowerCase())||(null==(t=e.location)?void 0:t.toLowerCase().includes(E.toLowerCase())),l="all"===Y||e.service_type===Y,r="all"===L||e.status===L,n="all"===I||e.priority===I,d="all"===R||e.assigned_to===R;return i&&l&&r&&n&&d}),[f,E,Y,L,I,R]),ne=e=>{const s={planned:{label:"Planlandı",class:"bg-blue-100 text-blue-800",icon:u},in_progress:{label:"Devam Ediyor",class:"bg-yellow-100 text-yellow-800",icon:l},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:r},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:x},on_hold:{label:"Beklemede",class:"bg-gray-100 text-gray-800",icon:_}}[e]||{label:e,class:"bg-gray-100 text-gray-800",icon:_},t=s.icon;return a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:[a.jsx(t,{className:"h-3 w-3"}),s.label]})},de=e=>new Date(e).toLocaleDateString("tr-TR"),oe=e=>!(!e.expected_completion||"completed"===e.status)&&new Date(e.expected_completion)<new Date,ce=[{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(e,s)=>{var t,i,l,r;return a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium",children:[null==(t=s.beneficiaries)?void 0:t.name," ",null==(i=s.beneficiaries)?void 0:i.surname]}),a.jsx("div",{className:"text-sm text-muted-foreground",children:null==(l=s.beneficiaries)?void 0:l.category}),(null==(r=s.beneficiaries)?void 0:r.phone)&&a.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[a.jsx(o,{className:"h-3 w-3"}),s.beneficiaries.phone]})]})}},{key:"service_info",header:"Hizmet Bilgisi",render:(e,s)=>a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:s.service_type}),a.jsx("div",{className:"text-sm text-muted-foreground",children:s.service_category}),a.jsx("div",{className:"text-xs text-muted-foreground mt-1 max-w-xs truncate",title:s.description,children:s.description})]})},{key:"assigned_user",header:"Atanan Kişi",render:(e,s)=>a.jsx("div",{children:s.assigned_user?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"font-medium flex items-center gap-1",children:[a.jsx(c,{className:"h-3 w-3"}),s.assigned_user.name]}),a.jsx("div",{className:"text-xs text-muted-foreground",children:s.assigned_user.email})]}):a.jsx("span",{className:"text-muted-foreground",children:"Atanmamış"})})},{key:"priority",header:"Öncelik",render:(e,s)=>(e=>{const s={low:{label:"Düşük",class:"bg-gray-100 text-gray-800"},medium:{label:"Orta",class:"bg-blue-100 text-blue-800"},high:{label:"Yüksek",class:"bg-orange-100 text-orange-800"},urgent:{label:"Acil",class:"bg-red-100 text-red-800"}}[e]||{label:e,class:"bg-gray-100 text-gray-800"};return a.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:s.label})})(s.priority)},{key:"status",header:"Durum",render:(e,s)=>a.jsxs("div",{children:[ne(s.status),"in_progress"===s.status&&a.jsxs("div",{className:"mt-1",children:[a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:a.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${s.progress_percentage}%`}})}),a.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["%",s.progress_percentage]})]})]})},{key:"dates",header:"Tarihler",render:(e,s)=>a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm",children:[a.jsx("strong",{children:"Başlangıç:"})," ",de(s.start_date)]}),s.expected_completion&&a.jsxs("div",{className:"text-sm "+(oe(s)?"text-red-600 font-medium":"text-muted-foreground"),children:[a.jsx("strong",{children:"Bitiş:"})," ",de(s.expected_completion),oe(s)&&a.jsx("span",{className:"ml-1",children:"(Gecikmiş)"})]}),s.end_date&&a.jsxs("div",{className:"text-sm text-green-600",children:[a.jsx("strong",{children:"Tamamlandı:"})," ",de(s.end_date)]})]})},{key:"location",header:"Konum",render:(e,s)=>a.jsx("div",{children:s.location?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(m,{className:"h-3 w-3 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:s.location})]}):a.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"actions",header:"İşlemler",render:(e,s)=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:a.jsx(w,{className:"h-4 w-4"})}),"completed"!==s.status&&"cancelled"!==s.status&&a.jsx("button",{onClick:()=>{$(s),F(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:a.jsx(D,{className:"h-4 w-4"})})]})}];return K?a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),a.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Hizmet Takip İşlemleri"}),a.jsx("p",{className:"text-muted-foreground",children:"Verilen hizmetleri takip edin ve yönetin"})]}),a.jsxs("button",{onClick:()=>{$(null),F(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[a.jsx(t,{className:"h-4 w-4"}),"Yeni Hizmet"]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[a.jsx(j,{title:"Toplam Hizmetler",value:C.totalServices.toString(),icon:i,accentClass:"bg-blue-100"}),a.jsx(j,{title:"Devam Eden",value:C.inProgress.toString(),icon:l,accentClass:"bg-yellow-100"}),a.jsx(j,{title:"Tamamlanan",value:C.completed.toString(),icon:r,accentClass:"bg-green-100"}),a.jsx(j,{title:"Geciken",value:C.overdue.toString(),icon:_,accentClass:"bg-red-100"})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(n,{className:"h-4 w-4 text-muted-foreground"}),a.jsx("input",{type:"text",placeholder:"Hizmet ara...",value:E,onChange:e=>O(e.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),a.jsxs("select",{value:Y,onChange:e=>P(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Hizmet Türleri"}),S.map(e=>a.jsx("option",{value:e,children:e},e))]}),a.jsxs("select",{value:L,onChange:e=>M(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Durumlar"}),a.jsx("option",{value:"planned",children:"Planlandı"}),a.jsx("option",{value:"in_progress",children:"Devam Ediyor"}),a.jsx("option",{value:"completed",children:"Tamamlandı"}),a.jsx("option",{value:"cancelled",children:"İptal Edildi"}),a.jsx("option",{value:"on_hold",children:"Beklemede"})]}),a.jsxs("select",{value:I,onChange:e=>G(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Öncelikler"}),a.jsx("option",{value:"low",children:"Düşük"}),a.jsx("option",{value:"medium",children:"Orta"}),a.jsx("option",{value:"high",children:"Yüksek"}),a.jsx("option",{value:"urgent",children:"Acil"})]}),a.jsxs("select",{value:R,onChange:e=>U(e.target.value),className:"rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"all",children:"Tüm Atananlar"}),T.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),a.jsxs("button",{onClick:()=>p("hizmet-takip.csv",re),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[a.jsx(d,{className:"h-4 w-4"}),"İndir"]}),a.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[re.length," hizmet"]})]}),a.jsx(h,{columns:ce,data:re}),a.jsxs(g,{open:V,onClose:()=>F(!1),children:[a.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[a.jsx("h2",{className:"text-lg font-semibold",children:Z?"Hizmet Düzenle":"Yeni Hizmet Takibi"}),a.jsx("button",{onClick:()=>F(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),a.jsxs("form",{onSubmit:W(async e=>{try{const s={id:Date.now().toString(),...e,status:"planned",progress_percentage:0,created_at:(new Date).toISOString(),beneficiaries:q.find(s=>s.id===e.beneficiary_id),assigned_user:T.find(s=>s.id===e.assigned_to)};k(e=>[s,...e]),N.success("Hizmet takip kaydı başarıyla oluşturuldu"),F(!1),ee(),ie()}catch(s){N.error("Hizmet takip kaydı oluşturulurken hata oluştu")}}),className:"p-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"İhtiyaç Sahibi *"}),a.jsxs("select",{...Q("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),q.map(e=>a.jsxs("option",{value:e.id,children:[e.name," ",e.surname," - ",e.category]},e.id))]}),X.beneficiary_id&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.beneficiary_id.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Türü *"}),a.jsxs("select",{...Q("service_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),S.map(e=>a.jsx("option",{value:e,children:e},e))]}),X.service_type&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.service_type.message})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Kategorisi *"}),a.jsxs("select",{...Q("service_category"),className:"w-full rounded border px-3 py-2 text-sm",disabled:!ae,children:[a.jsx("option",{value:"",children:"Seçiniz..."}),ae&&(null==(y=H[ae])?void 0:y.map(e=>a.jsx("option",{value:e,children:e},e)))]}),X.service_category&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.service_category.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Öncelik *"}),a.jsxs("select",{...Q("priority"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),a.jsx("option",{value:"low",children:"Düşük"}),a.jsx("option",{value:"medium",children:"Orta"}),a.jsx("option",{value:"high",children:"Yüksek"}),a.jsx("option",{value:"urgent",children:"Acil"})]}),X.priority&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.priority.message})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Açıklama *"}),a.jsx("textarea",{...Q("description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet açıklaması..."}),X.description&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.description.message})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Atanan Kişi"}),a.jsxs("select",{...Q("assigned_to"),className:"w-full rounded border px-3 py-2 text-sm",children:[a.jsx("option",{value:"",children:"Seçiniz..."}),T.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Konum"}),a.jsx("input",{type:"text",...Q("location"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet konumu"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Başlangıç Tarihi *"}),a.jsx("input",{type:"date",...Q("start_date"),className:"w-full rounded border px-3 py-2 text-sm"}),X.start_date&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:X.start_date.message})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beklenen Bitiş Tarihi"}),a.jsx("input",{type:"date",...Q("expected_completion"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Kişisi"}),a.jsx("input",{type:"text",...Q("contact_person"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İletişim kişisi adı"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Telefonu"}),a.jsx("input",{type:"tel",...Q("contact_phone"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0532 123 45 67"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),a.jsx("textarea",{...Q("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet ile ilgili notlar..."})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>F(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),a.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[a.jsx(t,{className:"h-4 w-4"}),Z?"Güncelle":"Kaydet"]})]})]})]})]})}export{C as default};
