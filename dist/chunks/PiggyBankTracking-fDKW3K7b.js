import{r as e,j as a}from"../assets/index-dW79Uy5k.js";import{D as t}from"./DataTable-Co2fK-v0.js";import{M as s}from"./Modal-BBek2lFh.js";import{M as l,T as n,a as r,P as i,L as o}from"./leaflet-D_ENIaWh.js";import{L as d}from"./LazyQRScannerModal-B3E-EzM9.js";import{g as c,a as m,b as x}from"./qrCodeUtils-EWtYda1B.js";import{e as u}from"./exportToCsv-DLkyd1nM.js";import{Q as h}from"./qr-code-6ryxGMhx.js";delete o.Icon.Default.prototype._getIconUrl,o.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const p=({isOpen:t,onClose:o,address:d,bankNumber:c,assignedTo:m})=>{const[x,u]=e.useState(null),[h,p]=e.useState(!1),[g,b]=e.useState(null);return e.useEffect(()=>{t&&d&&(p(!0),b(null),(async e=>{try{const a=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1`),t=await a.json();return t&&t.length>0?{lat:parseFloat(t[0].lat),lng:parseFloat(t[0].lon)}:null}catch(a){return null}})(d).then(e=>{e?u(e):b("Adres bulunamadı")}).catch(()=>{b("Adres aranırken hata oluştu")}).finally(()=>{p(!1)}))},[t,d]),a.jsx(s,{isOpen:t,onClose:o,title:`Harita - ${c}`,size:"large",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Kumbara:"}),a.jsx("span",{className:"ml-2 font-medium",children:c})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Atanan Yer:"}),a.jsx("span",{className:"ml-2 font-medium",children:m})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("span",{className:"text-gray-600",children:"Adres:"}),a.jsx("span",{className:"ml-2 font-medium",children:d})]})]})}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("button",{onClick:()=>{if(x){const e=`https://www.google.com/maps/dir/?api=1&destination=${x.lat},${x.lng}`;window.open(e,"_blank")}else{const e=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[a.jsx("span",{children:"🗺️"}),"Google Maps'te Rota"]}),a.jsxs("button",{onClick:()=>{if(x){const e=`https://maps.apple.com/?daddr=${x.lat},${x.lng}`;window.open(e,"_blank")}else{const e=`https://maps.apple.com/?daddr=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 flex items-center gap-2",children:[a.jsx("span",{children:"🍎"}),"Apple Maps'te Rota"]}),a.jsxs("button",{onClick:()=>{if(x){const e=`https://yandex.com.tr/maps/?rtext=~${x.lat},${x.lng}&rtt=auto`;window.open(e,"_blank")}else{const e=`https://yandex.com.tr/maps/?text=${encodeURIComponent(d)}`;window.open(e,"_blank")}},className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center gap-2",children:[a.jsx("span",{children:"🔍"}),"Yandex Maps'te Rota"]})]}),a.jsxs("div",{className:"h-96 border rounded-lg overflow-hidden",children:[h&&a.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-600",children:"Adres aranıyor..."})]})}),g&&a.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-red-600 mb-2",children:g}),a.jsx("p",{className:"text-sm text-gray-500",children:"Rota butonlarını kullanarak harici harita uygulamalarında açabilirsiniz."})]})}),x&&!h&&!g&&a.jsxs(l,{center:[x.lat,x.lng],zoom:15,style:{height:"100%",width:"100%"},children:[a.jsx(n,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a.jsx(r,{position:[x.lat,x.lng],children:a.jsx(i,{children:a.jsxs("div",{className:"text-center",children:[a.jsx("strong",{children:c}),a.jsx("br",{}),m,a.jsx("br",{}),a.jsx("small",{children:d})]})})})]})]}),a.jsxs("div",{className:"text-xs text-gray-500 bg-blue-50 p-3 rounded",children:["💡 ",a.jsx("strong",{children:"İpucu:"})," Rota butonlarını kullanarak tercih ettiğiniz harita uygulamasında navigasyon başlatabilirsiniz."]})]})})},g=({isOpen:t,onClose:l,bank:n})=>{const{bankNumber:r,id:i,assignedTo:o,location:d,qrCode:x}=n||{},[u,h]=e.useState(null),[p,g]=e.useState(!1),[b,j]=e.useState(null),y=e.useCallback(async()=>{if(r&&i){g(!0),j(null);try{if(x)h(x);else{const e=c({bankNumber:r,assignedTo:o||"",location:d||"",contactPerson:"",contactPhone:""});h(e)}}catch(e){j("QR kod oluşturulamadı")}finally{g(!1)}}},[r,i,x,o,d]);return e.useEffect(()=>{t&&r&&i&&y()},[t,r,i,y]),a.jsx(s,{isOpen:t,onClose:l,title:`QR Kod - ${r}`,size:"medium",children:a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Kumbara:"}),a.jsx("span",{className:"ml-2 font-medium",children:r})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Atanan Yer:"}),a.jsx("span",{className:"ml-2 font-medium",children:o})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("span",{className:"text-gray-600",children:"Lokasyon:"}),a.jsx("span",{className:"ml-2 font-medium",children:d})]})]})}),a.jsxs("div",{className:"text-center",children:[p&&a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-600",children:"QR kod oluşturuluyor..."})]})}),b&&a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-red-500 text-4xl mb-2",children:"⚠️"}),a.jsx("p",{className:"text-red-600",children:b}),a.jsx("button",{onClick:y,className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Tekrar Dene"})]})}),u&&!p&&!b&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"border-2 border-gray-200 p-4 rounded-lg bg-white",children:a.jsx("img",{src:u,alt:`QR Kod - ${r}`,className:"w-64 h-64 object-contain"})})}),a.jsxs("div",{className:"text-sm text-gray-600",children:[a.jsx("p",{children:"Bu QR kodu tarayarak kumbara bilgilerine ulaşabilirsiniz."}),a.jsxs("p",{className:"mt-1",children:["Kumbara ID: ",a.jsx("span",{className:"font-mono",children:i})]})]})]})]}),u&&!p&&!b&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{onClick:()=>{if(!u)return;const e=document.createElement("a");e.download=`${r}-qr-kod.png`,e.href=u,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center justify-center gap-2",children:[a.jsx("span",{children:"💾"}),"İndir"]}),a.jsxs("button",{onClick:()=>{if(!u)return;const e=m(u,r),a=window.open("","_blank");a&&(a.document.write(e),a.document.close(),a.onload=()=>{a.print(),a.close()})},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center justify-center gap-2",children:[a.jsx("span",{children:"🖨️"}),"Yazdır"]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{onClick:async()=>{if(u)try{const e=await fetch(u),a=await e.blob();await navigator.clipboard.write([new ClipboardItem({"image/png":a})]),alert("QR kod panoya kopyalandı!")}catch(e){alert("QR kod panoya kopyalanamadı")}},className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 flex items-center justify-center gap-2 text-sm",children:[a.jsx("span",{children:"📋"}),"Resmi Kopyala"]}),a.jsxs("button",{onClick:()=>{const e=JSON.stringify({type:"piggy_bank",bankNumber:r,bankId:i,timestamp:(new Date).toISOString()});navigator.clipboard.writeText(e).then(()=>{alert("QR kod verisi panoya kopyalandı!")}).catch(()=>{alert("QR kod verisi panoya kopyalanamadı")})},className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 flex items-center justify-center gap-2 text-sm",children:[a.jsx("span",{children:"📄"}),"Veriyi Kopyala"]})]})]}),a.jsxs("div",{className:"text-xs text-gray-500 bg-blue-50 p-3 rounded",children:["💡 ",a.jsx("strong",{children:"Kullanım:"}),a.jsxs("ul",{className:"mt-1 space-y-1 list-disc list-inside",children:[a.jsxs("li",{children:[a.jsx("strong",{children:"İndir:"})," QR kodu PNG dosyası olarak kaydedin"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Yazdır:"})," QR kodu etiket olarak yazdırın"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Resmi Kopyala:"})," QR kod görüntüsünü panoya kopyalayın"]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Veriyi Kopyala:"})," QR kod içeriğini metin olarak kopyalayın"]})]})]})]})})},b=[{id:"1",bankNumber:"KB-2024-001",assignedTo:"Ahmet Market",assignedDate:"2024-01-15",location:"Fatih/İstanbul",locationDetails:"Ahmet Market - Kasa yanı",address:"Fatih Mahallesi, Atatürk Caddesi No:15, Fatih/İstanbul",contactPerson:"Ahmet Yılmaz",contactPhone:"+90 532 123 4567",contactEmail:"ahmet@market.com",initialAmount:0,currentAmount:1250,lastCollectionDate:"2024-11-15",lastCollectionAmount:850,totalCollected:3400,collectionCount:4,averageCollection:850,status:"aktif",bankType:"standart",material:"plastik",capacity:2e3,weight:1.2,qrCode:"KB001QR",notes:"Düzenli toplama yapılıyor",assignedBy:"Admin",createdDate:"2024-01-15",lastModified:"2024-11-15",modifiedBy:"Collector1"},{id:"2",bankNumber:"KB-2024-002",assignedTo:"Merkez Cami",assignedDate:"2024-02-01",location:"Üsküdar/İstanbul",locationDetails:"Merkez Cami - Giriş holü",address:"Merkez Mahallesi, Cami Sokak No:5, Üsküdar/İstanbul",contactPerson:"İmam Mehmet Bey",contactPhone:"+90 533 987 6543",initialAmount:0,currentAmount:1950,lastCollectionDate:"2024-11-10",lastCollectionAmount:1200,totalCollected:5600,collectionCount:5,averageCollection:1120,status:"dolu",bankType:"büyük",material:"metal",capacity:2e3,weight:2.1,qrCode:"KB002QR",notes:"Cuma namazı sonrası yoğun bağış",assignedBy:"Admin",createdDate:"2024-02-01",lastModified:"2024-11-10",modifiedBy:"Collector2"},{id:"3",bankNumber:"KB-2024-003",assignedTo:"Özel Okul",assignedDate:"2024-03-10",location:"Kadıköy/İstanbul",locationDetails:"Özel Okul - Öğretmenler odası",address:"Eğitim Mahallesi, Okul Caddesi No:25, Kadıköy/İstanbul",contactPerson:"Zeynep Öğretmen",contactPhone:"+90 534 111 2233",contactEmail:"zeynep@okul.edu.tr",initialAmount:0,currentAmount:0,lastCollectionDate:"2024-11-20",lastCollectionAmount:650,totalCollected:2100,collectionCount:3,averageCollection:700,status:"bakımda",bankType:"özel",material:"plastik",capacity:1500,weight:.8,qrCode:"KB003QR",notes:"Kilit arızası - tamir edilecek",assignedBy:"Admin",createdDate:"2024-03-10",lastModified:"2024-11-20",modifiedBy:"Maintenance"},{id:"4",bankNumber:"KB-2024-004",assignedTo:"Hastane Kantini",assignedDate:"2024-04-05",location:"Şişli/İstanbul",locationDetails:"Hastane Kantini - Kasa üstü",address:"Sağlık Mahallesi, Hastane Caddesi No:10, Şişli/İstanbul",contactPerson:"Fatma Hanım",contactPhone:"+90 535 444 5566",initialAmount:0,currentAmount:320,totalCollected:1800,collectionCount:6,averageCollection:300,status:"aktif",bankType:"standart",material:"plastik",capacity:1e3,weight:.9,qrCode:"KB004QR",assignedBy:"Admin",createdDate:"2024-04-05",lastModified:"2024-11-18",modifiedBy:"Collector1"},{id:"5",bankNumber:"KB-2024-005",assignedTo:"Kayıp",assignedDate:"2024-05-20",location:"Bilinmiyor",locationDetails:"Son bilinen: Beşiktaş Çarşı",address:"Beşiktaş Çarşı, İstanbul (Son bilinen konum)",contactPerson:"Bilinmiyor",contactPhone:"Bilinmiyor",initialAmount:0,currentAmount:0,totalCollected:450,collectionCount:1,averageCollection:450,status:"kayıp",bankType:"standart",material:"plastik",capacity:1e3,notes:"Kayıp raporu verildi - 2024-10-15",assignedBy:"Admin",createdDate:"2024-05-20",lastModified:"2024-10-15",modifiedBy:"Admin"}],j=[{id:"1",bankId:"1",collectionDate:"2024-11-15",collectedBy:"Collector1",amount:850,currency:"TRY",coinCount:45,billCount:12,condition:"iyi",receiptNumber:"TOP-2024-115",collectorSignature:"İmzalandı",witnessName:"Ahmet Yılmaz",witnessSignature:"İmzalandı",photoTaken:!0,nextCollectionDate:"2024-12-15",notes:"Normal toplama",createdDate:"2024-11-15"},{id:"2",bankId:"2",collectionDate:"2024-11-10",collectedBy:"Collector2",amount:1200,currency:"TRY",coinCount:80,billCount:18,foreignCurrency:[{amount:5,currency:"USD",exchangeRate:34.5,tryEquivalent:172.5},{amount:2,currency:"EUR",exchangeRate:37.2,tryEquivalent:74.4}],condition:"iyi",receiptNumber:"TOP-2024-110",collectorSignature:"İmzalandı",witnessName:"İmam Mehmet Bey",witnessSignature:"İmzalandı",photoTaken:!0,notes:"Yabancı para da var",createdDate:"2024-11-10"},{id:"3",bankId:"3",collectionDate:"2024-11-20",collectedBy:"Collector1",amount:650,currency:"TRY",coinCount:35,billCount:8,condition:"hasarlı",receiptNumber:"TOP-2024-120",collectorSignature:"İmzalandı",witnessName:"Zeynep Öğretmen",witnessSignature:"İmzalandı",photoTaken:!0,notes:"Kilit problemi tespit edildi",createdDate:"2024-11-20"}],y=[{id:"1",bankId:"1",assignedTo:"Ahmet Market",assignedDate:"2024-01-15",location:"Fatih/İstanbul",locationDetails:"Ahmet Market - Kasa yanı",contactPerson:"Ahmet Yılmaz",contactPhone:"+90 532 123 4567",expectedDuration:365,targetAmount:5e3,purpose:"Genel bağış toplama",assignedBy:"Admin",status:"aktif",notes:"Yıllık anlaşma",createdDate:"2024-01-15"},{id:"2",bankId:"2",assignedTo:"Merkez Cami",assignedDate:"2024-02-01",location:"Üsküdar/İstanbul",locationDetails:"Merkez Cami - Giriş holü",contactPerson:"İmam Mehmet Bey",contactPhone:"+90 533 987 6543",expectedDuration:365,targetAmount:8e3,purpose:"Cami bakım ve yardım fonu",assignedBy:"Admin",status:"aktif",notes:"Cuma namazı sonrası aktif",createdDate:"2024-02-01"}];function N(){const[l,n]=e.useState(b),[r]=e.useState(j),[i]=e.useState(y),[o,m]=e.useState(""),[N,k]=e.useState(""),[v,f]=e.useState(""),[C,w]=e.useState(""),[T,D]=e.useState(!1),[S,A]=e.useState(!1),[K,R]=e.useState(!1),[B,M]=e.useState(!1),[z,P]=e.useState(!1),[L,O]=e.useState(null),[I,Q]=e.useState(null),[q,Y]=e.useState(null),[E,$]=e.useState(null),[F,U]=e.useState("banks"),[G,_]=e.useState({bankNumber:"",assignedTo:"",location:"",locationDetails:"",address:"",contactPerson:"",contactPhone:"",contactEmail:"",bankType:"standart",material:"plastik",capacity:"",weight:"",notes:""}),H=e.useMemo(()=>l.filter(e=>{const a=JSON.stringify(e).toLowerCase().includes(o.toLowerCase()),t=!N||e.status===N,s=!v||e.location.toLowerCase().includes(v.toLowerCase()),l=!C||e.bankType===C;return a&&t&&s&&l}),[l,o,N,v,C]),J=e.useMemo(()=>r.filter(e=>JSON.stringify(e).toLowerCase().includes(o.toLowerCase())),[r,o]),V=e.useMemo(()=>i.filter(e=>JSON.stringify(e).toLowerCase().includes(o.toLowerCase())),[i,o]),Z=H.length,W=H.filter(e=>"aktif"===e.status).length,X=H.filter(e=>"dolu"===e.status).length,ee=H.filter(e=>"bakımda"===e.status).length,ae=H.filter(e=>"kayıp"===e.status).length,te=H.reduce((e,a)=>e+a.currentAmount,0),se=H.reduce((e,a)=>e+a.totalCollected,0),le=H.reduce((e,a)=>e+a.collectionCount,0),ne=Z>0?se/Z:0,re=le>0?se/le:0,ie=[{key:"bankNumber",header:"Kumbara No"},{key:"assignedTo",header:"Atanan Yer"},{key:"location",header:"Lokasyon"},{key:"address",header:"Adres",render:(e,t)=>a.jsx("button",{onClick:()=>ue(t),className:"text-blue-600 hover:text-blue-800 underline text-sm max-w-32 truncate text-left",title:t.address||t.locationDetails,children:t.address||t.locationDetails})},{key:"contactPerson",header:"İletişim"},{key:"contactPhone",header:"Telefon"},{key:"currentAmount",header:"Mevcut/Toplam",render:(e,t)=>a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{className:"font-medium",children:[t.currentAmount.toLocaleString("tr-TR")," ₺"]}),a.jsxs("div",{className:"text-gray-500",children:[t.totalCollected.toLocaleString("tr-TR")," ₺"]}),a.jsxs("div",{className:"text-xs text-gray-400",children:[t.collectionCount," toplama"]})]})},{key:"bankType",header:"Tip/Kapasite",render:(e,t)=>a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{className:"font-medium",children:t.bankType}),a.jsxs("div",{className:"text-gray-500",children:[t.capacity," ₺"]}),a.jsx("div",{className:"text-xs text-gray-400",children:t.material})]})},{key:"lastCollectionDate",header:"Son Toplama",render:(e,t)=>{var s;return a.jsx("div",{className:"text-sm",children:t.lastCollectionDate?a.jsxs(a.Fragment,{children:[a.jsx("div",{children:new Date(t.lastCollectionDate).toLocaleDateString("tr-TR")}),a.jsxs("div",{className:"text-gray-500",children:[null==(s=t.lastCollectionAmount)?void 0:s.toLocaleString("tr-TR")," ₺"]})]}):a.jsx("span",{className:"text-gray-400",children:"Henüz yok"})})}},{key:"status",header:"Durum",render:(e,t)=>a.jsx("span",{className:"px-2 py-1 rounded text-xs "+("aktif"===t.status?"bg-green-100 text-green-800":"dolu"===t.status?"bg-blue-100 text-blue-800":"bakımda"===t.status?"bg-yellow-100 text-yellow-800":"kayıp"===t.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.status})},{key:"id",header:"İşlemler",render:(e,t)=>a.jsxs("div",{className:"flex gap-1 text-xs flex-wrap",children:[a.jsx("button",{onClick:()=>ce(t),className:"text-blue-600 hover:text-blue-800 px-2 py-1 rounded",children:"Düzenle"}),a.jsx("button",{onClick:()=>me(t),className:"text-green-600 hover:text-green-800 px-2 py-1 rounded",children:"Toplamalar"}),a.jsx("button",{onClick:()=>he(t),className:"text-orange-600 hover:text-orange-800 px-2 py-1 rounded",children:"QR Kod"}),a.jsx("button",{onClick:()=>xe(t),className:"text-purple-600 hover:text-purple-800 px-2 py-1 rounded",disabled:"aktif"!==t.status&&"dolu"!==t.status,children:"Topla"})]})}],oe=[{key:"collectionDate",header:"Tarih",render:(e,a)=>new Date(a.collectionDate).toLocaleDateString("tr-TR")},{key:"bankId",header:"Kumbara",render:(e,a)=>{const t=l.find(e=>e.id===a.bankId);return t?t.bankNumber:"Bilinmiyor"}},{key:"collectedBy",header:"Toplayan"},{key:"amount",header:"Tutar/Adet",render:(e,t)=>a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{className:"font-medium",children:[t.amount.toLocaleString("tr-TR")," ₺"]}),a.jsxs("div",{className:"text-gray-500",children:[t.coinCount,"M + ",t.billCount,"K"]}),t.foreignCurrency&&t.foreignCurrency.length>0&&a.jsx("div",{className:"text-xs text-blue-600",children:"+Yabancı para"})]})},{key:"condition",header:"Durum",render:(e,t)=>a.jsx("span",{className:"px-2 py-1 rounded text-xs "+("iyi"===t.condition?"bg-green-100 text-green-800":"hasarlı"===t.condition?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:t.condition})},{key:"receiptNumber",header:"Makbuz No"},{key:"photoTaken",header:"Fotoğraf",render:(e,a)=>a.photoTaken?"✓":"-"},{key:"witnessName",header:"Şahit"}],de=[{key:"assignedDate",header:"Atama Tarihi",render:(e,a)=>new Date(a.assignedDate).toLocaleDateString("tr-TR")},{key:"bankId",header:"Kumbara",render:(e,a)=>{const t=l.find(e=>e.id===a.bankId);return t?t.bankNumber:"Bilinmiyor"}},{key:"assignedTo",header:"Atanan Yer"},{key:"location",header:"Lokasyon"},{key:"contactPerson",header:"İletişim"},{key:"expectedDuration",header:"Süre/Hedef",render:(e,t)=>a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{children:[t.expectedDuration," gün"]}),t.targetAmount&&a.jsxs("div",{className:"text-gray-500",children:[t.targetAmount.toLocaleString("tr-TR")," ₺"]})]})},{key:"purpose",header:"Amaç"},{key:"status",header:"Durum",render:(e,t)=>a.jsx("span",{className:"px-2 py-1 rounded text-xs "+("aktif"===t.status?"bg-green-100 text-green-800":"tamamlandı"===t.status?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"),children:t.status})},{key:"assignedBy",header:"Atayan"}],ce=e=>{var a;O(e),_({bankNumber:e.bankNumber,assignedTo:e.assignedTo,location:e.location,locationDetails:e.locationDetails,address:e.address||"",contactPerson:e.contactPerson,contactPhone:e.contactPhone,contactEmail:e.contactEmail||"",bankType:e.bankType,material:e.material,capacity:e.capacity.toString(),weight:(null==(a=e.weight)?void 0:a.toString())||"",notes:e.notes||""}),D(!0)},me=e=>{Q(e),A(!0)},xe=e=>{Q(e),alert(`${e.bankNumber} numaralı kumbara için toplama işlemi başlatılacak.`)},ue=e=>{Y(e),R(!0)},he=e=>{$(e),P(!0)},pe=()=>{_({bankNumber:"",assignedTo:"",location:"",locationDetails:"",address:"",contactPerson:"",contactPhone:"",contactEmail:"",bankType:"standart",material:"plastik",capacity:"",weight:"",notes:""})},ge=[...new Set(l.map(e=>e.location))];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Kumbara Takibi"}),a.jsxs("div",{className:"flex border rounded",children:[a.jsx("button",{onClick:()=>U("banks"),className:"px-4 py-2 text-sm "+("banks"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Kumbaralar"}),a.jsx("button",{onClick:()=>U("collections"),className:"px-4 py-2 text-sm "+("collections"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Toplamalar"}),a.jsx("button",{onClick:()=>U("assignments"),className:"px-4 py-2 text-sm "+("assignments"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Atamalar"}),a.jsx("button",{onClick:()=>U("analytics"),className:"px-4 py-2 text-sm "+("analytics"===F?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:"Analitik"})]})]}),"banks"===F&&a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>{M(!0)},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center gap-2",children:[a.jsx(h,{className:"w-4 h-4"}),"QR Tara"]}),a.jsx("button",{onClick:()=>{O(null),pe();const e=(l.length+1).toString().padStart(3,"0");_(a=>({...a,bankNumber:`KB-2024-${e}`})),D(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Yeni Kumbara"})]})]}),"banks"===F&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-600",children:"Toplam Kumbara"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:Z})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-green-600",children:"Aktif"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:W})]}),a.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-purple-600",children:"Dolu"}),a.jsx("p",{className:"text-2xl font-bold text-purple-900",children:X})]}),a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-600",children:"Bakımda"}),a.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:ee})]}),a.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-red-600",children:"Kayıp"}),a.jsx("p",{className:"text-2xl font-bold text-red-900",children:ae})]}),a.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-indigo-600",children:"Mevcut Tutar"}),a.jsxs("p",{className:"text-2xl font-bold text-indigo-900",children:[te.toLocaleString("tr-TR")," ₺"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[a.jsx("input",{value:o,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2",placeholder:"Kumbara no, yer adı ile ara..."}),a.jsxs("select",{value:N,onChange:e=>k(e.target.value),className:"border rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Tüm Durumlar"}),a.jsx("option",{value:"aktif",children:"Aktif"}),a.jsx("option",{value:"dolu",children:"Dolu"}),a.jsx("option",{value:"bakımda",children:"Bakımda"}),a.jsx("option",{value:"kayıp",children:"Kayıp"}),a.jsx("option",{value:"iptal",children:"İptal"})]}),a.jsxs("select",{value:v,onChange:e=>f(e.target.value),className:"border rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Tüm Lokasyonlar"}),ge.map(e=>a.jsx("option",{value:e,children:e},e))]}),a.jsxs("select",{value:C,onChange:e=>w(e.target.value),className:"border rounded px-3 py-2",children:[a.jsx("option",{value:"",children:"Tüm Tipler"}),a.jsx("option",{value:"standart",children:"Standart"}),a.jsx("option",{value:"büyük",children:"Büyük"}),a.jsx("option",{value:"özel",children:"Özel"}),a.jsx("option",{value:"dijital",children:"Dijital"})]}),a.jsx("button",{onClick:()=>u("kumbaralar.csv",H),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Excel İndir"})]}),a.jsx(t,{columns:ie,data:H})]}),"collections"===F&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-4",children:a.jsx("input",{value:o,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2 w-full max-w-md",placeholder:"Kumbara no, toplayan kişi ile ara..."})}),a.jsx(t,{columns:oe,data:J})]}),"assignments"===F&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-4",children:a.jsx("input",{value:o,onChange:e=>m(e.target.value),className:"border rounded px-3 py-2 w-full max-w-md",placeholder:"Atanan yer, kişi ile ara..."})}),a.jsx(t,{columns:de,data:V})]}),"analytics"===F&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium text-blue-600 mb-2",children:"Toplam Gelir"}),a.jsxs("p",{className:"text-3xl font-bold text-blue-900",children:[se.toLocaleString("tr-TR")," ₺"]}),a.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Tüm toplamalar"})]}),a.jsxs("div",{className:"bg-green-50 p-6 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium text-green-600 mb-2",children:"Mevcut Tutar"}),a.jsxs("p",{className:"text-3xl font-bold text-green-900",children:[te.toLocaleString("tr-TR")," ₺"]}),a.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Kumbaralarda"})]}),a.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium text-purple-600 mb-2",children:"Kumbara Başına"}),a.jsxs("p",{className:"text-3xl font-bold text-purple-900",children:[ne.toLocaleString("tr-TR")," ₺"]}),a.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"Ortalama gelir"})]}),a.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-medium text-orange-600 mb-2",children:"Toplama Başına"}),a.jsxs("p",{className:"text-3xl font-bold text-orange-900",children:[re.toLocaleString("tr-TR")," ₺"]}),a.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"Ortalama tutar"})]})]}),a.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Kumbara Durum Dağılımı"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-green-600 mb-1",children:"Aktif"}),a.jsx("div",{className:"text-2xl font-bold text-green-600",children:W}),a.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(W/Z*100):0]})]}),a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-blue-600 mb-1",children:"Dolu"}),a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:X}),a.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(X/Z*100):0]})]}),a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-yellow-600 mb-1",children:"Bakımda"}),a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:ee}),a.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(ee/Z*100):0]})]}),a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-red-600 mb-1",children:"Kayıp"}),a.jsx("div",{className:"text-2xl font-bold text-red-600",children:ae}),a.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(ae/Z*100):0]})]}),a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"İptal"}),a.jsx("div",{className:"text-2xl font-bold text-gray-600",children:H.filter(e=>"iptal"===e.status).length}),a.jsxs("div",{className:"text-sm text-gray-500",children:["%",Z>0?Math.round(H.filter(e=>"iptal"===e.status).length/Z*100):0]})]})]})]}),a.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Lokasyon Performansı"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b",children:[a.jsx("th",{className:"text-left py-2",children:"Lokasyon"}),a.jsx("th",{className:"text-right py-2",children:"Kumbara Sayısı"}),a.jsx("th",{className:"text-right py-2",children:"Toplam Gelir"}),a.jsx("th",{className:"text-right py-2",children:"Ortalama"}),a.jsx("th",{className:"text-right py-2",children:"Mevcut Tutar"})]})}),a.jsx("tbody",{children:ge.map(e=>{const t=H.filter(a=>a.location===e),s=t.reduce((e,a)=>e+a.totalCollected,0),l=t.reduce((e,a)=>e+a.currentAmount,0),n=t.length>0?s/t.length:0;return a.jsxs("tr",{className:"border-b",children:[a.jsx("td",{className:"py-2",children:e}),a.jsx("td",{className:"text-right py-2",children:t.length}),a.jsxs("td",{className:"text-right py-2",children:[s.toLocaleString("tr-TR")," ₺"]}),a.jsxs("td",{className:"text-right py-2",children:[n.toLocaleString("tr-TR")," ₺"]}),a.jsxs("td",{className:"text-right py-2",children:[l.toLocaleString("tr-TR")," ₺"]})]},e)})})]})})]}),a.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Kumbara Tipi Analizi"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:["standart","büyük","özel","dijital"].map(e=>{const t=H.filter(a=>a.bankType===e),s=t.reduce((e,a)=>e+a.totalCollected,0),l=t.length>0?s/t.length:0;return a.jsxs("div",{className:"border rounded p-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-600 mb-1",children:e}),a.jsxs("div",{className:"text-xl font-bold text-gray-900",children:[t.length," adet"]}),a.jsxs("div",{className:"text-sm text-gray-500",children:[s.toLocaleString("tr-TR")," ₺"]}),a.jsxs("div",{className:"text-xs text-gray-400",children:["Ort: ",l.toLocaleString("tr-TR")," ₺"]})]},e)})})]})]})]}),a.jsx(s,{isOpen:T,onClose:()=>D(!1),title:L?"Kumbara Düzenle":"Yeni Kumbara",children:a.jsxs("form",{onSubmit:e=>{e.preventDefault();const a=parseFloat(G.capacity),t=G.weight?parseFloat(G.weight):void 0;if(L)n(l.map(e=>e.id===L.id?{...e,...G,capacity:a,weight:t,lastModified:(new Date).toISOString().split("T")[0],modifiedBy:"Admin"}:e));else{const e=x(l),s=c({bankNumber:G.bankNumber||e,assignedTo:G.assignedTo,location:G.location,contactPerson:G.contactPerson,contactPhone:G.contactPhone}),r={id:Date.now().toString(),...G,bankNumber:G.bankNumber||e,capacity:a,weight:t,assignedDate:(new Date).toISOString().split("T")[0],initialAmount:0,currentAmount:0,totalCollected:0,collectionCount:0,averageCollection:0,status:"aktif",qrCode:s,assignedBy:"Admin",createdDate:(new Date).toISOString().split("T")[0],lastModified:(new Date).toISOString().split("T")[0],modifiedBy:"Admin"};n([...l,r])}D(!1),O(null),pe()},className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kumbara Numarası *"}),a.jsx("input",{type:"text",value:G.bankNumber,onChange:e=>_({...G,bankNumber:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"KB-2024-001",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Atanan Yer *"}),a.jsx("input",{type:"text",value:G.assignedTo,onChange:e=>_({...G,assignedTo:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Market, Cami, Okul vb.",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lokasyon *"}),a.jsx("input",{type:"text",value:G.location,onChange:e=>_({...G,location:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"İlçe/İl",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lokasyon Detayı"}),a.jsx("input",{type:"text",value:G.locationDetails,onChange:e=>_({...G,locationDetails:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Kasa yanı, giriş holü vb."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tam Adres"}),a.jsx("input",{type:"text",value:G.address,onChange:e=>_({...G,address:e.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Mahalle, Cadde/Sokak No, İlçe/İl"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Kişisi *"}),a.jsx("input",{type:"text",value:G.contactPerson,onChange:e=>_({...G,contactPerson:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Telefon *"}),a.jsx("input",{type:"tel",value:G.contactPhone,onChange:e=>_({...G,contactPhone:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"E-posta"}),a.jsx("input",{type:"email",value:G.contactEmail,onChange:e=>_({...G,contactEmail:e.target.value}),className:"w-full border rounded px-3 py-2"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kumbara Tipi"}),a.jsxs("select",{value:G.bankType,onChange:e=>_({...G,bankType:e.target.value}),className:"w-full border rounded px-3 py-2",children:[a.jsx("option",{value:"standart",children:"Standart"}),a.jsx("option",{value:"büyük",children:"Büyük"}),a.jsx("option",{value:"özel",children:"Özel"}),a.jsx("option",{value:"dijital",children:"Dijital"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Malzeme"}),a.jsxs("select",{value:G.material,onChange:e=>_({...G,material:e.target.value}),className:"w-full border rounded px-3 py-2",children:[a.jsx("option",{value:"plastik",children:"Plastik"}),a.jsx("option",{value:"metal",children:"Metal"}),a.jsx("option",{value:"cam",children:"Cam"}),a.jsx("option",{value:"karton",children:"Karton"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kapasite (₺) *"}),a.jsx("input",{type:"number",step:"0.01",value:G.capacity,onChange:e=>_({...G,capacity:e.target.value}),className:"w-full border rounded px-3 py-2",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ağırlık (kg)"}),a.jsx("input",{type:"number",step:"0.1",value:G.weight,onChange:e=>_({...G,weight:e.target.value}),className:"w-full border rounded px-3 py-2"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),a.jsx("textarea",{value:G.notes,onChange:e=>_({...G,notes:e.target.value}),className:"w-full border rounded px-3 py-2",rows:3,placeholder:"Kumbara hakkında notlar..."})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"İptal"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:L?"Güncelle":"Oluştur"})]})]})}),a.jsx(s,{isOpen:S,onClose:()=>A(!1),title:`${null==I?void 0:I.bankNumber} - Toplama Geçmişi`,children:I&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-gray-50 p-4 rounded",children:a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Toplam Toplama:"}),a.jsx("span",{className:"ml-2 font-medium",children:I.collectionCount})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Toplam Gelir:"}),a.jsxs("span",{className:"ml-2 font-medium",children:[I.totalCollected.toLocaleString("tr-TR")," ₺"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600",children:"Ortalama:"}),a.jsxs("span",{className:"ml-2 font-medium",children:[I.averageCollection.toLocaleString("tr-TR")," ₺"]})]})]})}),a.jsx("div",{className:"max-h-96 overflow-y-auto",children:a.jsx(t,{columns:oe,data:r.filter(e=>e.bankId===I.id)})})]})}),q&&a.jsx(p,{isOpen:K,onClose:()=>R(!1),address:q.address||q.location,bankNumber:q.bankNumber,assignedTo:q.assignedTo}),a.jsx(d,{isOpen:B,onClose:()=>M(!1),onScanSuccess:e=>{if(e&&e.bankNumber){const a=l.find(a=>a.bankNumber===e.bankNumber);a?ce(a):alert("Kumbara bulunamadı!")}M(!1)}}),E&&a.jsx(g,{isOpen:z,onClose:()=>P(!1),bank:E})]})}export{N as default};
