import{t as e,ap as s,r as i,j as n,c as t,e as r,S as a,b7 as m,K as o,s as l,b8 as d,b9 as c,b5 as u,b6 as h,i as N,aa as v,X as g,n as x,A as p,ba as b,o as f,b as y,P as D,I as w,V as j}from"../assets/index-CzvAnh9f.js";import{A as _}from"./archive-F6asUjPp.js";import{P as E}from"./pen-q88GhGGm.js";import{A as U}from"./arrow-left-DR-zeoKx.js";import{V as C}from"./video-Cg_1xTsf.js";const V=e("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),M=e("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),k=e("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),S=e("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),I=e("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),L=(e,i)=>{const n=(null==e?void 0:e.message)||`Error in ${i}`;throw s.error(n),new Error(n)},z=()=>[{id:"conv_1",name:"Yönetim Kurulu",conversation_type:"group",created_by:"user1",description:"Yönetim kurulu iç iletişimi",is_archived:!1,last_message_at:new Date(Date.now()-18e5).toISOString(),created_at:new Date(Date.now()-2592e6).toISOString(),updated_at:(new Date).toISOString()},{id:"conv_2",name:"Proje Koordinasyonu",conversation_type:"group",created_by:"user2",description:"Aktif projeler için koordinasyon",is_archived:!1,last_message_at:new Date(Date.now()-72e5).toISOString(),created_at:new Date(Date.now()-1296e6).toISOString(),updated_at:(new Date).toISOString()},{id:"conv_3",conversation_type:"direct",created_by:"user1",is_archived:!1,last_message_at:new Date(Date.now()-3e5).toISOString(),created_at:new Date(Date.now()-6048e5).toISOString(),updated_at:(new Date).toISOString()}],O=e=>[{id:"msg_1",sender_id:"user1",conversation_id:e,content:"Merhaba, toplantı için gündem maddelerini gözden geçirelim.",message_type:"text",created_at:new Date(Date.now()-36e5).toISOString(),updated_at:new Date(Date.now()-36e5).toISOString()},{id:"msg_2",sender_id:"user2",conversation_id:e,content:"Evet, bütçe konularını da ekleyelim. Dosyayı paylaşıyorum.",message_type:"text",created_at:new Date(Date.now()-27e5).toISOString(),updated_at:new Date(Date.now()-27e5).toISOString()},{id:"msg_3",sender_id:"user2",conversation_id:e,content:"budget_2024.pdf",message_type:"file",file_url:"https://example.com/budget_2024.pdf",file_name:"budget_2024.pdf",file_size:245760,created_at:new Date(Date.now()-18e5).toISOString(),updated_at:new Date(Date.now()-18e5).toISOString()},{id:"msg_4",sender_id:"user3",conversation_id:e,content:"Harika! Ben de proje raporlarını hazırladım. Yarın sunabilirim.",message_type:"text",reply_to:"msg_2",created_at:new Date(Date.now()-9e5).toISOString(),updated_at:new Date(Date.now()-9e5).toISOString()},{id:"msg_5",sender_id:"user1",conversation_id:e,content:"Mükemmel! O zaman yarın saat 14:00'da başlayalım.",message_type:"text",created_at:new Date(Date.now()-3e5).toISOString(),updated_at:new Date(Date.now()-3e5).toISOString()}],K={async getConversations(){try{return z()}catch(e){return L(e,"getConversations"),[]}},async getConversation(e){try{return z().find(s=>s.id===e)||null}catch(s){return L(s,"getConversation"),null}},async createConversation(e){try{const i={id:`conv_${Date.now()}`,name:e.name,conversation_type:e.conversation_type,created_by:"current_user",description:e.description,is_archived:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return e.participants.length>0&&await this.addParticipants(i.id,e.participants),s.success("Konuşma oluşturuldu"),i}catch(i){throw L(i,"createConversation"),i}},async updateConversation(e,i){try{const n=z().find(s=>s.id===e);if(!n)throw new Error("Konuşma bulunamadı");const t={...n,...i,updated_at:(new Date).toISOString()};return s.success("Konuşma güncellendi"),t}catch(n){throw L(n,"updateConversation"),n}},async deleteConversation(e){try{s.success("Konuşma silindi")}catch(i){throw L(i,"deleteConversation"),i}},async archiveConversation(e){try{s.success("Konuşma arşivlendi")}catch(i){throw L(i,"archiveConversation"),i}},async getMessages(e){try{return O(e)}catch(s){return L(s,"getMessages"),[]}},async sendMessage(e){try{const s={id:`msg_${Date.now()}`,sender_id:"current_user",conversation_id:e.conversation_id,content:e.content,message_type:e.message_type||"text",file_url:e.file_url,file_name:e.file_name,file_size:e.file_size,reply_to:e.reply_to,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return await this.updateConversationLastMessage(e.conversation_id),s}catch(s){throw L(s,"sendMessage"),s}},async editMessage(e,i){try{const n=O("conv_1").find(s=>s.id===e);if(!n)throw new Error("Mesaj bulunamadı");const t={...n,content:i,edited_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return s.success("Mesaj düzenlendi"),t}catch(n){throw L(n,"editMessage"),n}},async deleteMessage(e){try{s.success("Mesaj silindi")}catch(i){throw L(i,"deleteMessage"),i}},async markMessageAsRead(e){},async getConversationParticipants(e){try{return(e=>[{id:"part_1",conversation_id:e,user_id:"user1",role:"admin",joined_at:new Date(Date.now()-2592e6).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-6e5).toISOString()},{id:"part_2",conversation_id:e,user_id:"user2",role:"member",joined_at:new Date(Date.now()-216e7).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-12e5).toISOString()},{id:"part_3",conversation_id:e,user_id:"user3",role:"member",joined_at:new Date(Date.now()-1728e6).toISOString(),is_muted:!1,last_read_at:new Date(Date.now()-3e5).toISOString()}])(e)}catch(s){return L(s,"getConversationParticipants"),[]}},async addParticipants(e,i){try{const n=i.map(s=>({id:`part_${Date.now()}_${s}`,conversation_id:e,user_id:s,role:"member",joined_at:(new Date).toISOString(),is_muted:!1}));return s.success(`${i.length} katılımcı eklendi`),n}catch(n){throw L(n,"addParticipants"),n}},async removeParticipant(e,i){try{s.success("Katılımcı çıkarıldı")}catch(n){throw L(n,"removeParticipant"),n}},async updateParticipantRole(e,i,n){try{s.success("Katılımcı rolü güncellendi")}catch(t){throw L(t,"updateParticipantRole"),t}},async muteConversation(e,i,n){try{s.success(n?"Konuşma sessize alındı":"Konuşma sessize alma kaldırıldı")}catch(t){throw L(t,"muteConversation"),t}},async markConversationAsRead(e){},async addReaction(e,s){try{return{id:`reaction_${Date.now()}`,message_id:e,user_id:"current_user",emoji:s,created_at:(new Date).toISOString()}}catch(i){throw L(i,"addReaction"),i}},async removeReaction(e){},async getMessageReactions(e){try{return[{id:"reaction_1",message_id:e,user_id:"user1",emoji:"👍",created_at:(new Date).toISOString()},{id:"reaction_2",message_id:e,user_id:"user2",emoji:"❤️",created_at:(new Date).toISOString()}]}catch(s){return L(s,"getMessageReactions"),[]}},async searchMessages(e,s){try{return O(s||"conv_1").filter(s=>s.content.toLowerCase().includes(e.toLowerCase()))}catch(i){return L(i,"searchMessages"),[]}},async getNotifications(e){try{return[{id:"notif_1",user_id:e,conversation_id:"conv_1",message_id:"msg_1",type:"new_message",is_read:!1,created_at:new Date(Date.now()-18e5).toISOString()},{id:"notif_2",user_id:e,conversation_id:"conv_2",message_id:"msg_2",type:"mention",is_read:!1,created_at:new Date(Date.now()-36e5).toISOString()}]}catch(s){return L(s,"getNotifications"),[]}},async markNotificationAsRead(e){},subscribeToConversation:(e,s)=>({unsubscribe:()=>{}}),subscribeToNotifications:(e,s)=>({unsubscribe:()=>{}}),async updateConversationLastMessage(e){},async getUnreadCount(e,s){try{return Math.floor(5*Math.random())}catch(i){return 0}}};function R({conversations:e,selectedConversationId:s,onSelectConversation:v,onCreateConversation:g,onSearchConversations:x,onUpdateConversations:p,loading:b=!1,currentUserId:f}){const[y,D]=i.useState(""),[w,j]=i.useState(null),[E,U]=i.useState({}),[C,M]=i.useState(new Set),[S,I]=i.useState("all");i.useEffect(()=>{(async()=>{if(!f)return;const s={};for(const n of e)try{const e=await K.getUnreadCount(n.id,f);s[n.id]=e}catch(i){}U(s)})()},[e,f]),i.useEffect(()=>{M(new Set(["user1","user2","user3"]))},[]),i.useEffect(()=>{const e=()=>j(null);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const L=e.filter(e=>{var s,i;const n=!y||(null==(s=e.name)?void 0:s.toLowerCase().includes(y.toLowerCase()))||(null==(i=e.description)?void 0:i.toLowerCase().includes(y.toLowerCase())),t="all"===S||"unread"===S&&(E[e.id]||0)>0||"groups"===S&&"group"===e.conversation_type||"direct"===S&&"direct"===e.conversation_type;return n&&t&&!e.is_archived}),z=e=>{if(!e)return"";const s=new Date(e),i=((new Date).getTime()-s.getTime())/36e5;return i<1?"şimdi":i<24?u(s,"HH:mm"):u(s,i<168?"EEE":"dd/MM",{locale:h})},O=e=>"group"===e.conversation_type?e.name||"İsimsiz Grup":"Direkt Mesaj",R=e=>e.avatar_url?n.jsxDEV("img",{src:e.avatar_url,alt:O(e),className:"w-12 h-12 rounded-full object-cover"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:118,columnNumber:9},this):n.jsxDEV("div",{className:"w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white relative",children:["group"===e.conversation_type?n.jsxDEV(N,{className:"h-6 w-6"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:129,columnNumber:9},this):n.jsxDEV(c,{className:"h-6 w-6"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:131,columnNumber:9},this),"direct"===e.conversation_type&&C.has("user1")&&n.jsxDEV("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-white rounded-full"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:136,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:127,columnNumber:7},this);return n.jsxDEV("div",{className:"w-80 border-r bg-card flex flex-col h-full",children:[n.jsxDEV("div",{className:"p-4 border-b",children:[n.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[n.jsxDEV("h2",{className:"font-semibold text-lg",children:"Mesajlar"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:193,columnNumber:11},this),g&&n.jsxDEV(t,{size:"sm",onClick:g,children:[n.jsxDEV(r,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:196,columnNumber:15},this),"Yeni"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:195,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:192,columnNumber:9},this),n.jsxDEV("div",{className:"relative mb-3",children:[n.jsxDEV(a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:204,columnNumber:11},this),n.jsxDEV("input",{type:"text",placeholder:"Konuşma ara...",value:y,onChange:e=>{return s=e.target.value,D(s),void(null==x||x(s));var s},className:"w-full pl-10 pr-3 py-2 border border-input rounded-md bg-background text-sm"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:205,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:203,columnNumber:9},this),n.jsxDEV("div",{className:"flex space-x-1 p-1 bg-muted rounded-lg",children:[{id:"all",label:"Tümü",count:e.length},{id:"unread",label:"Okunmayan",count:Object.values(E).reduce((e,s)=>e+(s>0?1:0),0)},{id:"groups",label:"Gruplar",count:e.filter(e=>"group"===e.conversation_type).length},{id:"direct",label:"Direkt",count:e.filter(e=>"direct"===e.conversation_type).length}].map(e=>n.jsxDEV("button",{onClick:()=>I(e.id),className:"flex-1 text-xs py-1.5 px-2 rounded transition-colors "+(S===e.id?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.label,e.count>0&&n.jsxDEV("span",{className:"ml-1 text-xs",children:["(",e.count,")"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:233,columnNumber:13},this)]},e.id,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:222,columnNumber:11},this))},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:215,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:191,columnNumber:7},this),n.jsxDEV("div",{className:"flex-1 overflow-y-auto",children:b?n.jsxDEV("div",{className:"p-4 text-center",children:[n.jsxDEV("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:246,columnNumber:13},this),n.jsxDEV("p",{className:"text-sm text-muted-foreground mt-2",children:"Yükleniyor..."},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:247,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:245,columnNumber:9},this):L.length>0?n.jsxDEV("div",{className:"space-y-1 p-2",children:L.map(e=>{const i=(t=e.id,E[t]||0);var t;return n.jsxDEV("div",{className:"relative group cursor-pointer rounded-lg p-3 transition-colors "+(s===e.id?"bg-primary/10 border border-primary/20":"hover:bg-muted/50"),onClick:()=>v(e),children:[n.jsxDEV("div",{className:"flex items-center space-x-3",children:[R(e),n.jsxDEV("div",{className:"flex-1 min-w-0",children:[n.jsxDEV("div",{className:"flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center space-x-2",children:[n.jsxDEV("h3",{className:"truncate "+(i>0?"font-semibold":"font-medium"),children:O(e)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:272,columnNumber:27},this),"group"===e.conversation_type&&n.jsxDEV(k,{className:"h-3 w-3 text-muted-foreground"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:278,columnNumber:25},this),n.jsxDEV(V,{className:"h-3 w-3 text-muted-foreground opacity-0"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:282,columnNumber:27},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:271,columnNumber:25},this),n.jsxDEV("div",{className:"flex items-center space-x-2",children:[i>0&&n.jsxDEV("span",{className:"bg-primary text-primary-foreground text-xs px-2 py-0.5 rounded-full min-w-[18px] text-center font-medium",children:i>99?"99+":i},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:288,columnNumber:25},this),e.last_message_at&&n.jsxDEV("span",{className:"text-xs text-muted-foreground",children:z(e.last_message_at)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:295,columnNumber:25},this),n.jsxDEV("button",{onClick:s=>((e,s)=>{e.stopPropagation(),j(w===s?null:s)})(s,e.id),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-background/50 rounded transition-opacity",children:n.jsxDEV(m,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:305,columnNumber:29},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:301,columnNumber:27},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:285,columnNumber:25},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:270,columnNumber:23},this),n.jsxDEV("div",{className:"flex items-center justify-between mt-1",children:n.jsxDEV("p",{className:"text-sm truncate "+(i>0?"text-foreground":"text-muted-foreground"),children:e.description||"Henüz mesaj yok"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:312,columnNumber:25},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:311,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:269,columnNumber:21},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:264,columnNumber:19},this),w===e.id&&n.jsxDEV("div",{className:"absolute top-12 right-3 bg-background border rounded-lg shadow-lg z-20 min-w-[160px]",children:[n.jsxDEV("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-t-lg flex items-center",onClick:()=>(async e=>{if(f)try{await K.muteConversation(e,f,!0),j(null)}catch(s){}})(e.id),children:[n.jsxDEV(V,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:328,columnNumber:25},this),"Sessize Al"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:324,columnNumber:23},this),"group"===e.conversation_type&&n.jsxDEV("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",children:[n.jsxDEV(o,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:334,columnNumber:27},this),"Grup Ayarları"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:333,columnNumber:19},this),n.jsxDEV("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",onClick:()=>(async e=>{try{await K.archiveConversation(e),null==p||p(),j(null)}catch(s){}})(e.id),children:[n.jsxDEV(_,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:343,columnNumber:25},this),"Arşivle"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:339,columnNumber:23},this),n.jsxDEV("div",{className:"border-t border-muted my-1"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:347,columnNumber:23},this),n.jsxDEV("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-b-lg flex items-center text-destructive",onClick:()=>(async e=>{if(window.confirm("Bu konuşmayı silmek istediğinizden emin misiniz?"))try{await K.deleteConversation(e),null==p||p(),j(null)}catch(s){}})(e.id),children:[n.jsxDEV(l,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:353,columnNumber:25},this),"group"===e.conversation_type?"Gruptan Ayrıl":"Konuşmayı Sil"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:349,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:323,columnNumber:17},this)]},e.id,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:255,columnNumber:15},this)})},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:250,columnNumber:9},this):n.jsxDEV("div",{className:"p-8 text-center text-muted-foreground",children:y?n.jsxDEV("div",{children:[n.jsxDEV(a,{className:"h-8 w-8 mx-auto mb-2 opacity-50"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:366,columnNumber:17},this),n.jsxDEV("p",{children:"Arama kriterlerine uygun konuşma bulunamadı"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:367,columnNumber:17},this),n.jsxDEV("p",{className:"text-xs mt-1",children:["'",y,"' için sonuç yok"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:368,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:365,columnNumber:11},this):"unread"===S?n.jsxDEV("div",{children:[n.jsxDEV(d,{className:"h-8 w-8 mx-auto mb-2 opacity-50"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:372,columnNumber:17},this),n.jsxDEV("p",{children:"Okunmamış mesaj yok"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:373,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:371,columnNumber:11},this):n.jsxDEV("div",{children:[n.jsxDEV(c,{className:"h-8 w-8 mx-auto mb-2 opacity-50"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:377,columnNumber:17},this),n.jsxDEV("p",{children:"Henüz konuşma başlatılmamış"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:378,columnNumber:17},this),g&&n.jsxDEV(t,{size:"sm",className:"mt-3",onClick:g,children:"İlk konuşmayı başlat"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:380,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:376,columnNumber:11},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:363,columnNumber:9},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:243,columnNumber:7},this),w&&n.jsxDEV("div",{className:"fixed inset-0 z-10",onClick:()=>{j(null)}},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:392,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ConversationList.tsx",lineNumber:189,columnNumber:5},this)}function A({message:e,isCurrentUser:s,onReply:t,onEdit:r,onDelete:a,showSender:o=!0,onFileDownload:d,isEditing:c=!1,onSaveEdit:N,onCancelEdit:p}){const[b,f]=i.useState(!1),[y,D]=i.useState(e.content||""),w=()=>{y.trim()&&N&&N(e.id,y.trim())},j=()=>{D(e.content||""),null==p||p()};return n.jsxDEV("div",{className:"flex gap-3 group "+(s?"flex-row-reverse":""),children:[o&&!s&&n.jsxDEV("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm flex-shrink-0",children:e.sender_id.charAt(0).toUpperCase()},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:160,columnNumber:7},this),n.jsxDEV("div",{className:"flex-1 max-w-xs sm:max-w-md "+(s?"flex flex-col items-end":""),children:[o&&!s&&n.jsxDEV("div",{className:"text-sm text-muted-foreground mb-1",children:["Kullanıcı ",e.sender_id]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:169,columnNumber:9},this),e.reply_to&&n.jsxDEV("div",{className:"mb-2 p-2 bg-muted/50 border-l-2 border-primary rounded text-sm",children:[n.jsxDEV("div",{className:"text-muted-foreground",children:"Yanıtlanan mesaj"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:177,columnNumber:13},this),n.jsxDEV("div",{className:"truncate",children:"..."},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:178,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:176,columnNumber:9},this),n.jsxDEV("div",{className:"relative rounded-lg p-3 "+("system"===e.message_type?"bg-muted/30 text-center":s?"bg-primary text-primary-foreground":"bg-card border"),children:[(()=>{if(c&&"text"===e.message_type)return n.jsxDEV("div",{className:"space-y-2",children:[n.jsxDEV("textarea",{value:y,onChange:e=>D(e.target.value),className:"w-full p-2 border rounded resize-none focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&j():(e.preventDefault(),w())}},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:63,columnNumber:11},this),n.jsxDEV("div",{className:"flex items-center gap-2",children:[n.jsxDEV("button",{onClick:w,disabled:!y.trim(),className:"flex items-center gap-1 px-2 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[n.jsxDEV(v,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:84,columnNumber:15},this),"Kaydet"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:79,columnNumber:13},this),n.jsxDEV("button",{onClick:j,className:"flex items-center gap-1 px-2 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600",children:[n.jsxDEV(g,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:91,columnNumber:15},this),"İptal"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:87,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:78,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:62,columnNumber:9},this);switch(e.message_type){case"file":return n.jsxDEV("div",{className:"flex items-center space-x-3 p-3 border rounded-lg bg-muted/50",children:[n.jsxDEV(M,{className:"h-8 w-8 text-blue-500"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:103,columnNumber:13},this),n.jsxDEV("div",{className:"flex-1",children:[n.jsxDEV("div",{className:"font-medium",children:e.file_name},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:105,columnNumber:15},this),e.file_size&&n.jsxDEV("div",{className:"text-sm text-muted-foreground",children:[(e.file_size/1024/1024).toFixed(2)," MB"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:107,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:104,columnNumber:13},this),e.file_url&&n.jsxDEV("button",{onClick:()=>null==d?void 0:d(e.file_url,e.file_name),className:"p-2 hover:bg-muted rounded-md",children:n.jsxDEV(x,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:117,columnNumber:17},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:113,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:102,columnNumber:11},this);case"image":return n.jsxDEV("div",{className:"space-y-2",children:[e.file_url&&n.jsxDEV("img",{src:e.file_url,alt:e.file_name||"Resim",className:"max-w-xs rounded-lg cursor-pointer hover:opacity-90",onClick:()=>window.open(e.file_url,"_blank")},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:127,columnNumber:13},this),e.content&&n.jsxDEV("div",{className:"text-sm",children:e.content},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:135,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:125,columnNumber:11},this);case"system":return n.jsxDEV("div",{className:"text-sm text-muted-foreground italic",children:e.content},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:142,columnNumber:11},this);default:return n.jsxDEV("div",{className:"whitespace-pre-wrap break-words",children:e.content},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:149,columnNumber:11},this)}})(),n.jsxDEV("div",{className:"text-xs mt-2 "+("system"===e.message_type?"text-muted-foreground":s?"text-primary-foreground/70":"text-muted-foreground"),children:[(e=>{const s=new Date(e),i=new Date;return s.toDateString()===i.toDateString()?u(s,"HH:mm"):u(s,"dd MMM HH:mm",{locale:h})})(e.created_at),e.edited_at&&n.jsxDEV("span",{className:"ml-1",children:"(düzenlendi)"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:206,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:195,columnNumber:11},this),"system"!==e.message_type&&!c&&n.jsxDEV("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:n.jsxDEV("div",{className:"relative",children:[n.jsxDEV("button",{onClick:()=>f(!b),className:"p-1 hover:bg-background/20 rounded",children:n.jsxDEV(m,{className:"h-3 w-3"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:218,columnNumber:19},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:214,columnNumber:17},this),b&&n.jsxDEV("div",{className:"absolute top-full right-0 mt-1 bg-background border rounded-lg shadow-lg z-10 min-w-[120px]",children:[t&&n.jsxDEV("button",{onClick:()=>{t(e),f(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-t-lg flex items-center",children:[n.jsxDEV(I,{className:"h-3 w-3 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:231,columnNumber:25},this),"Yanıtla"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:224,columnNumber:17},this),s&&r&&"text"===e.message_type&&n.jsxDEV("button",{onClick:()=>{r(e),f(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted flex items-center",children:[n.jsxDEV(E,{className:"h-3 w-3 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:244,columnNumber:25},this),"Düzenle"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:237,columnNumber:17},this),s&&a&&n.jsxDEV("button",{onClick:()=>{a(e.id),f(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-muted rounded-b-lg flex items-center text-red-600",children:[n.jsxDEV(l,{className:"h-3 w-3 mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:257,columnNumber:25},this),"Sil"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:250,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:222,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:213,columnNumber:15},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:212,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:183,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:166,columnNumber:7},this),b&&n.jsxDEV("div",{className:"fixed inset-0 z-5",onClick:()=>f(!1)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:271,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/ChatMessage.tsx",lineNumber:157,columnNumber:5},this)}function P({onSendMessage:e,onFileUpload:s,replyingTo:r,onCancelReply:a,disabled:m=!1,placeholder:o="Mesajınızı yazın..."}){const[l,d]=i.useState(""),[c,u]=i.useState(!1),[h,N]=i.useState(!1),v=i.useRef(null),x=i.useRef(null),y=async()=>{l.trim()&&!m&&(e(l.trim()),d(""),x.current&&(x.current.style.height="auto"))},D=async i=>{if(s){u(!0);try{const n=await s(i),t=i.type.startsWith("image/")?"image":"file";e(i.type.startsWith("image/")?"":`📎 ${n.name}`,t)}catch(n){}finally{u(!1)}}};return n.jsxDEV("div",{className:"border-t bg-background p-4",children:[r&&n.jsxDEV("div",{className:"mb-3 p-3 bg-muted/50 border-l-2 border-primary rounded flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex-1",children:[n.jsxDEV("div",{className:"text-sm text-muted-foreground",children:["Kullanıcı ",r.sender_id," kullanıcısına yanıt veriyor"]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:113,columnNumber:13},this),n.jsxDEV("div",{className:"text-sm truncate mt-1",children:r.content||("file"===r.message_type?`📎 ${r.file_name}`:"Dosya")},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:116,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:112,columnNumber:11},this),a&&n.jsxDEV(t,{size:"sm",variant:"ghost",onClick:a,children:n.jsxDEV(g,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:122,columnNumber:15},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:121,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:111,columnNumber:7},this),n.jsxDEV("div",{className:"relative "+(h?"bg-primary/10 border-primary":""),onDrop:e=>{e.preventDefault(),N(!1);const s=e.dataTransfer.files[0];s&&D(s)},onDragOver:e=>{e.preventDefault(),N(!0)},onDragLeave:e=>{e.preventDefault(),N(!1)},children:[h&&n.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-primary/5 border-2 border-dashed border-primary rounded-lg z-10",children:n.jsxDEV("div",{className:"text-center",children:[n.jsxDEV(p,{className:"h-8 w-8 mx-auto text-primary mb-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:138,columnNumber:15},this),n.jsxDEV("p",{className:"text-primary font-medium",children:"Dosyayı buraya bırakın"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:139,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:137,columnNumber:13},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:136,columnNumber:9},this),n.jsxDEV("div",{className:"flex items-end space-x-2",children:[s&&n.jsxDEV("div",{className:"flex space-x-1",children:[n.jsxDEV("input",{ref:v,type:"file",onChange:e=>{var s;const i=null==(s=e.target.files)?void 0:s[0];i&&D(i)},className:"hidden",accept:"*/*"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:149,columnNumber:15},this),n.jsxDEV(t,{type:"button",size:"sm",variant:"ghost",onClick:()=>{var e;return null==(e=v.current)?void 0:e.click()},disabled:m||c,className:"p-2",children:n.jsxDEV(p,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:165,columnNumber:17},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:157,columnNumber:15},this),n.jsxDEV(t,{type:"button",size:"sm",variant:"ghost",onClick:()=>{v.current&&(v.current.accept="image/*",v.current.click())},disabled:m||c,className:"p-2",children:n.jsxDEV(S,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:181,columnNumber:17},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:168,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:148,columnNumber:11},this),n.jsxDEV("div",{className:"flex-1 relative",children:[n.jsxDEV("textarea",{ref:x,value:l,onChange:e=>{var s;d(e.target.value),(s=e.target).style.height="auto",s.style.height=Math.min(s.scrollHeight,120)+"px"},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},placeholder:c?"Dosya yükleniyor...":o,disabled:m||c,className:"w-full min-h-[40px] max-h-[120px] px-3 py-2 border border-input rounded-md bg-background resize-none focus:ring-2 focus:ring-ring focus:border-transparent",rows:1},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:188,columnNumber:13},this),n.jsxDEV(t,{type:"button",size:"sm",variant:"ghost",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1",disabled:m,children:n.jsxDEV(b,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:207,columnNumber:15},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:200,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:187,columnNumber:11},this),n.jsxDEV(t,{onClick:y,disabled:!l.trim()||m||c,size:"sm",className:"p-2",children:n.jsxDEV(f,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:218,columnNumber:13},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:212,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:145,columnNumber:9},this),c&&n.jsxDEV("div",{className:"mt-2 text-sm text-muted-foreground flex items-center",children:[n.jsxDEV("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:225,columnNumber:13},this),"Dosya yükleniyor..."]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:224,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:129,columnNumber:7},this),n.jsxDEV("div",{className:"mt-2 text-xs text-muted-foreground",children:[n.jsxDEV("span",{children:"Enter ile gönder, Shift+Enter ile yeni satır"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:233,columnNumber:9},this),s&&n.jsxDEV("span",{className:"ml-2",children:"• Dosya yüklemek için sürükleyip bırakabilirsiniz"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:235,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:232,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/components/messages/MessageInput.tsx",lineNumber:108,columnNumber:5},this)}function H(){const[e,r]=i.useState([]),[a,m]=i.useState(null),[o,l]=i.useState([]),[d,c]=i.useState([]),[u,h]=i.useState(!0),[v,g]=i.useState(!1),[x,p]=i.useState(null),[b,_]=i.useState(null),[E,V]=i.useState(!0),M=i.useRef(null),{user:k}=y(),S=null==k?void 0:k.id;i.useEffect(()=>{I()},[!0]),i.useEffect(()=>{a&&(L(a.id),z(a.id),V(!1))},[a]),i.useEffect(()=>{O()},[o]);const I=async()=>{h(!0);try{const e=await K.getConversations();r(e)}catch(e){s.error("Konuşmalar yüklenirken hata oluştu")}finally{h(!1)}},L=async e=>{g(!0);try{const s=await K.getMessages(e);l(s),await K.markConversationAsRead(e)}catch(i){s.error("Mesajlar yüklenirken hata oluştu")}finally{g(!1)}},z=async e=>{try{const s=await K.getConversationParticipants(e);c(s)}catch(s){}},O=()=>{var e;null==(e=M.current)||e.scrollIntoView({behavior:"smooth"})},H=async e=>{_(e.id)},$=async(e,i)=>{try{const{error:s}=await j.from("internal_messages").update({content:i,updated_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;l(s=>s.map(s=>s.id===e?{...s,content:i,updated_at:(new Date).toISOString()}:s)),_(null)}catch(n){s.error("Mesaj güncellenirken bir hata oluştu")}},T=()=>{_(null)},F=async e=>{if(window.confirm("Bu mesajı silmek istediğinizden emin misiniz?"))try{await K.deleteMessage(e),l(s=>s.filter(s=>s.id!==e)),s.success("Mesaj silindi")}catch(i){s.error("Mesaj silinirken hata oluştu")}},Y=e=>{p(e)};return n.jsxDEV("div",{className:"h-[calc(100vh-8rem)] flex bg-background",children:[n.jsxDEV("div",{className:(E?"block":"hidden")+" md:block",children:n.jsxDEV(R,{conversations:e,selectedConversationId:null==a?void 0:a.id,onSelectConversation:e=>{m(e),l([]),p(null),_(null)},onCreateConversation:()=>{},loading:u,currentUserId:S},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:265,columnNumber:9},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:264,columnNumber:7},this),n.jsxDEV("div",{className:`flex-1 flex flex-col ${E?"hidden":"flex"} md:flex`,children:a?n.jsxDEV(n.Fragment,{children:[n.jsxDEV("div",{className:"p-4 border-b bg-card flex items-center justify-between",children:[n.jsxDEV("div",{className:"flex items-center space-x-3",children:[n.jsxDEV(t,{variant:"ghost",size:"sm",className:"md:hidden",onClick:()=>{V(!0),m(null)},children:n.jsxDEV(U,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:289,columnNumber:19},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:283,columnNumber:17},this),n.jsxDEV("div",{className:"w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white",children:"group"===a.conversation_type?n.jsxDEV(N,{className:"h-5 w-5"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:295,columnNumber:17},this):"U"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:293,columnNumber:17},this),n.jsxDEV("div",{children:[n.jsxDEV("h3",{className:"font-semibold",children:a?"group"===a.conversation_type?a.name||"İsimsiz Grup":"Direkt Mesaj":""},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:303,columnNumber:19},this),n.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"group"===a.conversation_type?`${d.filter(e=>!e.left_at).length} katılımcı`:"Aktif"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:304,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:302,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:281,columnNumber:15},this),n.jsxDEV("div",{className:"flex items-center space-x-2",children:[n.jsxDEV(t,{variant:"ghost",size:"sm",children:n.jsxDEV(D,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:316,columnNumber:19},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:315,columnNumber:17},this),n.jsxDEV(t,{variant:"ghost",size:"sm",children:n.jsxDEV(C,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:319,columnNumber:19},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:318,columnNumber:17},this),n.jsxDEV(t,{variant:"ghost",size:"sm",children:n.jsxDEV(w,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:322,columnNumber:19},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:321,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:314,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:280,columnNumber:13},this),n.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:v?n.jsxDEV("div",{className:"text-center py-8",children:[n.jsxDEV("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:331,columnNumber:19},this),n.jsxDEV("p",{className:"text-sm text-muted-foreground mt-2",children:"Mesajlar yükleniyor..."},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:332,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:330,columnNumber:13},this):o.length>0?n.jsxDEV(n.Fragment,{children:[o.map((e,s)=>{const i=e.sender_id===S,t=0===s||o[s-1].sender_id!==e.sender_id||new Date(e.created_at).getTime()-new Date(o[s-1].created_at).getTime()>3e5;return n.jsxDEV(A,{message:e,isCurrentUser:i,showSender:t&&"group"===a.conversation_type,onReply:Y,onEdit:H,onDelete:F,onFileDownload:(e,s)=>{const i=document.createElement("a");i.href=e,i.download=s,i.click()},isEditing:b===e.id,onSaveEdit:$,onCancelEdit:T},e.id,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:343,columnNumber:19},this)}),n.jsxDEV("div",{ref:M},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:363,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:335,columnNumber:13},this):n.jsxDEV("div",{className:"text-center py-8 text-muted-foreground",children:[n.jsxDEV(f,{className:"h-8 w-8 mx-auto mb-2 opacity-50"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:367,columnNumber:19},this),n.jsxDEV("p",{children:"Henüz mesaj yok"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:368,columnNumber:19},this),n.jsxDEV("p",{className:"text-sm",children:"İlk mesajı göndererek konuşmayı başlatın"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:369,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:366,columnNumber:13},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:328,columnNumber:13},this),n.jsxDEV(P,{onSendMessage:async(e,i="text")=>{if(a)try{const s={conversation_id:a.id,content:e,message_type:i,reply_to:null==x?void 0:x.id},n=await K.sendMessage(s);l(e=>[...e,n]),p(null),r(e=>e.map(e=>e.id===a.id?{...e,last_message_at:n.created_at}:e))}catch(n){s.error("Mesaj gönderilirken hata oluştu")}},onFileUpload:async e=>{try{const s=10485760,i=["image/jpeg","image/png","image/gif","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e.size>s)throw new Error("Dosya boyutu 10MB'den küçük olmalıdır");if(!i.includes(e.type))throw new Error("Desteklenmeyen dosya türü");const n=e.name.split(".").pop(),t=`internal-messages/${Date.now()}_${Math.random().toString(36).substring(2)}.${n}`,{error:r}=await j.storage.from("uploads").upload(t,e);if(r)throw r;const{data:a}=j.storage.from("uploads").getPublicUrl(t);return{url:a.publicUrl,name:e.name,size:e.size,path:t}}catch(s){throw s}},replyingTo:x,onCancelReply:()=>p(null),placeholder:"Mesajınızı yazın..."},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:376,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:278,columnNumber:9},this):n.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-center bg-muted/20",children:n.jsxDEV("div",{children:[n.jsxDEV(N,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground/50"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:389,columnNumber:15},this),n.jsxDEV("h3",{className:"text-lg font-medium text-muted-foreground",children:"Konuşma Seçin"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:390,columnNumber:15},this),n.jsxDEV("p",{className:"text-sm text-muted-foreground mt-1",children:"Mesajlaşmaya başlamak için soldaki listeden bir konuşma seçin"},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:391,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:388,columnNumber:13},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:387,columnNumber:9},this)},void 0,!1,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:276,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/idrishamid/nev/src/pages/internal-messages/Index.tsx",lineNumber:262,columnNumber:5},this)}export{H as default};
