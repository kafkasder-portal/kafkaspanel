var t,e,s,i,r,a,n,o,h,u,c,l,d,p,f,y,g,m,v,b,R,w,O,C,S,k,q=t=>{throw TypeError(t)},M=(t,e,s)=>e.has(t)||q("Cannot "+s),E=(t,e,s)=>(M(t,e,"read from private field"),s?s.call(t):e.get(t)),U=(t,e,s)=>e.has(t)?q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),Q=(t,e,s,i)=>(M(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),F=(t,e,s)=>(M(t,e,"access private method"),s);import{aK as T,aL as P,aM as W,aN as x,aO as I,aP as _,aQ as A,aR as D,aS as L,aT as K,aU as j,aV as B,aW as H,r as z,aX as N,aY as V,aZ as X,a_ as Y,a$ as Z,b0 as $,b1 as G,b2 as J,b3 as tt,b4 as et}from"../assets/index-CzvAnh9f.js";var st=(k=class extends T{constructor(g,m){super(),U(this,y),U(this,t),U(this,e),U(this,s),U(this,i),U(this,r),U(this,a),U(this,n),U(this,o),U(this,h),U(this,u),U(this,c),U(this,l),U(this,d),U(this,p),U(this,f,new Set),this.options=m,Q(this,t,g),Q(this,o,null),Q(this,n,P()),this.options.experimental_prefetchInRender||E(this,n).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(m)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(E(this,e).addObserver(this),it(E(this,e),this.options)?F(this,y,g).call(this):this.updateResult(),F(this,y,R).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return rt(E(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return rt(E(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,F(this,y,w).call(this),F(this,y,O).call(this),E(this,e).removeObserver(this)}setOptions(s){const i=this.options,r=E(this,e);if(this.options=E(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof W(this.options.enabled,E(this,e)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");F(this,y,C).call(this),E(this,e).setOptions(this.options),i._defaulted&&!x(this.options,i)&&E(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:E(this,e),observer:this});const a=this.hasListeners();a&&at(E(this,e),r,this.options,i)&&F(this,y,g).call(this),this.updateResult(),!a||E(this,e)===r&&W(this.options.enabled,E(this,e))===W(i.enabled,E(this,e))&&I(this.options.staleTime,E(this,e))===I(i.staleTime,E(this,e))||F(this,y,m).call(this);const n=F(this,y,v).call(this);!a||E(this,e)===r&&W(this.options.enabled,E(this,e))===W(i.enabled,E(this,e))&&n===E(this,p)||F(this,y,b).call(this,n)}getOptimisticResult(s){const n=E(this,t).getQueryCache().build(E(this,t),s),o=this.createResult(n,s);return h=o,!x(this.getCurrentResult(),h)&&(Q(this,i,o),Q(this,a,this.options),Q(this,r,E(this,e).state)),o;var h}getCurrentResult(){return E(this,i)}trackResult(t,e){return new Proxy(t,{get:(t,s)=>(this.trackProp(s),null==e||e(s),Reflect.get(t,s))})}trackProp(t){E(this,f).add(t)}getCurrentQuery(){return E(this,e)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(e){const s=E(this,t).defaultQueryOptions(e),i=E(this,t).getQueryCache().build(E(this,t),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return F(this,y,g).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),E(this,i)))}createResult(t,l){var d;const p=E(this,e),f=this.options,y=E(this,i),g=E(this,r),m=E(this,a),v=t!==p?t.state:E(this,s),{state:b}=t;let R,w={...b},O=!1;if(l._optimisticResults){const e=this.hasListeners(),s=!e&&it(t,l),i=e&&at(t,p,l,f);(s||i)&&(w={...w,...j(b.data,t.options)}),"isRestoring"===l._optimisticResults&&(w.fetchStatus="idle")}let{error:C,errorUpdatedAt:S,status:k}=w;R=w.data;let q=!1;if(void 0!==l.placeholderData&&void 0===R&&"pending"===k){let t;(null==y?void 0:y.isPlaceholderData)&&l.placeholderData===(null==m?void 0:m.placeholderData)?(t=y.data,q=!0):t="function"==typeof l.placeholderData?l.placeholderData(null==(d=E(this,c))?void 0:d.state.data,E(this,c)):l.placeholderData,void 0!==t&&(k="success",R=B(null==y?void 0:y.data,t,l),O=!0)}if(l.select&&void 0!==R&&!q)if(y&&R===(null==g?void 0:g.data)&&l.select===E(this,h))R=E(this,u);else try{Q(this,h,l.select),R=l.select(R),R=B(null==y?void 0:y.data,R,l),Q(this,u,R),Q(this,o,null)}catch(_){Q(this,o,_)}E(this,o)&&(C=E(this,o),R=E(this,u),S=Date.now(),k="error");const M="fetching"===w.fetchStatus,U="pending"===k,F="error"===k,T=U&&M,x=void 0!==R,I={status:k,fetchStatus:w.fetchStatus,isPending:U,isSuccess:"success"===k,isError:F,isInitialLoading:T,isLoading:T,data:R,dataUpdatedAt:w.dataUpdatedAt,error:C,errorUpdatedAt:S,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>v.dataUpdateCount||w.errorUpdateCount>v.errorUpdateCount,isFetching:M,isRefetching:M&&!U,isLoadingError:F&&!x,isPaused:"paused"===w.fetchStatus,isPlaceholderData:O,isRefetchError:F&&x,isStale:nt(t,l),refetch:this.refetch,promise:E(this,n),isEnabled:!1!==W(l.enabled,t)};if(this.options.experimental_prefetchInRender){const e=t=>{"error"===I.status?t.reject(I.error):void 0!==I.data&&t.resolve(I.data)},s=()=>{const t=Q(this,n,I.promise=P());e(t)},i=E(this,n);switch(i.status){case"pending":t.queryHash===p.queryHash&&e(i);break;case"fulfilled":"error"!==I.status&&I.data===i.value||s();break;case"rejected":"error"===I.status&&I.error===i.reason||s()}}return I}updateResult(){const t=E(this,i),s=this.createResult(E(this,e),this.options);Q(this,r,E(this,e).state),Q(this,a,this.options),void 0!==E(this,r).data&&Q(this,c,E(this,e)),x(s,t)||(Q(this,i,s),F(this,y,S).call(this,{listeners:(()=>{if(!t)return!0;const{notifyOnChangeProps:e}=this.options,s="function"==typeof e?e():e;if("all"===s||!s&&!E(this,f).size)return!0;const r=new Set(s??E(this,f));return this.options.throwOnError&&r.add("error"),Object.keys(E(this,i)).some(e=>{const s=e;return E(this,i)[s]!==t[s]&&r.has(s)})})()}))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&F(this,y,R).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap,n=new WeakMap,o=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,l=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,y=new WeakSet,g=function(t){F(this,y,C).call(this);let s=E(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(_)),s},m=function(){F(this,y,w).call(this);const t=I(this.options.staleTime,E(this,e));if(A||E(this,i).isStale||!D(t))return;const s=L(E(this,i).dataUpdatedAt,t);Q(this,l,setTimeout(()=>{E(this,i).isStale||this.updateResult()},s+1))},v=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(E(this,e)):this.options.refetchInterval)??!1},b=function(t){F(this,y,O).call(this),Q(this,p,t),!A&&!1!==W(this.options.enabled,E(this,e))&&D(E(this,p))&&0!==E(this,p)&&Q(this,d,setInterval(()=>{(this.options.refetchIntervalInBackground||K.isFocused())&&F(this,y,g).call(this)},E(this,p)))},R=function(){F(this,y,m).call(this),F(this,y,b).call(this,F(this,y,v).call(this))},w=function(){E(this,l)&&(clearTimeout(E(this,l)),Q(this,l,void 0))},O=function(){E(this,d)&&(clearInterval(E(this,d)),Q(this,d,void 0))},C=function(){const i=E(this,t).getQueryCache().build(E(this,t),this.options);if(i===E(this,e))return;const r=E(this,e);Q(this,e,i),Q(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},S=function(s){H.batch(()=>{s.listeners&&this.listeners.forEach(t=>{t(E(this,i))}),E(this,t).getQueryCache().notify({query:E(this,e),type:"observerResultsUpdated"})})},k);function it(t,e){return function(t,e){return!1!==W(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&rt(t,e,e.refetchOnMount)}function rt(t,e,s){if(!1!==W(e.enabled,t)&&"static"!==I(e.staleTime,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&nt(t,e)}return!1}function at(t,e,s,i){return(t!==e||!1===W(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&nt(t,s)}function nt(t,e){return!1!==W(e.enabled,t)&&t.isStaleByTime(I(e.staleTime,t))}var ot=z.createContext(!1);ot.Provider;var ht=z.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),ut=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function ct(t,e){return function(t,e,s){var i,r,a,n,o;if("object"!=typeof t||Array.isArray(t))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const h=z.useContext(ot),u=z.useContext(ht),c=V(s),l=c.defaultQueryOptions(t);null==(r=null==(i=c.getDefaultOptions().queries)?void 0:i._experimental_beforeQuery)||r.call(i,l),l.queryFn,l._optimisticResults=h?"isRestoring":"optimistic",(t=>{if(t.suspense){const e=t=>"static"===t?t:Math.max(t??1e3,1e3),s=t.staleTime;t.staleTime="function"==typeof s?(...t)=>e(s(...t)):e(s),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,1e3))}})(l),((t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))})(l,u),(t=>{z.useEffect(()=>{t.clearReset()},[t])})(u);const d=!c.getQueryCache().get(l.queryHash),[p]=z.useState(()=>new e(c,l)),f=p.getOptimisticResult(l),y=!h&&!1!==t.subscribed;if(z.useSyncExternalStore(z.useCallback(t=>{const e=y?p.subscribe(H.batchCalls(t)):_;return p.updateResult(),e},[p,y]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),z.useEffect(()=>{p.setOptions(l)},[l,p]),((t,e)=>(null==t?void 0:t.suspense)&&e.isPending)(l,f))throw ut(l,p,u);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:r})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(r&&void 0===t.data||N(s,[t.error,i])))({result:f,errorResetBoundary:u,throwOnError:l.throwOnError,query:c.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw f.error;if(null==(n=null==(a=c.getDefaultOptions().queries)?void 0:a._experimental_afterQuery)||n.call(a,l,f),l.experimental_prefetchInRender&&!A&&((t,e)=>t.isLoading&&t.isFetching&&!e)(f,h)){const t=d?ut(l,p,u):null==(o=c.getQueryCache().get(l.queryHash))?void 0:o.promise;null==t||t.catch(_).finally(()=>{p.updateResult()})}return l.notifyOnChangeProps?f:p.trackResult(f)}(t,st,e)}function lt(){const t=ct({queryKey:["users"],queryFn:G,staleTime:3e5,retry:2}),e=ct({queryKey:["current-user-permissions"],queryFn:J,staleTime:6e5,retry:1}),s=ct({queryKey:["user-statistics"],queryFn:tt,staleTime:3e5,retry:2}),i=function(){const t=V();return X({mutationFn:({targetUserId:t,newRole:e,reason:s})=>Y(t,e,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]}),t.invalidateQueries({queryKey:["role-change-logs"]})}})}(),r=function(){const t=V();return X({mutationFn:({userId:t,profileData:e})=>Z(t,e),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["current-user-permissions"]})}})}(),a=function(){const t=V();return X({mutationFn:({userId:t,isActive:e})=>$(t,e),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]})}})}(),n=function(){const[t,e]=z.useState(""),[s,i]=z.useState("");z.useEffect(()=>{const e=setTimeout(()=>{i(t)},300);return()=>{clearTimeout(e)}},[t]);const r=ct({queryKey:["user-search",s],queryFn:()=>et(s),enabled:s.length>2,staleTime:3e4});return{searchQuery:t,setSearchQuery:e,searchResults:r.data||[],isSearching:r.isFetching,searchError:r.error}}(),[o,h]=z.useState(null),[u,c]=z.useState(!1),[l,d]=z.useState(!1);return{users:t.data||[],permissions:e.data,statistics:s.data,selectedUser:o,isLoading:t.isLoading||e.isLoading,isUpdating:i.isPending||r.isPending||a.isPending,error:t.error||e.error||s.error,showRoleModal:u,showProfileModal:l,handleRoleChange:async(t,e,s)=>{try{return await i.mutateAsync({targetUserId:t,newRole:e,reason:s}),c(!1),h(null),{success:!0}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Bilinmeyen hata"}}},handleProfileUpdate:async(t,e)=>{try{return await r.mutateAsync({userId:t,profileData:e}),d(!1),h(null),{success:!0}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Bilinmeyen hata"}}},handleStatusToggle:async(t,e)=>{try{return await a.mutateAsync({userId:t,isActive:e}),{success:!0}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Bilinmeyen hata"}}},selectUserForRoleChange:t=>{h(t),c(!0)},selectUserForProfileEdit:t=>{h(t),d(!0)},closeModals:()=>{c(!1),d(!1),h(null)},search:n,refetchUsers:t.refetch,refetchStatistics:s.refetch,refetchPermissions:e.refetch}}export{lt as u};
