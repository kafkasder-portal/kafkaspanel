var ye=t=>{throw TypeError(t)};var ee=(t,e,s)=>e.has(t)||ye("Cannot "+s);var r=(t,e,s)=>(ee(t,e,"read from private field"),s?s.call(t):e.get(t)),y=(t,e,s)=>e.has(t)?ye("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,i)=>(ee(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),p=(t,e,s)=>(ee(t,e,"access private method"),s);import{aL as Oe,aM as ge,aN as U,aO as te,aP as N,aQ as se,aR as re,aS as me,aT as Te,aU as we,aV as Fe,aW as be,aX as Ue,r as b,aY as Pe,aZ as G,a_ as de,a$ as Ie,b0 as xe,b1 as Me,b2 as De,b3 as qe,b4 as Le,b5 as _e}from"./index-JhQGfP3r.js";var R,a,X,m,q,B,P,I,Y,k,H,L,_,x,j,o,z,ie,ae,ne,oe,ue,ce,he,Qe,Ce,Ke=(Ce=class extends Oe{constructor(e,s){super();y(this,o);y(this,R);y(this,a);y(this,X);y(this,m);y(this,q);y(this,B);y(this,P);y(this,I);y(this,Y);y(this,k);y(this,H);y(this,L);y(this,_);y(this,x);y(this,j,new Set);this.options=s,d(this,R,e),d(this,I,null),d(this,P,ge()),this.options.experimental_prefetchInRender||r(this,P).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,a).addObserver(this),Re(r(this,a),this.options)?p(this,o,z).call(this):this.updateResult(),p(this,o,oe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return le(r(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return le(r(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,o,ue).call(this),p(this,o,ce).call(this),r(this,a).removeObserver(this)}setOptions(e){const s=this.options,i=r(this,a);if(this.options=r(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof U(this.options.enabled,r(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,o,he).call(this),r(this,a).setOptions(this.options),s._defaulted&&!te(this.options,s)&&r(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,a),observer:this});const u=this.hasListeners();u&&ve(r(this,a),i,this.options,s)&&p(this,o,z).call(this),this.updateResult(),u&&(r(this,a)!==i||U(this.options.enabled,r(this,a))!==U(s.enabled,r(this,a))||N(this.options.staleTime,r(this,a))!==N(s.staleTime,r(this,a)))&&p(this,o,ie).call(this);const n=p(this,o,ae).call(this);u&&(r(this,a)!==i||U(this.options.enabled,r(this,a))!==U(s.enabled,r(this,a))||n!==r(this,x))&&p(this,o,ne).call(this,n)}getOptimisticResult(e){const s=r(this,R).getQueryCache().build(r(this,R),e),i=this.createResult(s,e);return Be(this,i)&&(d(this,m,i),d(this,B,this.options),d(this,q,r(this,a).state)),i}getCurrentResult(){return r(this,m)}trackResult(e,s){return new Proxy(e,{get:(i,u)=>(this.trackProp(u),s==null||s(u),Reflect.get(i,u))})}trackProp(e){r(this,j).add(e)}getCurrentQuery(){return r(this,a)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,R).defaultQueryOptions(e),i=r(this,R).getQueryCache().build(r(this,R),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return p(this,o,z).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,m)))}createResult(e,s){var pe;const i=r(this,a),u=this.options,n=r(this,m),c=r(this,q),O=r(this,B),v=e!==i?e.state:r(this,X),{state:T}=e;let l={...T},w=!1,f;if(s._optimisticResults){const C=this.hasListeners(),Z=!C&&Re(e,s),A=C&&ve(e,i,s,u);(Z||A)&&(l={...l,...Fe(T.data,e.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:M,errorUpdatedAt:D,status:g}=l;f=l.data;let K=!1;if(s.placeholderData!==void 0&&f===void 0&&g==="pending"){let C;n!=null&&n.isPlaceholderData&&s.placeholderData===(O==null?void 0:O.placeholderData)?(C=n.data,K=!0):C=typeof s.placeholderData=="function"?s.placeholderData((pe=r(this,H))==null?void 0:pe.state.data,r(this,H)):s.placeholderData,C!==void 0&&(g="success",f=be(n==null?void 0:n.data,C,s),w=!0)}if(s.select&&f!==void 0&&!K)if(n&&f===(c==null?void 0:c.data)&&s.select===r(this,Y))f=r(this,k);else try{d(this,Y,s.select),f=s.select(f),f=be(n==null?void 0:n.data,f,s),d(this,k,f),d(this,I,null)}catch(C){d(this,I,C)}r(this,I)&&(M=r(this,I),f=r(this,k),D=Date.now(),g="error");const V=l.fetchStatus==="fetching",S=g==="pending",F=g==="error",Q=S&&V,W=f!==void 0,E={status:g,fetchStatus:l.fetchStatus,isPending:S,isSuccess:g==="success",isError:F,isInitialLoading:Q,isLoading:Q,data:f,dataUpdatedAt:l.dataUpdatedAt,error:M,errorUpdatedAt:D,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>v.dataUpdateCount||l.errorUpdateCount>v.errorUpdateCount,isFetching:V,isRefetching:V&&!S,isLoadingError:F&&!W,isPaused:l.fetchStatus==="paused",isPlaceholderData:w,isRefetchError:F&&W,isStale:fe(e,s),refetch:this.refetch,promise:r(this,P),isEnabled:U(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const C=$=>{E.status==="error"?$.reject(E.error):E.data!==void 0&&$.resolve(E.data)},Z=()=>{const $=d(this,P,E.promise=ge());C($)},A=r(this,P);switch(A.status){case"pending":e.queryHash===i.queryHash&&C(A);break;case"fulfilled":(E.status==="error"||E.data!==A.value)&&Z();break;case"rejected":(E.status!=="error"||E.error!==A.reason)&&Z();break}}return E}updateResult(){const e=r(this,m),s=this.createResult(r(this,a),this.options);if(d(this,q,r(this,a).state),d(this,B,this.options),r(this,q).data!==void 0&&d(this,H,r(this,a)),te(s,e))return;d(this,m,s);const i=()=>{if(!e)return!0;const{notifyOnChangeProps:u}=this.options,n=typeof u=="function"?u():u;if(n==="all"||!n&&!r(this,j).size)return!0;const c=new Set(n??r(this,j));return this.options.throwOnError&&c.add("error"),Object.keys(r(this,m)).some(O=>{const h=O;return r(this,m)[h]!==e[h]&&c.has(h)})};p(this,o,Qe).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,o,oe).call(this)}},R=new WeakMap,a=new WeakMap,X=new WeakMap,m=new WeakMap,q=new WeakMap,B=new WeakMap,P=new WeakMap,I=new WeakMap,Y=new WeakMap,k=new WeakMap,H=new WeakMap,L=new WeakMap,_=new WeakMap,x=new WeakMap,j=new WeakMap,o=new WeakSet,z=function(e){p(this,o,he).call(this);let s=r(this,a).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(se)),s},ie=function(){p(this,o,ue).call(this);const e=N(this.options.staleTime,r(this,a));if(re||r(this,m).isStale||!me(e))return;const i=Te(r(this,m).dataUpdatedAt,e)+1;d(this,L,setTimeout(()=>{r(this,m).isStale||this.updateResult()},i))},ae=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,a)):this.options.refetchInterval)??!1},ne=function(e){p(this,o,ce).call(this),d(this,x,e),!(re||U(this.options.enabled,r(this,a))===!1||!me(r(this,x))||r(this,x)===0)&&d(this,_,setInterval(()=>{(this.options.refetchIntervalInBackground||we.isFocused())&&p(this,o,z).call(this)},r(this,x)))},oe=function(){p(this,o,ie).call(this),p(this,o,ne).call(this,p(this,o,ae).call(this))},ue=function(){r(this,L)&&(clearTimeout(r(this,L)),d(this,L,void 0))},ce=function(){r(this,_)&&(clearInterval(r(this,_)),d(this,_,void 0))},he=function(){const e=r(this,R).getQueryCache().build(r(this,R),this.options);if(e===r(this,a))return;const s=r(this,a);d(this,a,e),d(this,X,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Qe=function(e){Ue.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,m))}),r(this,R).getQueryCache().notify({query:r(this,a),type:"observerResultsUpdated"})})},Ce);function Ae(t,e){return U(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Re(t,e){return Ae(t,e)||t.state.data!==void 0&&le(t,e,e.refetchOnMount)}function le(t,e,s){if(U(e.enabled,t)!==!1&&N(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&fe(t,e)}return!1}function ve(t,e,s,i){return(t!==e||U(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&fe(t,s)}function fe(t,e){return U(e.enabled,t)!==!1&&t.isStaleByTime(N(e.staleTime,t))}function Be(t,e){return!te(t.getCurrentResult(),e)}var Ee=b.createContext(!1),ke=()=>b.useContext(Ee);Ee.Provider;function He(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var je=b.createContext(He()),Ve=()=>b.useContext(je),We=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},ze=t=>{b.useEffect(()=>{t.clearReset()},[t])},Ne=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:u})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(u&&t.data===void 0||Pe(s,[t.error,i])),Xe=t=>{if(t.suspense){const e=i=>i==="static"?i:Math.max(i??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...i)=>e(s(...i)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Ye=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Se=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function $e(t,e,s){var l,w,f,M,D;const i=ke(),u=Ve(),n=G(),c=n.defaultQueryOptions(t);(w=(l=n.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||w.call(l,c),c._optimisticResults=i?"isRestoring":"optimistic",Xe(c),We(c,u),ze(u);const O=!n.getQueryCache().get(c.queryHash),[h]=b.useState(()=>new e(n,c)),v=h.getOptimisticResult(c),T=!i&&t.subscribed!==!1;if(b.useSyncExternalStore(b.useCallback(g=>{const K=T?h.subscribe(Ue.batchCalls(g)):se;return h.updateResult(),K},[h,T]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),b.useEffect(()=>{h.setOptions(c)},[c,h]),Ze(c,v))throw Se(c,h,u);if(Ne({result:v,errorResetBoundary:u,throwOnError:c.throwOnError,query:n.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw v.error;if((M=(f=n.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||M.call(f,c,v),c.experimental_prefetchInRender&&!re&&Ye(v,i)){const g=O?Se(c,h,u):(D=n.getQueryCache().get(c.queryHash))==null?void 0:D.promise;g==null||g.catch(se).finally(()=>{h.updateResult()})}return c.notifyOnChangeProps?v:h.trackResult(v)}function J(t,e){return $e(t,Ke)}function Ge(){return J({queryKey:["users"],queryFn:De,staleTime:5*60*1e3,retry:2})}function Je(){return J({queryKey:["current-user-permissions"],queryFn:qe,staleTime:10*60*1e3,retry:1})}function et(){return J({queryKey:["user-statistics"],queryFn:Le,staleTime:5*60*1e3,retry:2})}function tt(){const t=G();return de({mutationFn:({targetUserId:e,newRole:s,reason:i})=>Ie(e,s,i),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]}),t.invalidateQueries({queryKey:["role-change-logs"]})}})}function st(){const t=G();return de({mutationFn:({userId:e,profileData:s})=>xe(e,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["current-user-permissions"]})}})}function rt(){const t=G();return de({mutationFn:({userId:e,isActive:s})=>Me(e,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]})}})}function it(){const[t,e]=b.useState(""),[s,i]=b.useState("");b.useEffect(()=>{const n=setTimeout(()=>{i(t)},300);return()=>{clearTimeout(n)}},[t]);const u=J({queryKey:["user-search",s],queryFn:()=>_e(s),enabled:s.length>2,staleTime:30*1e3});return{searchQuery:t,setSearchQuery:e,searchResults:u.data||[],isSearching:u.isFetching,searchError:u.error}}function ut(){const t=Ge(),e=Je(),s=et(),i=tt(),u=st(),n=rt(),c=it(),[O,h]=b.useState(null),[v,T]=b.useState(!1),[l,w]=b.useState(!1),f=async(S,F,Q)=>{try{return await i.mutateAsync({targetUserId:S,newRole:F,reason:Q}),T(!1),h(null),{success:!0}}catch(W){return{success:!1,error:W instanceof Error?W.message:"Bilinmeyen hata"}}},M=async(S,F)=>{try{return await u.mutateAsync({userId:S,profileData:F}),w(!1),h(null),{success:!0}}catch(Q){return{success:!1,error:Q instanceof Error?Q.message:"Bilinmeyen hata"}}},D=async(S,F)=>{try{return await n.mutateAsync({userId:S,isActive:F}),{success:!0}}catch(Q){return{success:!1,error:Q instanceof Error?Q.message:"Bilinmeyen hata"}}},g=S=>{h(S),T(!0)},K=S=>{h(S),w(!0)},V=()=>{T(!1),w(!1),h(null)};return{users:t.data||[],permissions:e.data,statistics:s.data,selectedUser:O,isLoading:t.isLoading||e.isLoading,isUpdating:i.isPending||u.isPending||n.isPending,error:t.error||e.error||s.error,showRoleModal:v,showProfileModal:l,handleRoleChange:f,handleProfileUpdate:M,handleStatusToggle:D,selectUserForRoleChange:g,selectUserForProfileEdit:K,closeModals:V,search:c,refetchUsers:t.refetch,refetchStatistics:s.refetch,refetchPermissions:e.refetch}}export{ut as u};
