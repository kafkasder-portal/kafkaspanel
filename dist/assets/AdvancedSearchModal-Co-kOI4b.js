var Ce=Object.defineProperty;var Ee=(y,e,t)=>e in y?Ce(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t;var j=(y,e,t)=>Ee(y,typeof e!="symbol"?e+"":e,t);import{r as g,j as a,c as E,X as Ae,a4 as Re,t as Oe,F as Ve,S as $e}from"./index-JhQGfP3r.js";import{i as W,e as P,s as Ue}from"./sanitization-BJYGODn_.js";class Q{constructor(e,t=[],s=[],r=[]){j(this,"fields");j(this,"dependencies");j(this,"groups");j(this,"validationRules");j(this,"_visibleFieldsCache");this.fields=e,this.dependencies=t,this.groups=s,this.validationRules=r}getVisibleFields(e){var r;const t=JSON.stringify(Object.keys(e).sort());if(((r=this._visibleFieldsCache)==null?void 0:r.key)===t)return this._visibleFieldsCache.fields;const s=this.fields.filter(n=>{const l=this.dependencies.find(d=>d.field===n.key);if(!l)return!0;const o=e[l.dependsOn];return this.evaluateCondition(o,l.condition)});return this._visibleFieldsCache={key:t,fields:s},s}getEnabledFields(e){const t=[];return this.fields.forEach(s=>{const r=this.dependencies.find(l=>l.field===s.key&&l.action==="enable");if(!r){t.push(s.key);return}const n=e[r.dependsOn];this.evaluateCondition(n,r.condition)&&t.push(s.key)}),t}getFieldsToClear(e,t){const s=[];return this.dependencies.forEach(r=>{r.dependsOn===e&&r.action==="clear"&&(this.evaluateCondition(t,r.condition)||s.push(r.field))}),s}validateFilters(e){const t={},s=this.getVisibleFields(e),r=this.getEnabledFields(e);for(const n of s){if(!r.includes(n.key))continue;const l=e[n.key],o=this.validationRules.find(d=>d.field===n.key);if(o){if(o.rules.required&&this.isEmpty(l)){t[n.key]=`${n.label} alanı zorunludur`;continue}if(!this.isEmpty(l)){if(typeof l=="number"){if(o.rules.min!==void 0&&l<o.rules.min){t[n.key]=`${n.label} en az ${o.rules.min} olmalıdır`;continue}if(o.rules.max!==void 0&&l>o.rules.max){t[n.key]=`${n.label} en fazla ${o.rules.max} olmalıdır`;continue}}if(typeof l=="string"){if(o.rules.min!==void 0&&l.length<o.rules.min){t[n.key]=`${n.label} en az ${o.rules.min} karakter olmalıdır`;continue}if(o.rules.max!==void 0&&l.length>o.rules.max){t[n.key]=`${n.label} en fazla ${o.rules.max} karakter olmalıdır`;continue}}if(o.rules.pattern&&typeof l=="string"&&!new RegExp(o.rules.pattern).test(l)){t[n.key]=`${n.label} geçerli bir format değil`;continue}if(o.rules.custom){const d=o.rules.custom(l,e);if(d){t[n.key]=d;continue}}}}}return{isValid:Object.keys(t).length===0,errors:t}}getGroupedFields(e){const t=this.getVisibleFields(e),s=[],r=new Set;this.groups.forEach(l=>{const o=t.filter(d=>l.fields.includes(d.key));o.length>0&&(s.push({group:l,fields:o}),o.forEach(d=>r.add(d.key)))});const n=t.filter(l=>!r.has(l.key));return n.length>0&&s.push({group:null,fields:n}),s}applyFilterChange(e,t,s){const r={...e,[t]:s};return this.getFieldsToClear(t,s).forEach(l=>{delete r[l]}),r}buildQueryParams(e){const t={},s=this.getVisibleFields(e),r=this.getEnabledFields(e),n=Object.entries(e).filter(([,l])=>!this.isEmpty(l));for(const l of s){if(!r.includes(l.key))continue;const o=n.find(([k])=>k===l.key);if(!o)continue;const[,d]=o;switch(l.type){case"multiSelect":Array.isArray(d)&&d.length>0&&(t[l.key]=d);break;case"dateRange":d&&d.start&&d.end&&(t[`${l.key}_start`]=d.start,t[`${l.key}_end`]=d.end);break;case"numberRange":d&&(d.min!==void 0||d.max!==void 0)&&(d.min!==void 0&&(t[`${l.key}_min`]=d.min),d.max!==void 0&&(t[`${l.key}_max`]=d.max));break;default:t[l.key]=d}}return t}evaluateCondition(e,t){const{operator:s,value:r}=t;switch(s){case"equals":return e===r;case"not_equals":return e!==r;case"contains":return typeof e=="string"&&typeof r=="string"&&e.includes(r);case"not_contains":return typeof e=="string"&&typeof r=="string"&&!e.includes(r);case"greater_than":return typeof e=="number"&&typeof r=="number"&&e>r;case"less_than":return typeof e=="number"&&typeof r=="number"&&e<r;case"in":return Array.isArray(r)&&r.includes(e);case"not_in":return Array.isArray(r)&&!r.includes(e);default:return!1}}isEmpty(e){return e==null||e===""?!0:Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0||Object.values(e).every(t=>t==null||t===""):!1}resetFilters(){const e={};return this.fields.forEach(t=>{switch(t.type){case"multiSelect":e[t.key]=t.defaultValue!==void 0?t.defaultValue:[];break;case"numberRange":e[t.key]=t.defaultValue!==void 0?t.defaultValue:{};break;case"dateRange":e[t.key]=t.defaultValue!==void 0?t.defaultValue:{};break;default:e[t.key]=t.defaultValue!==void 0?t.defaultValue:""}}),e}static resetFilters(e){const t={};return e.forEach(s=>{switch(s.type){case"multiSelect":t[s.key]=s.defaultValue!==void 0?s.defaultValue:[];break;case"numberRange":t[s.key]=s.defaultValue!==void 0?s.defaultValue:{};break;case"dateRange":t[s.key]=s.defaultValue!==void 0?s.defaultValue:{};break;default:t[s.key]=s.defaultValue!==void 0?s.defaultValue:""}}),t}static buildFilterQuery(e){const t={};return Object.entries(e).forEach(([s,r])=>{r==null||r===""||(Array.isArray(r)?r.length>0&&(t[s]=r):typeof r=="object"?r.from&&r.to?(t[`${s}_from`]=r.from,t[`${s}_to`]=r.to):r.min!==void 0||r.max!==void 0?(r.min!==void 0&&(t[`${s}_min`]=r.min),r.max!==void 0&&(t[`${s}_max`]=r.max)):Object.keys(r).length>0&&(t[s]=r):t[s]=r)}),t}static getVisibleFields(e){return e.filter(t=>t.visible!==!1)}static validateFilters(e,t,s=[]){const r={};for(const n of t){const l=e[n.key],o=n.validation;if(o){if(o.required&&(!l||l==="")){r[n.key]="Bu alan zorunludur";continue}if(!(!l||l==="")){if(o.minLength&&typeof l=="string"&&l.length<o.minLength){r[n.key]=`En az ${o.minLength} karakter olmalıdır`;continue}if(o.pattern&&typeof l=="string"&&!new RegExp(o.pattern).test(l)){r[n.key]="Geçerli bir email adresi girin";continue}if(typeof l=="number"){if(o.min!==void 0&&l<o.min){r[n.key]=`Minimum değer ${o.min} olmalıdır`;continue}if(o.max!==void 0&&l>o.max){r[n.key]=`Maksimum değer ${o.max} olmalıdır`;continue}}}}}for(const n of s)if(n.rules.custom){const l=e[n.field],o=n.rules.custom(l,e);o&&(r[n.field]=o)}return r}static applyDependencies(e,t,s){return e.map(r=>{const n=s.filter(d=>d.field===r.key);if(n.length===0)return{...r,visible:!0,enabled:!0};let l=r.visible!==!1,o=r.enabled!==!1;for(const d of n){const k=t[d.dependsOn],N=Q.evaluateCondition(k,d.condition);d.action==="show"?l=l&&N:d.action==="hide"?l=l&&!N:d.action==="enable"?o=o&&N:d.action==="disable"&&(o=o&&!N)}return{...r,visible:l,enabled:o}})}static evaluateCondition(e,t){const{operator:s,value:r}=t;switch(s){case"equals":return e===r;case"not_equals":return e!==r;case"contains":return typeof e=="string"&&typeof r=="string"&&e.includes(r);case"not_contains":return typeof e=="string"&&typeof r=="string"&&!e.includes(r);case"greater_than":return typeof e=="number"&&typeof r=="number"&&e>r;case"less_than":return typeof e=="number"&&typeof r=="number"&&e<r;case"greater_than_or_equal":return typeof e=="number"&&typeof r=="number"&&e>=r;case"less_than_or_equal":return typeof e=="number"&&typeof r=="number"&&e<=r;case"in":return Array.isArray(r)&&r.includes(e);case"not_in":return Array.isArray(r)&&!r.includes(e);case"not_empty":return e!=null&&e!=="";case"empty":return e==null||e==="";default:return!1}}}const Ke=()=>({fields:[{key:"name",label:"Ad Soyad",type:"text",placeholder:"Yararlanıcı adı ara..."},{key:"status",label:"Durum",type:"select",options:[{value:"active",label:"Aktif"},{value:"inactive",label:"Pasif"},{value:"pending",label:"Beklemede"}]},{key:"categories",label:"Kategoriler",type:"multiSelect",options:[{value:"education",label:"Eğitim"},{value:"health",label:"Sağlık"},{value:"food",label:"Gıda"},{value:"shelter",label:"Barınma"}]},{key:"ageRange",label:"Yaş Aralığı",type:"numberRange",validation:{min:0,max:120}},{key:"registrationDate",label:"Kayıt Tarihi",type:"dateRange"},{key:"priority",label:"Öncelik",type:"select",options:[{value:"high",label:"Yüksek"},{value:"medium",label:"Orta"},{value:"low",label:"Düşük"}]},{key:"hasActiveApplication",label:"Aktif Başvuru Var",type:"select",options:[{value:"true",label:"Evet"},{value:"false",label:"Hayır"}]}],dependencies:[{field:"priority",dependsOn:"status",condition:{operator:"equals",value:"active"},action:"show"}],groups:[{id:"basic",key:"basic",label:"Temel Bilgiler",fields:["name","status","categories"],operator:"AND"},{id:"demographics",key:"demographics",label:"Demografik Bilgiler",fields:["ageRange","registrationDate"],operator:"AND",collapsible:!0,defaultCollapsed:!0},{id:"advanced",key:"advanced",label:"Gelişmiş Filtreler",fields:["priority","hasActiveApplication"],operator:"AND",collapsible:!0,defaultCollapsed:!0}],validationRules:[{field:"ageRange",rules:{custom:r=>{if(r&&typeof r=="object"&&r!==null&&"min"in r&&"max"in r){const n=r;if(n.min&&n.max&&n.min>n.max)return"Minimum yaş maksimum yaştan büyük olamaz"}return null}}}]});class De{constructor(e){j(this,"config");this.config={paramPrefix:"filter_",encodeValues:!0,excludeEmpty:!0,dateFormat:"iso",...e}}filtersToURL(e){const t=new URLSearchParams;Object.entries(e).forEach(([r,n])=>{if(this.config.excludeEmpty&&this.isEmpty(n))return;const l=this.config.paramPrefix+r,o=this.serializeValue(n);o!==null&&t.set(l,o)});const s=t.toString();return s?`${this.config.baseUrl}?${s}`:this.config.baseUrl}urlToFilters(e){const t={};try{if(!W(e))return console.warn("Invalid URL provided to urlToFilters:",e),{};let s;if(e.startsWith("http://")||e.startsWith("https://"))s=P(e);else{const n=typeof window<"u"?window.location.origin:"http://localhost";s=P(e,n)}if(!s)return console.warn("Failed to construct URL object for filters:",e),{};s.searchParams.forEach((n,l)=>{if(l.startsWith(this.config.paramPrefix||"")){const o=l.replace(this.config.paramPrefix||"",""),d=Ue(n),k=this.deserializeValue(d);k!==null&&(t[o]=k)}})}catch(s){console.warn("Invalid URL provided to urlToFilters:",s)}return t}getCurrentFilters(){return typeof window>"u"?{}:this.urlToFilters(window.location.href)}updateBrowserURL(e,t=!1){if(typeof window>"u")return;const s=this.filtersToURL(e);if(!W(s)&&!s.startsWith("/")){console.warn("Generated invalid URL, skipping update:",s);return}t?window.history.replaceState({},"",s):window.history.pushState({},"",s)}generateShareableURL(e,t){try{const s=this.filtersToURL(e);if(t){if(!W(t))return console.warn("Invalid base URL provided:",t),s;const r=P(s,t);return r?r.toString():s}if(typeof window<"u"&&window.location&&window.location.origin){const r=P(s,window.location.origin);return r?r.toString():s}return s}catch(s){return console.warn("Failed to generate shareable URL:",s),""}}parseShareableURL(e){return this.urlToFilters(e)}createFilteredURL(e,t){const s={...e,...t};return this.filtersToURL(s)}removeFiltersFromURL(e,t){const s={...e};return t.forEach(r=>{delete s[r]}),this.filtersToURL(s)}hasFilters(){const e=this.getCurrentFilters();return Object.keys(e).length>0}clearFiltersFromURL(e=!1){if(typeof window>"u")return;const t=this.config.baseUrl;e?window.history.replaceState({},"",t):window.history.pushState({},"",t)}onURLChange(e){if(typeof window>"u")return()=>{};const t=()=>{const s=this.getCurrentFilters();e(s)};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}}validateURLFilters(e,t){const s={};return Object.entries(e).forEach(([r,n])=>{t.includes(r)&&(s[r]=n)}),s}serializeValue(e){if(this.isEmpty(e))return null;try{if(typeof e=="string")return this.config.encodeValues?encodeURIComponent(e):e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(e instanceof Date)switch(this.config.dateFormat){case"timestamp":return String(e.getTime());case"date":return e.toISOString().split("T")[0];case"iso":default:return e.toISOString()}if(Array.isArray(e)){const t=e.filter(s=>!this.isEmpty(s)).map(s=>this.serializeValue(s)).filter(s=>s!==null);return t.length>0?t.join(","):null}if(typeof e=="object"&&e!==null){if("start"in e&&"end"in e&&e.start&&e.end){const t=this.serializeValue(e.start),s=this.serializeValue(e.end);return t&&s?`${t}|${s}`:null}if("min"in e||"max"in e){const t="min"in e&&e.min!==void 0?String(e.min):"",s="max"in e&&e.max!==void 0?String(e.max):"";return`${t}|${s}`}return JSON.stringify(e)}return String(e)}catch(t){return console.warn("Error serializing value:",e,t),null}}deserializeValue(e){if(!e)return null;try{const t=this.config.encodeValues?decodeURIComponent(e):e;if(t.includes(",")&&!t.includes("|"))return t.split(",").map(s=>{const r=s.trim();return this.parseSimpleValue(r)});if(t.includes("|")){const[s,r]=t.split("|");return this.isDateString(s)||this.isDateString(r)?{start:s?this.parseDate(s):null,end:r?this.parseDate(r):null}:this.isNumeric(s)||this.isNumeric(r)?{min:s?Number(s):void 0,max:r?Number(r):void 0}:{start:s||null,end:r||null}}return t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]")?JSON.parse(t):this.parseSimpleValue(t)}catch(t){return console.warn("Error deserializing value:",e,t),e}}parseSimpleValue(e){return e==="true"?!0:e==="false"?!1:this.isNumeric(e)?Number(e):this.isDateString(e)?this.parseDate(e):e}parseDate(e){try{if(this.config.dateFormat==="timestamp"&&this.isNumeric(e))return new Date(Number(e));const t=new Date(e);return isNaN(t.getTime())?null:t}catch{return null}}isNumeric(e){return!isNaN(Number(e))&&!isNaN(parseFloat(e))}isDateString(e){if(!e)return!1;if(/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?)?$/.test(e))return!0;if(this.config.dateFormat==="timestamp"&&this.isNumeric(e)){const s=Number(e);return s>0&&s<Date.now()*2}return!1}isEmpty(e){return e==null||e===""?!0:Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0||Object.values(e).every(t=>t==null||t===""):!1}}const Be=()=>({baseUrl:"/beneficiaries",paramPrefix:"bf_",encodeValues:!0,excludeEmpty:!0,dateFormat:"iso"});class ze{constructor(e){j(this,"config");j(this,"storageKey");this.config={maxSavedFilters:50,enableCloud:!1,...e},this.storageKey=e.userId?`${e.storageKey}_${e.userId}`:e.storageKey}async saveFilter(e){const t=await this.getSavedFilters();if(t.length>=(this.config.maxSavedFilters||50))throw new Error(`Maksimum ${this.config.maxSavedFilters} adet filtre kaydedebilirsiniz`);if(t.some(n=>n.name===e.name&&n.pageType===e.pageType))throw new Error("Bu isimde bir filtre zaten mevcut");const s={...e,id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()},r=[...t,s];return await this.storeSavedFilters(r),s}async getSavedFilters(e){try{const t=localStorage.getItem(this.storageKey),s=t?JSON.parse(t):[];return e?s.filter(r=>r.pageType===e):s}catch(t){return console.error("Error loading saved filters:",t),[]}}async getSavedFilter(e){return(await this.getSavedFilters()).find(s=>s.id===e)||null}async updateSavedFilter(e,t){const s=await this.getSavedFilters(),r=s.findIndex(l=>l.id===e);if(r===-1)throw new Error("Filtre bulunamadı");if(t.name&&t.name!==s[r].name&&s.some((o,d)=>d!==r&&o.name===t.name&&o.pageType===s[r].pageType))throw new Error("Bu isimde bir filtre zaten mevcut");const n={...s[r],...t,updatedAt:new Date().toISOString()};return s[r]=n,await this.storeSavedFilters(s),n}async deleteSavedFilter(e){const t=await this.getSavedFilters(),s=t.filter(r=>r.id!==e);return s.length===t.length?!1:(await this.storeSavedFilters(s),!0)}async loadSavedFilter(e){const t=await this.getSavedFilter(e);return t?(await this.updateSavedFilter(e,{usageCount:t.usageCount+1,lastUsed:new Date().toISOString()}),t):null}async getRecentFilters(e,t=5){return(await this.getSavedFilters(e)).filter(r=>r.usageCount>0).sort((r,n)=>new Date(n.lastUsed).getTime()-new Date(r.lastUsed).getTime()).slice(0,t)}async getPopularFilters(e,t=5){return(await this.getSavedFilters(e)).filter(r=>r.usageCount>0).sort((r,n)=>n.usageCount-r.usageCount).slice(0,t)}async searchSavedFilters(e,t){const s=await this.getSavedFilters(t),r=e.toLowerCase();return s.filter(n=>n.name.toLowerCase().includes(r)||n.description&&n.description.toLowerCase().includes(r))}async exportSavedFilters(e){const t=await this.getSavedFilters(e);return JSON.stringify(t,null,2)}async importSavedFilters(e,t=!1){try{const s=JSON.parse(e);if(!Array.isArray(s))throw new Error("Geçersiz veri formatı");const r=await this.getSavedFilters();let n;if(t)n=s.map(l=>({...l,id:this.generateId(),createdAt:l.createdAt,updatedAt:new Date().toISOString(),lastUsed:l.lastUsed}));else{const l=new Set(r.map(d=>`${d.name}_${d.pageType}`)),o=s.filter(d=>!l.has(`${d.name}_${d.pageType}`));n=[...r,...o.map(d=>({...d,id:this.generateId(),createdAt:d.createdAt,updatedAt:new Date().toISOString(),lastUsed:d.lastUsed}))]}return await this.storeSavedFilters(n),t?s.length:n.length-r.length}catch(s){throw new Error("Filtreler içe aktarılırken hata oluştu: "+s.message)}}async clearAllSavedFilters(e){if(e){const t=await this.getSavedFilters(),s=t.filter(n=>n.pageType!==e),r=t.length-s.length;return await this.storeSavedFilters(s),r}else{const s=(await this.getSavedFilters()).length;return localStorage.removeItem(this.storageKey),s}}async getStorageStats(){const e=await this.getSavedFilters(),t=JSON.stringify(e).length,s={};let r,n;return e.forEach(l=>{s[l.pageType]=(s[l.pageType]||0)+1,(!r||l.createdAt<r)&&(r=l.createdAt),(!n||l.createdAt>n)&&(n=l.createdAt)}),{totalFilters:e.length,totalSize:t,filtersByPage:s,oldestFilter:r,newestFilter:n}}async storeSavedFilters(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){throw new Error("Filtreler kaydedilirken hata oluştu: "+t.message)}}generateId(){return`filter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}function Le(y,e){let t=null;return function(...r){const n=()=>{t=null,y(...r)};t!==null&&clearTimeout(t),t=setTimeout(n,e)}}const Pe=g.memo(function({isOpen:e,onClose:t,onApplyFilters:s,fields:r,initialFilters:n={},savedFilters:l=[],quickFilters:o=[],onSaveFilter:d,onDeleteFilter:k,onLoadFilter:N,title:ke="Gelişmiş Arama",pageType:A,enableURLSync:R=!0,enableExport:we=!1,onExport:Y,dependencies:X=[],groups:Z=[],validationRules:ee=[],urlConfig:q,savedFiltersConfig:G}){const[f,O]=g.useState(n),[V,I]=g.useState(""),[ve,H]=g.useState(!1),[$,_]=g.useState("filters"),[U,z]=g.useState({}),[L,M]=g.useState(!1),[te,K]=g.useState(null),x=g.useMemo(()=>new Q(r,X,Z,ee),[r,X,Z,ee]),w=g.useMemo(()=>q?new De(q):null,[q]),p=g.useMemo(()=>G?new ze(G):null,[G]);g.useEffect(()=>{e&&O(n)},[e,n]),g.useEffect(()=>{if(R&&e&&w){const i=w.getCurrentFilters(),{errors:c}=x.validateFilters(i);Object.keys(c).length>0&&O(m=>({...m,...i}))}},[e,R,w,x,r]),g.useEffect(()=>!R||!w?void 0:w.onURLChange(c=>{const{errors:m}=x.validateFilters(c);Object.keys(m).length===0&&(O(c),z({}))}),[R,w,x,r]);const B=g.useCallback(i=>{const{errors:c}=x.validateFilters(i);return z(c),Object.keys(c).length===0},[x]),T=g.useMemo(()=>Le(i=>{!R||!w||w.updateBrowserURL(i,!0)},300),[R,w]),v=g.useCallback((i,c)=>{const m=x.applyFilterChange(f,i,c);O(m);const u=Object.keys(f).filter(b=>!(b in m));(U[i]||u.some(b=>U[b]))&&z(b=>{const S={...b};return delete S[i],u.forEach(D=>delete S[D]),S}),T(m)},[x,f,U,T]),je=g.useCallback(async()=>{try{M(!0),K(null),B(f)&&(await s(f),t())}catch(i){K(i instanceof Error?i.message:"Filtreler uygulanırken bir hata oluştu")}finally{M(!1)}},[f,s,t,B]),Fe=g.useCallback(()=>{const i={};O(i),z({}),T(i)},[T]),J=g.useCallback(async(i=!1)=>{if(V.trim()&&d&&B(f))try{if(M(!0),K(null),p){const c={id:Date.now().toString(),name:V.trim(),filters:f,createdAt:new Date().toISOString(),pageType:A,isQuickFilter:i,updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()};await p.saveFilter(c)}d({name:V.trim(),description:"",filters:f,pageType:A,isQuickFilter:i||!1,updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()}),I(""),H(!1)}catch(c){K(c instanceof Error?c.message:"Filtre kaydedilirken bir hata oluştu")}finally{M(!1)}},[V,d,B,f,p,A]),re=i=>{p&&p.loadSavedFilter(i.id),O(i.filters),z({}),T(i.filters),N&&N(i),_("filters")},se=i=>{var ae,ie,ne,le,oe,de,ce,ue,me,he,ge,fe,pe,xe,ye;const c=f[i.key]||(i.type==="multiSelect"?[]:i.type==="dateRange"||i.type==="numberRange"?{}:""),u=!!U[i.key],b=x.getVisibleFields(f),S=x.getEnabledFields(f),D=b.some(h=>h.key===i.key),F=S.includes(i.key);if(!D||i.conditional&&f[i.conditional.field]!==i.conditional.value)return null;const C=`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${u?"border-red-500":"border-gray-300 dark:border-gray-600"}`;switch(i.type){case"text":case"number":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("input",{type:i.type==="number"?"number":"text",placeholder:i.placeholder||i.label,value:c,onChange:h=>v(i.key,h.target.value),disabled:!F,className:`${C} ${F?"":"bg-gray-100 cursor-not-allowed"}`,min:(ae=i.validation)==null?void 0:ae.min,max:(ie=i.validation)==null?void 0:ie.max,pattern:(ne=i.validation)==null?void 0:ne.pattern}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"select":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("select",{value:c,onChange:h=>v(i.key,h.target.value),disabled:!F,className:`${C} ${F?"":"bg-gray-100 cursor-not-allowed"}`,children:[a.jsx("option",{value:"",children:"Tümü"}),(le=i.options)==null?void 0:le.map(h=>a.jsx("option",{value:h.value,children:h.label},h.value))]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"multiSelect":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"border rounded-md p-2 max-h-32 overflow-y-auto",children:(oe=i.options)==null?void 0:oe.map(h=>a.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[a.jsx("input",{type:"checkbox",checked:Array.isArray(c)&&c.includes(h.value),onChange:Ne=>{const be=Array.isArray(c)?c:[];Ne.target.checked?v(i.key,[...be,h.value]):v(i.key,be.filter(Se=>Se!==h.value))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:h.label})]},h.value))}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"numberRange":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",placeholder:"Min",value:(c==null?void 0:c.min)||"",onChange:h=>v(i.key,{...c,min:h.target.value}),className:C,min:(de=i.validation)==null?void 0:de.min,max:(ce=i.validation)==null?void 0:ce.max}),a.jsx("input",{type:"number",placeholder:"Max",value:(c==null?void 0:c.max)||"",onChange:h=>v(i.key,{...c,max:h.target.value}),className:C,min:(ue=i.validation)==null?void 0:ue.min,max:(me=i.validation)==null?void 0:me.max})]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"dateRange":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"date",value:(c==null?void 0:c.start)||"",onChange:h=>v(i.key,{...c,start:h.target.value}),className:`flex-1 ${C}`,placeholder:"Başlangıç",min:(he=i.validation)==null?void 0:he.min,max:(ge=i.validation)==null?void 0:ge.max}),a.jsx("input",{type:"date",value:(c==null?void 0:c.end)||"",onChange:h=>v(i.key,{...c,end:h.target.value}),className:`flex-1 ${C}`,placeholder:"Bitiş",min:(fe=i.validation)==null?void 0:fe.min,max:(pe=i.validation)==null?void 0:pe.max})]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"date":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("input",{type:"date",value:c,onChange:h=>v(i.key,h.target.value),className:C,min:(xe=i.validation)==null?void 0:xe.min,max:(ye=i.validation)==null?void 0:ye.max}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});default:return null}};return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{"data-testid":"advanced-search-modal",className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:ke}),A&&a.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-200",children:A})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[we&&Y&&a.jsx("button",{onClick:()=>Y(f,"csv"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center space-x-1",children:a.jsx("span",{children:"Dışa Aktar"})}),a.jsx(E,{variant:"ghost",size:"icon",onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:a.jsx(Ae,{className:"h-5 w-5"})})]})]}),a.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[a.jsx("button",{onClick:()=>_("filters"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="filters"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Filtreler"}),a.jsxs("button",{onClick:()=>_("saved"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="saved"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Kayıtlı Filtreler (",l.length,")"]}),o&&o.length>0&&a.jsx("button",{onClick:()=>_("quick"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="quick"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Hızlı Filtreler"})]}),a.jsxs("div",{className:"flex h-[calc(90vh-120px)]",children:[$==="filters"&&a.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[Object.keys(U).length>0&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-800",children:[a.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Lütfen aşağıdaki hataları düzeltin:"}),a.jsx("ul",{className:"text-sm text-red-700 dark:text-red-300 space-y-1",children:Object.entries(U).map(([i,c])=>a.jsxs("li",{children:["• ",c]},i))})]}),a.jsxs("div",{className:"space-y-6",children:[x.getGroupedFields(f).filter(i=>i.group).map(i=>a.jsxs("div",{className:"space-y-4",children:[i.group.label&&a.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:i.group.label}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.fields.map(c=>{var m;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[c.label,((m=c.validation)==null?void 0:m.required)&&a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),se(c)]},c.key)})})]},i.group.id)),(()=>{const i=x.getGroupedFields(f).flatMap(m=>m.fields.map(u=>u.key)),c=r.filter(m=>!i.includes(m.key));return c.length>0?a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(m=>{var u;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[m.label,((u=m.validation)==null?void 0:u.required)&&a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),se(m)]},m.key)})})}):null})()]}),d&&a.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:ve?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{placeholder:"Filtre adı",value:V,onChange:i=>I(i.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",onKeyPress:i=>{i.key==="Enter"&&J()}}),a.jsx(E,{onClick:()=>J(),disabled:!V.trim(),children:"Kaydet"}),a.jsx(E,{variant:"outline",onClick:()=>{H(!1),I("")},children:"İptal"})]}):a.jsxs(E,{variant:"outline",onClick:()=>H(!0),className:"flex items-center gap-2",children:[a.jsx(Re,{className:"h-4 w-4"}),"Filtreyi Kaydet"]})})]}),$==="saved"&&a.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Kayıtlı Filtreler"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[p&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{const i=document.createElement("input");i.type="file",i.accept=".json",i.onchange=c=>{var u;const m=(u=c.target.files)==null?void 0:u[0];if(m&&p){const b=new FileReader;b.onload=S=>{var D;try{const F=JSON.parse((D=S.target)==null?void 0:D.result);p.importSavedFilters(F)}catch(F){console.error("Import failed:",F)}},b.readAsText(m)}},i.click()},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"İçe Aktar"}),a.jsx("button",{onClick:()=>{const i=p.exportSavedFilters(),c=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),m=URL.createObjectURL(c),u=document.createElement("a");u.href=m,u.download=`saved-filters-${A}-${new Date().toISOString().split("T")[0]}.json`,u.click(),URL.revokeObjectURL(m)},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Dışa Aktar"})]}),a.jsx("button",{onClick:()=>{p&&p.clearAllSavedFilters()},className:"text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Tümünü Temizle"})]})]}),l.map(i=>a.jsx("div",{className:"p-4 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 group",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>re(i),children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.name}),i.isQuickFilter&&a.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full dark:bg-yellow-900 dark:text-yellow-200",children:"Hızlı"})]}),a.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-400 dark:text-gray-500",children:[a.jsxs("span",{children:["Oluşturulma: ",new Date(i.createdAt).toLocaleDateString("tr-TR")]}),i.lastUsed&&a.jsxs("span",{children:["Son kullanım: ",new Date(i.lastUsed).toLocaleDateString("tr-TR")]}),i.usageCount&&a.jsxs("span",{children:["Kullanım: ",i.usageCount]})]})]}),k&&a.jsx("button",{onClick:c=>{c.stopPropagation(),k(i.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 p-1",children:a.jsx(Oe,{className:"w-4 h-4"})})]})},i.id)),l.length===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Henüz kayıtlı filtre yok"}),a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Filtrelerinizi kaydetmek için önce filtre oluşturun"})]})]})}),$==="quick"&&o&&a.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Hızlı Filtreler"}),p&&a.jsx("button",{onClick:()=>{if(Object.keys(f).length>0){const i=prompt("Hızlı filtre adı:");i&&(I(i),J(!0))}},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Mevcut Filtreyi Hızlı Filtre Yap"})]}),o.length>0?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(i=>a.jsxs("button",{onClick:()=>{re(i),p&&i.id&&p.loadSavedFilter(i.id)},className:"p-4 text-left bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 dark:from-blue-900/20 dark:to-indigo-900/20 dark:border-blue-700 dark:hover:from-blue-900/30 dark:hover:to-indigo-900/30",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i.name}),i.usageCount&&i.usageCount>0&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full dark:bg-blue-800 dark:text-blue-200",children:i.usageCount})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{children:[Object.keys(i.filters).length," filtre"]}),i.lastUsed&&a.jsxs("span",{children:["Son: ",new Date(i.lastUsed).toLocaleDateString("tr-TR")]})]})]},i.id))}):a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[a.jsx("p",{className:"mb-4",children:"Hızlı filtre bulunamadı"}),a.jsx("p",{className:"text-sm",children:"Sık kullanılan filtrelerinizi hızlı erişim için kaydedin"})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 dark:border-gray-700",children:[te&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md dark:bg-red-900/20 dark:border-red-800",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:te})}),a.jsxs(E,{variant:"outline",onClick:Fe,disabled:L,className:"flex items-center gap-2",children:[a.jsx(Ve,{className:"h-4 w-4"}),"Filtreleri Temizle"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{"data-testid":"close-modal",variant:"outline",onClick:t,disabled:L,children:"İptal"}),a.jsxs(E,{"data-testid":"apply-filters",onClick:je,disabled:L,className:"flex items-center gap-2",children:[L?a.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):a.jsx($e,{className:"h-4 w-4"}),L?"Filtreleniyor...":"Filtrele"]})]})]})]})}):null});export{Pe as A,Ke as a,Be as c};
