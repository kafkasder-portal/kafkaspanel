import{r as u,Z as T,j as e,c as E,n as F,C as d,az as h,aA as x,F as Q,aB as c,am as M,an as L,ao as V,ap as G,aq as n,D as ee,i as ae,z as se,T as te}from"./index-JhQGfP3r.js";import{I as P}from"./input-B8GNq3eI.js";import{T as re,b as ie,d as D,e as b}from"./tabs-BeOvMTD5.js";import{V as K}from"./index-BJu9RWF7.js";import{R as m,B as Y,C as p,X as g,Y as y,T as j,a as _,P as le,b as ne,c as de,x as I}from"./PieChart-B-59q0s4.js";import{L as W,a as f}from"./LineChart-DUN2LD1y.js";function ue(){const[i,z]=u.useState({monthlyAids:[],aidTypeDistribution:[],beneficiaryCategories:[],applicationTrends:[]}),[l,v]=u.useState({startDate:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],aidType:"all",category:"all"}),[O,$]=u.useState("overview"),R=u.useCallback(async()=>{try{const{data:a}=await T.from("aid_records").select("amount, created_at").gte("created_at",l.startDate).lte("created_at",l.endDate).eq("status","completed"),s=new Map;a==null||a.forEach(r=>{const t=new Date(r.created_at).toLocaleDateString("tr-TR",{year:"numeric",month:"short"});s.has(t)||s.set(t,{month:t,amount:0,count:0});const o=s.get(t);o.amount+=r.amount||0,o.count+=1});const{data:w}=await T.from("aid_records").select("aid_type").gte("created_at",l.startDate).lte("created_at",l.endDate),k=new Map;w==null||w.forEach(r=>{const t=r.aid_type;k.set(t,(k.get(t)||0)+1)});const B=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00"],Z=Array.from(k.entries()).map(([r,t],o)=>({name:q(r),value:t,color:B[o%B.length]})),{data:C}=await T.from("beneficiaries").select("category").gte("created_at",l.startDate).lte("created_at",l.endDate),A=new Map;C==null||C.forEach(r=>{const t=r.category;A.set(t,(A.get(t)||0)+1)});const J=Array.from(A.entries()).map(([r,t])=>({category:U(r),count:t})),{data:S}=await T.from("applications").select("status, created_at").gte("created_at",l.startDate).lte("created_at",l.endDate),N=new Map;S==null||S.forEach(r=>{const t=new Date(r.created_at).toLocaleDateString("tr-TR",{month:"short",day:"numeric"});N.has(t)||N.set(t,{date:t,pending:0,approved:0,rejected:0});const o=N.get(t);r.status==="pending"?o.pending+=1:r.status==="approved"?o.approved+=1:r.status==="rejected"&&(o.rejected+=1)}),z({monthlyAids:Array.from(s.values()),aidTypeDistribution:Z,beneficiaryCategories:J,applicationTrends:Array.from(N.values())})}catch(a){console.error("Rapor verileri yüklenirken hata:",a),K.error("Rapor verileri yüklenirken hata oluştu")}finally{}},[l]);u.useEffect(()=>{R()},[R]);const q=a=>({cash:"Nakit",food:"Gıda",clothing:"Giyim",housing:"Barınma",health:"Sağlık",education:"Eğitim",other:"Diğer"})[a]||a,U=a=>({orphan:"Yetim",widow:"Dul",elderly:"Yaşlı",disabled:"Engelli",refugee:"Mülteci",other:"Diğer"})[a]||a,X=()=>{K.success("Rapor dışa aktarıldı")},H=()=>{K.success("PDF raporu oluşturuldu")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Raporlar"}),e.jsx("p",{className:"text-muted-foreground",children:"Yardım ve başvuru istatistikleri"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(E,{variant:"outline",onClick:X,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs(E,{variant:"outline",onClick:H,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(x,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2"}),"Filtreler"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(P,{type:"date",value:l.startDate,onChange:a=>v(s=>({...s,startDate:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(P,{type:"date",value:l.endDate,onChange:a=>v(s=>({...s,endDate:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Yardım Türü"}),e.jsxs(M,{value:l.aidType,onValueChange:a=>v(s=>({...s,aidType:a})),children:[e.jsx(L,{children:e.jsx(V,{})}),e.jsxs(G,{children:[e.jsx(n,{value:"all",children:"Tümü"}),e.jsx(n,{value:"cash",children:"Nakit"}),e.jsx(n,{value:"food",children:"Gıda"}),e.jsx(n,{value:"clothing",children:"Giyim"}),e.jsx(n,{value:"housing",children:"Barınma"}),e.jsx(n,{value:"health",children:"Sağlık"}),e.jsx(n,{value:"education",children:"Eğitim"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Kategori"}),e.jsxs(M,{value:l.category,onValueChange:a=>v(s=>({...s,category:a})),children:[e.jsx(L,{children:e.jsx(V,{})}),e.jsxs(G,{children:[e.jsx(n,{value:"all",children:"Tümü"}),e.jsx(n,{value:"orphan",children:"Yetim"}),e.jsx(n,{value:"widow",children:"Dul"}),e.jsx(n,{value:"elderly",children:"Yaşlı"}),e.jsx(n,{value:"disabled",children:"Engelli"}),e.jsx(n,{value:"refugee",children:"Mülteci"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ee,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Toplam Yardım"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.monthlyAids.reduce((a,s)=>a+s.amount,0).toLocaleString("tr-TR")," ₺"]})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ae,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Alan"}),e.jsx("p",{className:"text-2xl font-bold",children:i.monthlyAids.reduce((a,s)=>a+s.count,0)})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(se,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Türü"}),e.jsx("p",{className:"text-2xl font-bold",children:i.aidTypeDistribution.length})]})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(te,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ortalama"}),e.jsxs("p",{className:"text-2xl font-bold",children:[i.monthlyAids.length>0?(i.monthlyAids.reduce((a,s)=>a+s.amount,0)/i.monthlyAids.length).toLocaleString("tr-TR",{maximumFractionDigits:0}):0," ₺"]})]})]})})})]}),e.jsxs(re,{value:O,onValueChange:$,children:[e.jsxs(ie,{className:"grid w-full grid-cols-4",children:[e.jsx(D,{value:"overview",children:"Genel Bakış"}),e.jsx(D,{value:"monthly",children:"Aylık Trend"}),e.jsx(D,{value:"distribution",children:"Dağılım"}),e.jsx(D,{value:"applications",children:"Başvurular"})]}),e.jsx(b,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Aylık Yardım Dağılımı"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:300,children:e.jsxs(Y,{data:i.monthlyAids,children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"month"}),e.jsx(y,{}),e.jsx(j,{}),e.jsx(_,{dataKey:"amount",fill:"#8884d8"})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Yardım Türü Dağılımı"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:300,children:e.jsxs(le,{children:[e.jsx(ne,{data:i.aidTypeDistribution,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:a,percent:s})=>`${a} ${(s*100).toFixed(0)}%`,children:i.aidTypeDistribution.map((a,s)=>e.jsx(de,{fill:a.color},`cell-${s}`))}),e.jsx(j,{})]})})})]})]})}),e.jsx(b,{value:"monthly",className:"space-y-6",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Aylık Yardım Trendi"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:400,children:e.jsxs(W,{data:i.monthlyAids,children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"month"}),e.jsx(y,{}),e.jsx(j,{}),e.jsx(I,{}),e.jsx(f,{type:"monotone",dataKey:"amount",stroke:"#8884d8",strokeWidth:2}),e.jsx(f,{type:"monotone",dataKey:"count",stroke:"#82ca9d",strokeWidth:2})]})})})]})}),e.jsx(b,{value:"distribution",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"İhtiyaç Sahibi Kategorileri"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:300,children:e.jsxs(Y,{data:i.beneficiaryCategories,children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"category"}),e.jsx(y,{}),e.jsx(j,{}),e.jsx(_,{dataKey:"count",fill:"#82ca9d"})]})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Yardım Türü Detayı"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:300,children:e.jsxs(Y,{data:i.aidTypeDistribution,layout:"horizontal",children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(g,{type:"number"}),e.jsx(y,{dataKey:"name",type:"category"}),e.jsx(j,{}),e.jsx(_,{dataKey:"value",fill:"#8884d8"})]})})})]})]})}),e.jsx(b,{value:"applications",className:"space-y-6",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Başvuru Trendleri"})}),e.jsx(c,{children:e.jsx(m,{width:"100%",height:400,children:e.jsxs(W,{data:i.applicationTrends,children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"date"}),e.jsx(y,{}),e.jsx(j,{}),e.jsx(I,{}),e.jsx(f,{type:"monotone",dataKey:"pending",stroke:"#ffc658",strokeWidth:2}),e.jsx(f,{type:"monotone",dataKey:"approved",stroke:"#82ca9d",strokeWidth:2}),e.jsx(f,{type:"monotone",dataKey:"rejected",stroke:"#ff7300",strokeWidth:2})]})})})]})})]})]})}export{ue as default};
