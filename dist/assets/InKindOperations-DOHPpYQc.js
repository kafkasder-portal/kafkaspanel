import{v as Y,r as n,Z as j,j as e,e as E,W as w,aE as z,k as ce,S as de,n as me,X as ue,ak as K,q as xe,$ as pe}from"./index-JhQGfP3r.js";import{e as he}from"./exportToCsv-CTUkvpR5.js";import{D as ye}from"./DataTable-ZpmiLouZ.js";import{M as ge}from"./Modal-Ul9aPZYl.js";import{S as v}from"./StatCard-By2eovuR.js";import{u as be,t as fe,o as je,s as d,n as F,e as ve}from"./types-DpNt5E6n.js";import{V as S}from"./index-BJu9RWF7.js";import{E as _e}from"./eye-Bcuk08KK.js";import{P as ke}from"./pen-square-BZRlDdvk.js";const Ne=Y("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),O=Y("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]),we=je({operation_type:ve(["received","distributed","transferred","returned"],{message:"İşlem türü seçiniz"}),item_name:d().min(1,"Ürün adı giriniz"),item_category:d().min(1,"Kategori seçiniz"),quantity:F().min(1,"Miktar giriniz"),unit:d().min(1,"Birim seçiniz"),unit_value:F().optional(),source:d().optional(),destination:d().optional(),beneficiary_id:d().optional(),warehouse_location:d().min(1,"Depo konumu giriniz"),expiry_date:d().optional(),notes:d().optional()}),L=["Gıda","Giyim","Temizlik","Kırtasiye","Oyuncak","Ev Eşyası","Elektronik","Kitap","Diğer"],Se=["Adet","Kg","Gram","Litre","Paket","Kutu","Çuval","Koli"],De=["Ana Depo - A Blok","Ana Depo - B Blok","Ana Depo - C Blok","Şube Depo 1","Şube Depo 2","Soğuk Hava Deposu"];function Fe(){const[D,I]=n.useState([]),[h,R]=n.useState({totalReceived:0,totalDistributed:0,currentStock:0,todayOperations:0}),[H,P]=n.useState(!0),[m,V]=n.useState(""),[y,G]=n.useState("all"),[g,$]=n.useState("all"),[b,Q]=n.useState("all"),[f,W]=n.useState("all"),[U,u]=n.useState(!1),[T,C]=n.useState(null),[Z,X]=n.useState([]),{register:i,handleSubmit:J,formState:{errors:l},reset:ee,watch:_}=be({resolver:fe(we)}),p=_("operation_type"),te=_("quantity"),ae=_("unit_value");n.useEffect(()=>{},[te,ae]),n.useEffect(()=>{A(),B(),se()},[]);const A=async()=>{try{const{data:t,error:a}=await j.from("in_kind_aids").select(`
          *,
          beneficiaries (
            name,
            surname,
            category
          )
        `).order("created_at",{ascending:!1});if(a)throw a;const r=(t==null?void 0:t.map(s=>({id:s.id,operation_type:"distributed",item_name:s.item_name,item_category:s.item_category,quantity:s.quantity,unit:s.unit,unit_value:s.unit_value,total_value:s.total_value,beneficiary_id:s.beneficiary_id,warehouse_location:s.warehouse_location||"Ana Depo - A Blok",expiry_date:s.expiry_date,operation_date:s.distributed_at||s.created_at,status:s.status==="distributed"?"completed":"pending",notes:s.notes,created_at:s.created_at,operator_id:"user1",beneficiaries:s.beneficiaries,operator:{name:"Admin User",email:"admin@example.com"}})))||[];I(r)}catch(t){console.error("Ayni yardım işlemleri yüklenirken hata:",{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),S.error("Ayni yardım işlemleri yüklenirken hata oluştu")}finally{P(!1)}},B=async()=>{try{const{data:t}=await j.from("in_kind_aids").select("quantity, total_value, status");if(t){const a=t.reduce((o,c)=>o+(c.quantity||0),0),r=t.filter(o=>o.status==="distributed").reduce((o,c)=>o+(c.quantity||0),0),s=a-r,N=t.filter(o=>{const c=new Date(o.created_at||""),x=new Date;return c.toDateString()===x.toDateString()}).length;R({totalReceived:a,totalDistributed:r,currentStock:s,todayOperations:N})}}catch(t){console.error("İstatistikler yüklenirken hata:",{message:t instanceof Error?t.message:String(t)})}},se=async()=>{try{const{data:t,error:a}=await j.from("beneficiaries").select("id, name, surname, category").eq("status","active").order("name");if(a)throw a;X(t||[])}catch(t){console.error("İhtiyaç sahipleri yüklenirken hata:",{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0})}},k=n.useMemo(()=>D.filter(t=>{const a=m===""||t.item_name.toLowerCase().includes(m.toLowerCase())||t.item_category.toLowerCase().includes(m.toLowerCase())||t.warehouse_location.toLowerCase().includes(m.toLowerCase()),r=y==="all"||t.operation_type===y,s=g==="all"||t.item_category===g,N=b==="all"||t.status===b;let o=!0;if(f!=="all"){const c=new Date(t.operation_date),x=new Date;switch(f){case"today":{o=c.toDateString()===x.toDateString();break}case"week":{const oe=new Date(x.getTime()-6048e5);o=c>=oe;break}case"month":{o=c.getMonth()===x.getMonth()&&c.getFullYear()===x.getFullYear();break}}}return a&&r&&s&&N&&o}),[D,m,y,g,b,f]),re=async t=>{try{const a=(t.quantity||0)*(t.unit_value||0),{error:r}=await j.from("in_kind_aids").insert({beneficiary_id:t.beneficiary_id,item_name:t.item_name,item_category:t.item_category,quantity:t.quantity,unit:t.unit,unit_value:t.unit_value,total_value:a,warehouse_location:t.warehouse_location,expiry_date:t.expiry_date,status:"pending",notes:t.notes});if(r)throw r;S.success("Ayni yardım işlemi başarıyla kaydedildi"),u(!1),ee(),A(),B()}catch(a){console.error("Ayni yardım işlemi kaydedilirken hata:",{message:a instanceof Error?a.message:String(a)}),S.error("Ayni yardım işlemi kaydedilirken hata oluştu")}},ne=t=>{const r={received:{label:"Alındı",class:"bg-green-100 text-green-800",icon:w},distributed:{label:"Dağıtıldı",class:"bg-blue-100 text-blue-800",icon:z},transferred:{label:"Transfer",class:"bg-purple-100 text-purple-800",icon:O},returned:{label:"İade",class:"bg-orange-100 text-orange-800",icon:Ne}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:w},s=r.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${r.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),r.label]})},ie=t=>{const r={pending:{label:"Beklemede",class:"bg-yellow-100 text-yellow-800",icon:xe},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:K},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:ue}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:K},s=r.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${r.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),r.label]})},M=t=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(t),q=t=>new Date(t).toLocaleDateString("tr-TR"),le=[{key:"operation_type",header:"İşlem Türü",render:(t,a)=>ne(a.operation_type)},{key:"item_info",header:"Ürün Bilgisi",render:(t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.item_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.item_category})]})},{key:"quantity",header:"Miktar",render:(t,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.quantity," ",a.unit]}),a.unit_value&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Birim: ",M(a.unit_value)]})]})},{key:"total_value",header:"Toplam Değer",render:(t,a)=>e.jsx("div",{className:"font-medium text-green-600",children:M(a.total_value)})},{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(t,a)=>e.jsx("div",{children:a.beneficiaries?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[a.beneficiaries.name," ",a.beneficiaries.surname]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.beneficiaries.category})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"warehouse_location",header:"Depo Konumu",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.warehouse_location})]})},{key:"operation_date",header:"İşlem Tarihi",render:(t,a)=>q(a.operation_date)},{key:"expiry_date",header:"Son Kullanma",render:(t,a)=>a.expiry_date?q(a.expiry_date):"-"},{key:"status",header:"Durum",render:(t,a)=>ie(a.status)},{key:"actions",header:"İşlemler",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(_e,{className:"h-4 w-4"})}),a.status==="pending"&&e.jsx("button",{onClick:()=>{C(a),u(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(ke,{className:"h-4 w-4"})})]})}];return H?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Ayni Yardım İşlemleri"}),e.jsx("p",{className:"text-muted-foreground",children:"Ayni yardım işlemlerini kaydedin ve takip edin"})]}),e.jsxs("button",{onClick:()=>{C(null),u(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(E,{className:"h-4 w-4"}),"Yeni İşlem"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(v,{title:"Toplam Alınan",value:h.totalReceived.toString(),icon:w,accentClass:"bg-green-100"}),e.jsx(v,{title:"Toplam Dağıtılan",value:h.totalDistributed.toString(),icon:z,accentClass:"bg-blue-100"}),e.jsx(v,{title:"Mevcut Stok",value:h.currentStock.toString(),icon:O,accentClass:"bg-purple-100"}),e.jsx(v,{title:"Bugünkü İşlemler",value:h.todayOperations.toString(),icon:ce,accentClass:"bg-orange-100"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"İşlem ara...",value:m,onChange:t=>V(t.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:y,onChange:t=>G(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm İşlem Türleri"}),e.jsx("option",{value:"received",children:"Alınan"}),e.jsx("option",{value:"distributed",children:"Dağıtılan"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),e.jsxs("select",{value:g,onChange:t=>$(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Kategoriler"}),L.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:b,onChange:t=>Q(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"pending",children:"Bekleyen"}),e.jsx("option",{value:"completed",children:"Tamamlanan"}),e.jsx("option",{value:"cancelled",children:"İptal Edilen"})]}),e.jsxs("select",{value:f,onChange:t=>W(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tarihler"}),e.jsx("option",{value:"today",children:"Bugün"}),e.jsx("option",{value:"week",children:"Bu Hafta"}),e.jsx("option",{value:"month",children:"Bu Ay"})]}),e.jsxs("button",{onClick:()=>he("ayni-yardim-islemleri.csv",k),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(me,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[k.length," işlem"]})]}),e.jsx(ye,{columns:le,data:k}),e.jsxs(ge,{open:U,onClose:()=>u(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:T?"İşlem Düzenle":"Yeni Ayni Yardım İşlemi"}),e.jsx("button",{onClick:()=>u(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:J(re),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İşlem Türü *"}),e.jsxs("select",{...i("operation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),e.jsx("option",{value:"received",children:"Alındı"}),e.jsx("option",{value:"distributed",children:"Dağıtıldı"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),l.operation_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.operation_type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Kategorisi *"}),e.jsxs("select",{...i("item_category"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),L.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.item_category&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.item_category.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Adı *"}),e.jsx("input",{type:"text",...i("item_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürün adını giriniz"}),l.item_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.item_name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Miktar *"}),e.jsx("input",{type:"number",...i("quantity",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0"}),l.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim *"}),e.jsxs("select",{...i("unit"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),Se.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.unit&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.unit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim Değer"}),e.jsx("input",{type:"number",step:"0.01",...i("unit_value",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0.00"})]})]}),(p==="distributed"||p==="transferred")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:p==="distributed"?"İhtiyaç Sahibi":"Hedef"}),p==="distributed"?e.jsxs("select",{...i("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),Z.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.surname," - ",t.category]},t.id))]}):e.jsx("input",{type:"text",...i("destination"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hedef konum"})]}),p==="received"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kaynak"}),e.jsx("input",{type:"text",...i("source"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürünün geldiği yer"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Depo Konumu *"}),e.jsxs("select",{...i("warehouse_location"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),De.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.warehouse_location&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.warehouse_location.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Son Kullanma Tarihi"}),e.jsx("input",{type:"date",...i("expiry_date"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{...i("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İşlem ile ilgili notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(E,{className:"h-4 w-4"}),T?"Güncelle":"Kaydet"]})]})]})]})]})}export{Fe as default};
