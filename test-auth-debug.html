<!DOCTYPE html>
<html>
<head>
    <title>Supabase Auth Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h2>üîß Supabase Authentication Debug</h2>
    <div id="output"></div>
    
    <script>
        async function testSupabase() {
            const output = document.getElementById('output');
            
            try {
                // Initialize Supabase
                const supabaseUrl = 'https://ibqhfgpdgzrhvyfpgjxx.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlicWhmZ3BkZ3pyaHZ5ZnBnanh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMDk3NDcsImV4cCI6MjA3MDY4NTc0N30.1vSikm9_Dn978BctKWXhoOfPCKztLaBNgr8OEIVIXNg';
                
                const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                
                output.innerHTML += '<p>‚úÖ Supabase client created</p>';
                
                // Test session
                const { data: session, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError) {
                    output.innerHTML += `<p>‚ùå Session error: ${sessionError.message}</p>`;
                } else {
                    output.innerHTML += `<p>‚úÖ Session check OK (user: ${session?.session?.user?.email || 'none'})</p>`;
                }
                
                // Test database query
                const { data: profiles, error: profileError } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .limit(1);
                
                if (profileError) {
                    output.innerHTML += `<p>‚ùå Profile query error: ${profileError.message}</p>`;
                } else {
                    output.innerHTML += `<p>‚úÖ Profile query OK (${profiles.length} profiles found)</p>`;
                }
                
                // Test login
                output.innerHTML += '<p>üîê Testing login with demo credentials...</p>';
                const { data: loginData, error: loginError } = await supabase.auth.signInWithPassword({
                    email: 'isahamid095@gmail.com',
                    password: 'test123'
                });
                
                if (loginError) {
                    output.innerHTML += `<p>‚ùå Login error: ${loginError.message}</p>`;
                } else {
                    output.innerHTML += `<p>‚úÖ Login successful: ${loginData.user?.email}</p>`;
                    
                    // Test profile fetch after login
                    const { data: userProfile, error: userProfileError } = await supabase
                        .from('user_profiles')
                        .select('*')
                        .eq('id', loginData.user.id)
                        .single();
                    
                    if (userProfileError) {
                        output.innerHTML += `<p>‚ùå User profile error: ${userProfileError.message}</p>`;
                    } else {
                        output.innerHTML += `<p>‚úÖ User profile loaded: ${userProfile.full_name} (${userProfile.role})</p>`;
                    }
                }
                
            } catch (error) {
                output.innerHTML += `<p>‚ùå General error: ${error.message}</p>`;
            }
        }
        
        testSupabase();
    </script>
</body>
</html>
